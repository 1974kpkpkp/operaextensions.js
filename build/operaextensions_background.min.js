// operaextensions_background.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(m){function T(a,e,b){H?a[e].apply(a,b):D.push({target:a,methodName:e,args:b})}function U(a){for(var e in a)if(a.hasOwnProperty(e))return!1;return!0}function N(a,e){function b(a,e,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(e-a)*b:0.5>b?e:b<2/3?a+6*(e-a)*(2/3-b):a}function c(a){a=parseInt(a,10);a=a.toString(16);return 0==a?"00":a}if(void 0===a||null===a)return a;var a=a+"",d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,
255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,
107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],
gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],
lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,
179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,
239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,
180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}[a.toLowerCase()];if(d)return"#"+c(d[0])+c(d[1])+c(d[2]);var d={hexLong:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hexShort:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},f;for(f in d)if(a.match(d[f]))return a;f=[["rgb",/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/],
["rgb",/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsl",/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/],["hsl",/^hsla\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%,\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsv",/^hsv\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/]];for(var d={rgb:function(a){return[a[1],a[2],a[3],a[4]||1]},hsl:function(a){var e=parseInt(a[1],10)%360/360,c=parseInt(a[2],10)%101/100,d=parseInt(a[3],10)%101/100,a=a[4]||1;if(0===c)return[d,d,d];c=0.5>d?d*(1+c):d+c-
d*c;d=2*d-c;return[(256*b(d,c,e+1/3)).toFixed(0),(256*b(d,c,e)).toFixed(0),(256*b(d,c,e-1/3)).toFixed(0),a]},hsv:function(a){var e,b,c,d=parseInt(a[1],10)%360/360,f=parseInt(a[2],10)%101/100,a=parseInt(a[3],10)%101/100,g=Math.floor(6*d),h=6*d-g,d=a*(1-f),i=a*(1-h*f),f=a*(1-(1-h)*f);switch(g%6){case 0:e=a;b=f;c=d;break;case 1:e=i;b=a;c=d;break;case 2:e=d;b=a;c=f;break;case 3:e=d;b=i;c=a;break;case 4:e=f;b=d;c=a;break;case 5:e=a,b=d,c=i}return[256*e,256*b,256*c]}},g=0,h=f.length;g<h;g++){var i=f[g][1].exec(a);
if(i)return f=d[f[g][0]](i),d=parseFloat(f[3]||1),f="NaN"===d+""||0>d||1<=d?f:0==d?[255,255,255]:[d*parseInt(f[0],10)+(1-d)*(e||255),d*parseInt(f[1],10)+(1-d)*(e||255),d*parseInt(f[2],10)+(1-d)*(e||255)],"#"+c(f[0]||255)+c(f[1]||255)+c(f[2]||255)}return"#f00"}function j(a,e,b){Error.call(this);Error.captureStackTrace(this,arguments.callee);this.name=a||"Error";this.code=b||-1;this.message=e||""}var y=function(){};y.prototype.REVISION="1";y.prototype.version=function(){return this.REVISION};y.prototype.buildNumber=
function(){return this.REVISION};y.prototype.postError=function(a){console.log(a)};var z=m.opera||new y,H=!1,D=[],K={WINTABS_LOADED:!1,WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},I={},n="undefined"!==typeof window?window:{},n=n.MutationObserver||n.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))n=function(a,e){process.nextTick(function(){a.call(e)})};else if(n){var W=[],n=new n(function(){var a=W.slice();W=[];a.forEach(function(a){a[0].call(a[1])})}),
$=document.createElement("div");n.observe($,{attributes:!0});n=function(a,e){W.push([a,e]);$.setAttribute("drainQueue","drainQueue")}}else n=function(a,e){setTimeout(function(){a.call(e)},1)};I.async=n;var aa=I.Event=function(a,e){this.type=a;for(var b in e)e.hasOwnProperty(b)&&(this[b]=e[b])},ba=function(a,e){for(var b=0,c=a.length;b<c;b++)if(a[b][0]===e)return b;return-1},O=function(a){var e=a._promiseCallbacks;e||(e=a._promiseCallbacks={});return e},E=I.EventTarget={mixin:function(a){a.on=this.on;
a.off=this.off;a.trigger=this.trigger;return a},on:function(a,e,b){for(var c=O(this),d,f,a=a.split(/\s+/),b=b||this;f=a.shift();)(d=c[f])||(d=c[f]=[]),-1===ba(d,e)&&d.push([e,b])},off:function(a,e){for(var b=O(this),c,d,a=a.split(/\s+/);c=a.shift();)e?(c=b[c],d=ba(c,e),-1!==d&&c.splice(d,1)):b[c]=[]},trigger:function(a,e){var b,c,d,f;if(b=O(this)[a])for(var g=0,h=b.length;g<h;g++)c=b[g],d=c[0],c=c[1],"object"!==typeof e&&(e={detail:e}),f=new aa(a,e),d.call(c,f)}},r=I.Promise=function(){this.on("promise:resolved",
function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},ca=function(){},da=function(a,e,b,c){var d,f;if(b)try{d=b(c.detail)}catch(g){f=g}else d=c.detail;if(d instanceof r)d.then(function(a){e.resolve(a)},function(a){e.reject(a)});else if(b&&d)e.resolve(d);else if(f)e.reject(f);else e[a](d)};r.prototype={then:function(a,e){var b=new r;this.on("promise:resolved",function(e){da("resolve",b,a,e)});this.on("promise:failed",
function(a){da("reject",b,e,a)});return b},resolve:function(a){I.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=ca},reject:function(a){I.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=ca}};E.mixin(r.prototype);j.prototype.__proto__=Error.prototype;var i=function(a,e){var b=document.createEvent("Event");b.initEvent(a,!0,!0);for(var c in e)b[c]=e[c];return b},n=function(){E.mixin(this)};
n.prototype.constructor=n;n.prototype.addEventListener=function(a,e){this.on(a,e)};n.prototype.removeEventListener=function(a,e){this.off(a,e)};n.prototype.dispatchEvent=function(a){var e=a.type;if("function"===typeof this["on"+e.toLowerCase()])this.on(e,this["on"+e.toLowerCase()]);this.trigger(e,a)};var w=function(){r.call(this)};w.prototype=Object.create(r.prototype);for(var q in n.prototype)w.prototype[q]=n.prototype[q];var k,Y=function(){P=!1;X()},X=function(){if(!P){P=!0;var a=ea.shift();if(void 0===
a)P=!1;else if(a.obj.isResolved)a.fn.call(a.obj,Y);else if(a.ignoreResolve)a.fn.call(a.obj,Y);else{var e=m.setTimeout(function(){console.warn("PromiseQueue deadlock broken with timeout.");console.log(a.obj);console.log(a.obj.isResolved);a.obj.trigger("promise:resolved")},ka);a.obj.on("promise:resolved",function(){e&&m.clearTimeout(e);a.obj.isResolved=!0;a.fn.call(a.obj,Y)})}}},ea=[],P=!1,ka=1E3;k={enqueue:function(a,e,b){ea.push({obj:a,fn:e,ignoreResolve:b});X()},dequeue:function(){X()}};var Q=function(a){E.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new i("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,b,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new i("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:b&&b.tab?b.tab.id:
null}})):T(this,"dispatchEvent",[new i("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}})]);c&&c({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),T(this,"dispatchEvent",[new i("connect",{source:this._localPort})]))};Q.prototype=Object.create(n.prototype);Q.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var R=function(){Q.call(this,
!0);this._allPorts=[];chrome.extension.onConnect.addListener(function(a){var e=this._allPorts.length;a.onDisconnect.addListener(function(){this._allPorts.splice(e-1,1);this.dispatchEvent(new i("disconnect",{source:a}))}.bind(this));this._allPorts[e]=a;a.onMessage.addListener(function(e){e&&e.action&&0===e.action.indexOf("___O_")?this.dispatchEvent(new i("controlmessage",{data:e,source:{postMessage:function(e){a.postMessage(e)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})):T(this,"dispatchEvent",
[new i("message",{data:e,source:{postMessage:function(e){a.postMessage(e)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})])}.bind(this));this.dispatchEvent(new i("connect",{source:a}))}.bind(this))};R.prototype=Object.create(Q.prototype);R.prototype.broadcastMessage=function(a){for(var e=0,b=this._allPorts.length;e<b;e++)this._allPorts[e].postMessage(a)};var o=function(){R.call(this)};o.prototype=Object.create(R.prototype);var h=z.extension=z.extension||new o,L=z.contexts=z.contexts||{};o.prototype.getFile=
function(a){var e=null;if("string"!=typeof a)return e;try{var b=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(b)?b:"")+a,c=new XMLHttpRequest;c.onloadend=function(){c.readyState==c.DONE&&200==c.status&&(result=c.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},e=result)};c.open("GET",a,!1);c.responseType=
"blob";c.send(null)}catch(d){}return e};var F=function(){Object.defineProperty(this,"_storage",{value:localStorage});Object.defineProperty(this,"length",{value:0,writable:!0});for(var a in localStorage)this[a]=localStorage[a],this.length++;Object.defineProperty(F.prototype,"getItem",{value:function(a){return this._storage.getItem(a)}.bind(this)});Object.defineProperty(F.prototype,"key",{value:function(a){return this._storage.key(a)}.bind(this)});Object.defineProperty(F.prototype,"removeItem",{value:function(a,
b){this._storage.removeItem(a);this.hasOwnProperty(a)&&(delete this[a],this.length--);b||h.postMessage({action:"___O_widgetPreferences_removeItem_RESPONSE",data:{key:a}})}.bind(this)});Object.defineProperty(F.prototype,"setItem",{value:function(a,b,c){var d=this._storage.getItem(a);this._storage.setItem(a,b);this[a]||this.length++;this[a]=b;c||h.postMessage({action:"___O_widgetPreferences_setItem_RESPONSE",data:{key:a,val:b}});a=new i("storage",{key:a,oldValue:d,newValue:this._storage.getItem(a),
url:chrome.extension.getURL(""),storageArea:this._storage});m.dispatchEvent(a)}.bind(this)});Object.defineProperty(F.prototype,"clear",{value:function(a){this._storage.clear();for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||h.postMessage({action:"___O_widgetPreferences_clearItem_RESPONSE"})}.bind(this)})};F.prototype=Object.create(Storage.prototype);o=function(){E.mixin(this);this.properties={};this._preferences=new F;K.WIDGET_PREFERENCES_LOADED=!0;var a=new XMLHttpRequest;
a.open("GET","/manifest.json",!0);a.onreadystatechange=function(){4==a.readyState&&(this.properties=JSON.parse(a.responseText),this.properties.id=/^chrome\-extension\:\/\/(.*)\/$/.exec(chrome.extension.getURL(""))[1],K.WIDGET_API_LOADED=!0)}.bind(this);a.send();h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_REQUEST":var b={},c;for(c in this.properties)b[c]=this.properties[c];a.source.postMessage({action:"___O_widget_setup_RESPONSE",
attrs:b,_prefs:this._preferences});break;case "___O_widgetPreferences_setItem_REQUEST":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_REQUEST":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_REQUEST":this._preferences.clear(!0)}}.bind(this),!1)};o.prototype=Object.create(n.prototype);o.prototype.__defineGetter__("name",function(){return this.properties.name||""});o.prototype.__defineGetter__("shortName",
function(){return this.properties.name?this.properties.name.short||"":""});o.prototype.__defineGetter__("id",function(){return this.properties.id||""});o.prototype.__defineGetter__("description",function(){return this.properties.description||""});o.prototype.__defineGetter__("author",function(){return this.properties.author?this.properties.author.name||"":""});o.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});o.prototype.__defineGetter__("authorEmail",
function(){return this.properties.author?this.properties.author.email||"":""});o.prototype.__defineGetter__("version",function(){return this.properties.version||""});o.prototype.__defineGetter__("preferences",function(){return this._preferences});m.widget=m.widget||new o;o=function(){r.call(this);this.length=0;chrome.windows.getAll({populate:!0},function(a){for(var e=[],b=0,c=a.length;b<c;b++){var d=new p(a[b]);d.properties.id=a[b].id;d.properties.incognito=a[b].incognito;this[b]=d;this.length=b+
1;for(var d=[],f=0,g=a[b].tabs.length;f<g;f++)d[f]=new l(a[b].tabs[f],this[b],!0),d[f].properties.id=a[b].tabs[f].id,d[f].properties.active=a[b].tabs[f].active,d[f].properties.pinned=a[b].tabs[f].pinned,d[f].properties.status=a[b].tabs[f].status,d[f].properties.title=a[b].tabs[f].title,d[f].properties.favIconUrl=a[b].tabs[f].favIconUrl,d[f].properties.url=a[b].tabs[f].url,d[f].properties.index=a[b].tabs[f].index,d[f].properties.incognito=a[b].tabs[f].incognito;this[b].tabs.replaceTabs(d);e=e.concat(d)}h.tabs.replaceTabs(e);
this.resolve(!0);h.tabs.resolve(!0);b=0;for(c=this.length;b<c;b++){this[b].resolve(!0);this[b].tabs.resolve(!0);f=0;for(g=this[b].tabs.length;f<g;f++)this[b].tabs[f].resolve(!0)}K.WINTABS_LOADED=!0}.bind(this));this.addWindow=function(a,e){e.properties.id=a;this[this.length]=e;this.length+=1;e.resolve(!0);e.tabs.resolve(!0);this.dispatchEvent(new i("create",{browserWindow:e}))};chrome.windows.onFocusChanged.addListener(function(a){var e=this.getLastFocused();if(a!==chrome.windows.WINDOW_ID_NONE)for(var b=
0,c=this.length;b<c;b++)this[b].properties.focused=this[b].properties.id==a&&e!==this[b]?!0:!1;b=0;for(c=this.length;b<c;b++)if(this[b].properties.id!==a&&this[b]==e){this[b].properties.focused=!1;this[b].dispatchEvent(new i("blur",{browserWindow:e}));this.dispatchEvent(new i("blur",{browserWindow:e}));a=this.getLastFocused();a.dispatchEvent(new i("focus",{browserWindow:a}));this.dispatchEvent(new i("focus",{browserWindow:a}));break}k.dequeue()}.bind(this));chrome.windows.onRemoved.addListener(function(a){for(var e=
-1,b=0,c=this.length;b<c;b++)if(this[b].properties.id==a){e=b;break}if(-1<e){a=this[e];a.properties.closed=!0;a.tabs.replaceTabs([]);b=e;for(c=this.length;b<c;b++)this[b+1]?this[b]=this[b+1]:delete this[b];this.length-=1;a.dispatchEvent(new i("close",{}));this.dispatchEvent(new i("close",{browserWindow:a}))}k.dequeue()}.bind(this))};o.prototype=Object.create(w.prototype);o.prototype.create=function(a,e){var b=new p(e),c={focused:b.properties.focused,incognito:b.properties.incognito,width:b.properties.width,
height:b.properties.height,top:b.properties.top,left:b.properties.left},d=[],f=[];if(a&&"[object Array]"===Object.prototype.toString.call(a)&&0<a.length)for(var g=0,V=a.length;g<V;g++)if(a[g]instanceof l){var u=a[g],j=g;u._windowParent&&u._windowParent.tabs.removeTab(u);u._windowParent=b;u.properties.index=b.tabs.length;b.tabs.addTab(u,u.properties.index);0==j?(c.tabId=u.properties.id,b.rewriteUrl="chrome://newtab/#"+u.properties.id):d.push(u)}else j=a[g],u=g,j=j||{},j=new l(j,b),j.properties.index=
g,b.tabs.addTab(j,j.properties.index),h.tabs.addTab(j),0==u?c.url=b.rewriteUrl="chrome://newtab/#"+j._operaId:f.push(j);else g=new l({active:!0},b),b.tabs.addTab(g,g.properties.index),h.tabs.addTab(g),b.rewriteUrl="chrome://newtab/#"+b._operaId,c.url=b.rewriteUrl;this[this.length]=b;this.length+=1;if(!0==b.properties.focused){g=0;for(V=this.length;g<V;g++)this[g]!==b&&(this[g].properties.focused=!1)}k.enqueue(this,function(a){chrome.windows.create(c,function(e){for(var c in e)"tabs"!=c&&(b.properties[c]=
e[c]);if(0<d.length){c=0;for(e=d.length;c<e;c++)(function(a){k.enqueue(a,function(a){chrome.tabs.move(this.properties.id,{index:this._windowParent.tabs.length,windowId:this._windowParent.properties.id},function(e){for(var b in e)"url"!=b&&(this.properties[b]=e[b]);a()}.bind(this))}.bind(a))})(d[c])}if(0<f.length){c=0;for(e=f.length;c<e;c++)(function(a){var e={windowId:b.properties.id,url:a.properties.url||"chrome://newtab/",active:a.properties.active,pinned:a.properties.pinned,index:a.properties.index};
k.enqueue(this,function(c){chrome.tabs.create(e,function(e){for(var b in e)a.properties[b]=e[b];a.resolve(!0);c()}.bind(b.tabs))}.bind(this),!0);a._windowParent.tabs.dispatchEvent(new i("create",{tab:a,prevWindow:a._windowParent,prevTabGroup:null,prevPosition:NaN}));h.tabs.dispatchEvent(new i("create",{tab:a,prevWindow:a._windowParent,prevTabGroup:null,prevPosition:NaN}))})(f[c])}a()}.bind(this))}.bind(this),!0);m.setTimeout(function(){this.dispatchEvent(new i("create",{browserWindow:b}))}.bind(this),
50);return b};o.prototype.getAll=function(){for(var a=[],e=0,b=this.length;e<b;e++)a[e]=this[e];return a};o.prototype.getLastFocused=function(){for(var a=0,e=this.length;a<e;a++)if(!0==this[a].focused)return this[a];this[0]&&(this[0].properties.focused=!0);return this[0]||void 0};o.prototype.close=function(a){a&&a instanceof p&&a.close()};var p=function(a){r.call(this);a=a||{};this.properties={id:void 0,closed:!1,focused:a.focused?!!a.focused:void 0,incognito:a.private?!!a.private:void 0,parent:null,
width:a.width?parseInt(a.width,10):void 0,height:a.height?parseInt(a.height,10):void 0,top:a.top?parseInt(a.top,10):void 0,left:a.left?parseInt(a.left,10):void 0};this._parent=null;this._operaId=Math.floor(1E16*Math.random());this.tabs=new s(this);this.tabGroups=new M(this);void 0!==this.properties.private&&(this.properties.incognito=!!this.properties.private,delete this.properties.private);void 0!==this.properties.closed&&delete this.properties.closed};p.prototype=Object.create(w.prototype);p.prototype.__defineGetter__("id",
function(){return this._operaId});p.prototype.__defineGetter__("closed",function(){return void 0!==this.properties.closed?!!this.properties.closed:!1});p.prototype.__defineGetter__("focused",function(){return void 0!==this.properties.focused?!!this.properties.focused:!1});p.prototype.__defineGetter__("private",function(){return void 0!==this.properties.incognito?!!this.properties.incognito:!1});p.prototype.__defineGetter__("top",function(){return void 0!==this.properties.top?this.properties.top:-1});
p.prototype.__defineGetter__("left",function(){return void 0!==this.properties.left?this.properties.left:-1});p.prototype.__defineGetter__("height",function(){return void 0!==this.properties.height?this.properties.height:-1});p.prototype.__defineGetter__("width",function(){return void 0!==this.properties.width?this.properties.width:-1});p.prototype.__defineGetter__("parent",function(){return this._parent});p.prototype.insert=function(a,e){if(a&&a instanceof l){if(!0===this.properties.closed)throw new j("InvalidStateError",
"Current window is in the closed state and therefore is invalid",DOMException.INVALID_STATE_ERR);var b=this.properties.id,c=h.windows.length;if(e&&e instanceof l){if(!0===e.closed)throw new j("InvalidStateError","'child' parameter is in the closed state and therefore is invalid",DOMException.INVALID_STATE_ERR);if(e._windowParent&&!0===e._windowParent.closed)throw new j("InvalidStateError","Parent window of 'child' parameter is in the closed state and therefore is invalid",DOMException.INVALID_STATE_ERR);
b=e._windowParent?e._windowParent.properties.id:b;c=e.position}else c=0<c?c-1:c;a._windowParent&&(a._oldWindowParent=a._windowParent,a._oldIndex=a.properties.index,a._oldWindowParent!==this&&a._windowParent.tabs.removeTab(a));a._windowParent=this;a.properties.index=c;this!==a._oldWindowParent&&this.tabs.addTab(a,a.properties.index);k.enqueue(a,function(e){chrome.tabs.move(a.properties.id,{windowId:b||this.properties.id,index:c},function(){e()}.bind(this))}.bind(this))}};p.prototype.focus=function(){if(!(!0==
this.properties.focused||!0==this.properties.closed)){this.properties.focused=!0;for(var a=0,e=h.windows.length;a<e;a++)h.windows[a]!==this&&(h.windows[a].properties.focused=!1);k.enqueue(this,function(a){chrome.windows.update(this.properties.id,{focused:!0},function(){a()}.bind(this))}.bind(this))}};p.prototype.update=function(a){var e={};void 0!==a.focused&&!0==a.focused&&(this.properties.focused=e.focused=!!a.focused);void 0!==a.top&&null!==a.top&&(this.properties.top=e.top=parseInt(a.top,10));
void 0!==a.left&&null!==a.left&&(this.properties.left=e.left=parseInt(a.left,10));void 0!==a.height&&null!==a.height&&(this.properties.height=e.height=parseInt(a.height,10));void 0!==a.width&&null!==a.width&&(this.properties.width=e.width=parseInt(a.width,10));U(e)||k.enqueue(this,function(a){chrome.windows.update(this.properties.id,e,function(){a()}.bind(this))}.bind(this))};p.prototype.close=function(){!0!=this.properties.closed&&(this.properties.closed=!0,k.enqueue(this,function(a){this.properties.id&&
chrome.windows.remove(this.properties.id,function(){a()}.bind(this))}.bind(this)))};var s=function(a){r.call(this);this.length=0;this._parent=a;this.replaceTabs=function(a){for(var b=0,c=this.length;b<c;b++)delete this[b];this.length=0;if(!(0>=a.length)){b=0;for(c=a.length;b<c;b++)this!==h.tabs&&(a[b].properties.index=b),this[b]=a[b];this.length=a.length;for(var d=!1,b=0,c=a.length;b<c;b++)if(!0==a[b].properties.active){d=!0;break}d||a[0].focus()}};this.addTab=function(a,b){for(var c=[],d=0,f=this.length;d<
f;d++)c[d]=this[d],!0==c[d].properties.active&&(focusFound=!0);!0==a.properties.active&&a.focus();d=void 0!==b?b:c.length;c.splice(this!==h.tabs?d:this.length,0,a);d=0;for(f=c.length;d<f;d++)this!==h.tabs&&(c[d].properties.index=d),this[d]=c[d];this.length=c.length};this.removeTab=function(a){for(var b=this.length,c=[],d=-1,f=0,g=this.length;f<g;f++)c[f]=this[f],c[f].id==a.id&&(d=f);-1<d&&c.splice(d,1);f=0;for(g=c.length;f<g;f++)this!==h.tabs&&(c[f].properties.index=f),this[f]=c[f];this.length=c.length;
if(b>this.length){f=this.length;for(g=b;f<g;f++)delete this[f]}}};s.prototype=Object.create(w.prototype);s.prototype.create=function(a,e){if(e&&!(e instanceof l))throw new j("TypeMismatchError","Could not create BrowserTab object. 'before' attribute provided is invalid.",DOMException.TYPE_MISMATCH_ERR);if(this._parent&&!0===this._parent.closed)throw new j("InvalidStateError","Parent window of the current BrowserTab object is in the closed state and therefore is invalid.",DOMException.INVALID_STATE_ERR);
var b=new l(a,this._parent||h.windows.getLastFocused()),c={url:b.properties.url,active:b.properties.active,pinned:b.properties.pinned};b.properties.index=c.index=b._windowParent.tabs.length;if(e&&e instanceof l){if(!0===e.closed)throw new j("InvalidStateError","'before' BrowserTab object is in the closed state and therefore is invalid.",DOMException.INVALID_STATE_ERR);if(e._windowParent&&!0===e._windowParent.closed)throw new j("InvalidStateError","Parent window of 'before' BrowserTab object is in the closed state and therefore is invalid.",
DOMException.INVALID_STATE_ERR);c.windowId=e._windowParent?e._windowParent.properties.id:c.windowId;c.index=e.position}this===h.tabs&&(b._windowParent=h.windows.getLastFocused(),b.properties.index=c.index=b._windowParent.tabs.length);b._windowParent.tabs.addTab(b,b.properties.index);if(!0==b.properties.active)for(var d=0,f=b._windowParent.tabs.length;d<f;d++)b._windowParent.tabs[d]!==b&&(b._windowParent.tabs[d].properties.active=!1);h.tabs.addTab(b);k.enqueue(this,function(a){chrome.tabs.create(c,
function(e){for(var c in e)c!="url"&&(b.properties[c]=e[c]);if(this!==h.tabs){this.removeTab(b);this.addTab(b,b.properties.index)}b.resolve(true);a()}.bind(this))}.bind(this),!0);m.setTimeout(function(){b._windowParent.tabs.dispatchEvent(new i("create",{tab:b,prevWindow:null,prevTabGroup:null,prevPosition:0}));h.tabs.dispatchEvent(new i("create",{tab:b,prevWindow:null,prevTabGroup:null,prevPosition:0}))},50);return b};s.prototype.getAll=function(){for(var a=[],e=0,b=this.length;e<b;e++)a[e]=this[e];
return a};s.prototype.getSelected=function(){for(var a=0,e=this.length;a<e;a++)if(!0==this[a].focused)return this[a];this[0]&&(this[0].properties.active=!0);return this[0]||void 0};s.prototype.getFocused=s.prototype.getSelected;s.prototype.close=function(a){if(!a||!(a instanceof l))throw new j("TypeMismatchError","Expected browserTab argument to be of type BrowserTab.",DOMException.TYPE_MISMATCH_ERR);a.close()};var Z=function(){function a(a,b){if(!this._blackList[a]){for(var c=h.windows,d=0,f=c.length;d<
f;d++)c[d].rewriteUrl&&c[d].rewriteUrl=="chrome://newtab/#"+a&&(c[d].properties.id=b.windowId,c[d].resolve(!0),c[d].tabs.resolve(!0),delete c[d].rewriteUrl);c=-1;d=0;for(f=this._allTabs.length;d<f;d++)if(this._allTabs[d].properties.id==a){c=d;break}if(!(0>c)){if(d=this._allTabs[c])d._oldWindowParent?d._oldWindowParent.tabs.removeTab(d):d._windowParent.tabs.removeTab(d),d.properties.index=b.toIndex,d._windowParent.tabs.addTab(d,b.toIndex),d.dispatchEvent(new i("move",{tab:d,prevWindow:d._oldWindowParent,
prevTabGroup:null,prevPosition:d._oldIndex})),this.dispatchEvent(new i("move",{tab:d,prevWindow:d._oldWindowParent,prevTabGroup:null,prevPosition:d._oldIndex})),void 0!==d._oldWindowParent&&delete d._oldWindowParent,void 0!==d._oldIndex&&delete d._oldIndex;k.dequeue()}}}s.call(this);this._blackList={};this._allTabs=[];chrome.tabs.onCreated.addListener(function(a){for(var b=-1,c=0,d=this._allTabs.length;c<d;c++){if(this._allTabs[c].rewriteUrl&&this._allTabs[c].properties.url==a.url){if(this._allTabs[c]._windowParent){if(this._allTabs[c]._windowParent.properties.id!==
a.windowId)for(var f=0,d=h.windows.length;f<d;f++)h.windows[f].properties.id==a.windowId&&(this._allTabs[c]._windowParent.tabs.removeTab(this._allTabs[c]),this._allTabs[c]._windowParent=h.windows[f],this._allTabs[c].properties.windowId=a.windowId,k.enqueue(this._allTabs[c],function(a){chrome.tabs.move(this.properties.id,{index:this._windowParent.tabs.length},function(){a()}.bind(this))}.bind(this._allTabs[c])),h.windows[f].tabs.addTab(this._allTabs[c],this._allTabs[c].properties.index));this._allTabs[c]._windowParent.properties.id=
a.windowId;this._allTabs[c]._windowParent.resolve(!0);this._allTabs[c]._windowParent.tabs.resolve(!0)}else throw new j("NoParent","BrowserTab object must have a parent window.");this._allTabs[c].properties.id=a.id;this._allTabs[c].properties.index=a.index;this._allTabs[c].resolve(!0);this._allTabs[c].properties.url=this._allTabs[c].rewriteUrl;delete this._allTabs[c].rewriteUrl;chrome.tabs.update(this._allTabs[c].properties.id,{url:this._allTabs[c].properties.url},function(){});void 0!==this._allTabs[c]._windowParent.rewriteUrl&&
delete this._allTabs[c]._windowParent.rewriteUrl;return}if(this._allTabs[c].properties.id==a.id){b=c;break}}if(0>b){for(var g,b=h.windows,c=0,d=b.length;c<d;c++)if(b[c].rewriteUrl&&b[c].rewriteUrl==a.url&&(b[c].properties.id=a.windowId,b[c].resolve(!0),b[c].tabs.resolve(!0)),void 0!==b[c].properties.id&&b[c].properties.id==a.windowId){g=b[c];break}g||(g=new p,g.properties.id=a.windowId,h.windows.addWindow(a.windowId,g),g.resolve(!0),g.tabs.resolve(!0),chrome.windows.get(g.properties.id,{populate:!1},
function(a){for(var b in a)"tabs"!=b&&(g.properties[b]=a[b])}.bind(this)));if(g.rewriteUrl&&0<g.tabs.length)for(f in d=g.tabs[0],a)d.properties[f]=a[f];else d=new l(a,g),d.properties.id=a.id,d.properties.url=a.url,d.properties.title=a.title,d.properties.favIconUrl=a.favIconUrl,d.properties.pinned=a.pinned,d.properties.incognito=a.incognito,d.properties.status=a.status,d.properties.index=a.index,!0==a.active&&d.focus(),d._windowParent.tabs.addTab(d,d.properties.index),this.addTab(d);d._windowParent.tabs.dispatchEvent(new i("create",
{tab:d,prevWindow:null,prevTabGroup:null,prevPosition:0}));h.tabs.dispatchEvent(new i("create",{tab:d,prevWindow:null,prevTabGroup:null,prevPosition:0}))}else for(c in d=this[b],a)"url"!=c&&(d.properties[c]=a[c]);void 0!==d._windowParent.rewriteUrl&&delete d._windowParent.rewriteUrl;void 0!==d.rewriteUrl&&(d.url=d.rewriteUrl,delete d.rewriteUrl);d.resolve(!0);k.dequeue()}.bind(this));chrome.tabs.onRemoved.addListener(function(a){if(!this._blackList[a]){for(var b=-1,c=0,d=this._allTabs.length;c<d;c++)if(this._allTabs[c].properties.id==
a){b=c;break}if(!(0>b)){a=this._allTabs[b];c=a._oldWindowParent;b=a._oldIndex||a.properties.index;if(!c&&void 0!==a._windowParent&&null!==a._windowParent){a.properties.closed=!0;a._windowParent.tabs.removeTab(a);this.removeTab(a);c=0;for(d=a._windowParent.tabs.length;c<d;c++)!0==a._windowParent.tabs[c].properties.active?a._windowParent.tabs[c].focus():a._windowParent.tabs[c].properties.active=!1;a.properties.index=NaN;c=a._windowParent;a._windowParent=null}a.dispatchEvent(new i("close",{tab:a,prevWindow:c,
prevTabGroup:null,prevPosition:b}));c&&c.tabs.dispatchEvent(new i("close",{tab:a,prevWindow:c,prevTabGroup:null,prevPosition:b}));this.dispatchEvent(new i("close",{tab:a,prevWindow:c,prevTabGroup:null,prevPosition:b}));k.dequeue()}}}.bind(this));chrome.tabs.onUpdated.addListener(function(a,b,c){for(var b=-1,d=0,f=this._allTabs.length;d<f;d++)if(this._allTabs[d].properties.id==a){b=d;break}0>b||(a=this._allTabs[b],a.properties.url=c.url,a.properties.title=c.title,a.properties.favIconUrl=c.favIconUrl,
a.properties.status=c.status,a.properties.pinned=c.pinned,a.properties.incognito=c.incognito,a.properties.index=c.index,!0==c.active&&!1==a.properties.active&&a.focus(),k.dequeue())}.bind(this));chrome.tabs.onMoved.addListener(a.bind(this));chrome.tabs.onAttached.addListener(function(e,b){for(var c=-1,d=0,f=this._allTabs.length;d<f;d++)if(this._allTabs[d].properties.id==e){c=d;break}if(!(0>c)){c=this._allTabs[c];c._oldWindowParent&&c._oldWindowParent.tabs.removeTab(c);d=0;for(f=h.windows.length;d<
f;d++)if(h.windows[d].properties.id==b.newWindowId){c._windowParent=h.windows[d];break}d={windowId:b.newWindowId,toIndex:b.newPosition};a.bind(this).call(this,e,d)}}.bind(this));chrome.tabs.onDetached.addListener(function(a){for(var b=-1,c=0,d=this._allTabs.length;c<d;c++)if(this._allTabs[c].properties.id==a){b=c;break}if(!(0>b)){if(a=this._allTabs[b])a._oldWindowParent=a._windowParent,a._oldIndex=a.position;k.dequeue()}}.bind(this));chrome.tabs.onActivated.addListener(function(a){if(!this._blackList[a.tabId]&&
a.tabId){for(var b,c,d=0,f=this._allTabs.length;d<f;d++)if(this._allTabs[d].properties.id==a.tabId&&(this._allTabs[d].properties.active=!0,c=this._allTabs[d],this._allTabs[d]._windowParent))for(var g=0,j=this._allTabs[d]._windowParent.tabs.length;g<j;g++)this._allTabs[d]._windowParent.tabs[g]!==this._allTabs[d]&&(!0==this._allTabs[d]._windowParent.tabs[g].properties.active&&(b=this._allTabs[d]._windowParent.tabs[g]),this._allTabs[d]._windowParent.tabs[g].properties.active=!1);c&&h.tabs.dispatchEvent(new i("blur",
{tab:c,prevWindow:c._windowParent,prevTabGroup:null,prevPosition:c.properties.index}));b&&h.tabs.dispatchEvent(new i("focus",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:b.properties.index}));k.dequeue()}}.bind(this));h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action&&"___O_getScreenshot_REQUEST"===a.data.action&&a.source.tabId){for(var b=null,c=0,d=this._allTabs.length;c<d;c++)if(this._allTabs[c].properties.id==a.source.tabId){b=this._allTabs[c];break}if(null!==
b&&b._windowParent&&!0!=b._windowParent.properties.closed)try{chrome.tabs.captureVisibleTab(b._windowParent.properties.id,{},function(b){a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:b||null})}.bind(this))}catch(f){}else a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:void 0})}}.bind(this))};Z.prototype=Object.create(s.prototype);for(q in s.prototype)s.prototype.hasOwnProperty(q)&&(Z.prototype[q]=s.prototype[q]);var l=function(a,e,b){if(!e)throw new j("Parent missing",
"BrowserTab objects can only be created with a window parent provided");r.call(this);this._windowParent=e;a=a||{};this.properties={id:void 0,closed:!1,pinned:a.locked?!!a.locked:!1,incognito:!1,active:a.focused?!!a.focused:!1,status:"loading",favIconUrl:"",title:"",url:a.url?a.url+"":"chrome://newtab",index:a.position?parseInt(a.position,10):0};this._operaId=Math.floor(1E16*Math.random());b||(this.rewriteUrl=this.properties.url,this.properties.url="chrome://newtab/#"+this._operaId);!0==this.properties.active&&
this.focus();h.tabs._allTabs.push(this)};l.prototype=Object.create(w.prototype);l.prototype.__defineGetter__("id",function(){return this._operaId});l.prototype.__defineGetter__("closed",function(){return void 0!==this.properties.closed?!!this.properties.closed:!1});l.prototype.__defineGetter__("locked",function(){return void 0!==this.properties.pinned?!!this.properties.pinned:!1});l.prototype.__defineGetter__("focused",function(){return void 0!==this.properties.active?!!this.properties.active:!1});
l.prototype.__defineSetter__("focused",function(a){this.properties.active=!!a;!0==this.properties.active&&this.focus()});l.prototype.__defineGetter__("selected",function(){return void 0!==this.properties.active?!!this.properties.active:!1});l.prototype.__defineSetter__("selected",function(a){this.properties.active=!!a;!0==this.properties.active&&this.focus()});l.prototype.__defineGetter__("private",function(){return void 0!==this.properties.incognito?!!this.properties.incognito:!1});l.prototype.__defineGetter__("faviconUrl",
function(){return this.properties.closed?"":this.properties.favIconUrl||""});l.prototype.__defineGetter__("title",function(){return this.properties.closed?"":this.properties.title||""});l.prototype.__defineGetter__("url",function(){return this.properties.closed?"":this.rewriteUrl?this.rewriteUrl:this.properties.url||""});l.prototype.__defineSetter__("url",function(a){this.properties.url=a+"";k.enqueue(this,function(a){chrome.tabs.update(this.properties.id,{url:this.properties.url},function(){a()}.bind(this))}.bind(this))});
l.prototype.__defineGetter__("readyState",function(){return void 0!==this.properties.status?this.properties.status:"loading"});l.prototype.__defineGetter__("browserWindow",function(){return this._windowParent});l.prototype.__defineGetter__("tabGroup",function(){return null});l.prototype.__defineGetter__("position",function(){return void 0!==this.properties.index?this.properties.index:NaN});l.prototype.focus=function(){if(!(!0==this.properties.active||!0==this.properties.closed)){this.properties.active=
!0;if(this._windowParent)for(var a=0,e=this._windowParent.tabs.length;a<e;a++)this._windowParent.tabs[a]!==this&&(this._windowParent.tabs[a].properties.active=!1);k.enqueue(this,function(a){chrome.tabs.update(this.properties.id,{active:!0},function(){a()}.bind(this))}.bind(this))}};l.prototype.update=function(a){if(!0==this.properties.closed)throw new j("InvalidStateError","The current BrowserTab object is closed. Cannot call 'update' on this object.",DOMException.INVALID_STATE_ERR);if(U(a||{}))throw new j("TypeMismatchError",
"You must provide some valid properties to update a BrowserTab object",DOMException.TYPE_MISMATCH_ERR);var e={};if(void 0!==a.focused&&!0==a.focused&&(this.properties.active=e.active=!!a.focused,this._windowParent))for(var b=0,c=this._windowParent.tabs.length;b<c;b++)this._windowParent.tabs[b]!=this&&(this._windowParent.tabs[b].properties.active=!1);void 0!==a.locked&&null!==a.locked&&(this.properties.pinned=e.pinned=!!a.locked);void 0!==a.url&&null!==a.url&&(this.rewriteUrl?this.rewriteUrl=e.url=
a.url:this.properties.url=e.url=a.url);U(e)||k.enqueue(this,function(a){chrome.tabs.update(this.properties.id,e,function(){a()}.bind(this))}.bind(this))};l.prototype.refresh=function(){!0!==this.properties.closed&&k.enqueue(this,function(a){this.properties.status="loading";this.properties.title=void 0;chrome.tabs.reload(this.properties.id,{bypassCache:!0},function(){a()}.bind(this))}.bind(this))};l.prototype.postMessage=function(a){if(!0===this.properties.closed)throw new j("InvalidStateError","The current BrowserTab object is in the closed state and therefore is invalid.",
DOMException.INVALID_STATE_ERR);k.enqueue(this,function(e){chrome.tabs.sendMessage(this.properties.id,a,function(){e()}.bind(this))}.bind(this))};l.prototype.getScreenshot=function(a){if(!0===this.properties.closed)throw new j("InvalidStateError","The current BrowserTab object is in the closed state and therefore is invalid.",DOMException.INVALID_STATE_ERR);if(!this._windowParent||!0===this._windowParent.properties.closed)a.call(this,void 0);else try{k.enqueue(this,function(b){chrome.tabs.captureVisibleTab(this._windowParent.properties.id,
{},function(c){if(c){var d=document.createElement("canvas"),e=d.getContext("2d"),g=new Image;g.onload=function(){d.width=g.width;d.height=g.height;e.drawImage(g,0,0);var b=e.getImageData(0,0,d.width,d.height);a.call(this,b)}.bind(this);g.src=c}else a.call(this,void 0);b()}.bind(this))}.bind(this))}catch(e){}};l.prototype.close=function(){!0!=this.properties.closed&&!0!=this.properties.pinned&&(this.properties.closed=!0,this.properties.active=!1,this._oldWindowParent=this._windowParent,this._oldIndex=
this.properties.index,this.properties.index=void 0,this._oldWindowParent&&this._oldWindowParent.tabs.removeTab(this),h.tabs.removeTab(this),k.enqueue(this,function(a){this.properties.id&&chrome.tabs.remove(this.properties.id,function(){a()}.bind(this))}.bind(this)))};var M=function(a){E.mixin(this);this._parent=a;this.length=0};M.prototype=Object.create(n.prototype);M.prototype.create=function(){throw new j("NotSupportedError","The current user agent does not support the Tab Groups feature.",DOMException.NOT_SUPPORTED_ERR);
};M.prototype.getAll=function(){return[]};h.windows=h.windows||new o;h.tabs=h.tabs||new Z;h.tabGroups=h.tabGroups||new M;q=function(){E.mixin(this);chrome.browserAction.onClicked.addListener(function(){this[0]&&this[0].dispatchEvent(new i("click",{}));this.dispatchEvent(new i("click",{}))}.bind(this))};q.prototype=Object.create(n.prototype);q.prototype.createItem=function(a){return new t(a)};q.prototype.addItem=function(a){a&&a instanceof t&&(this[0]=a,this.length=1,a.resolve(!0),a.apply(),a.badge.resolve(!0),
a.badge.apply(),a.popup.resolve(!0),a.popup.apply(),chrome.browserAction.enable())};q.prototype.removeItem=function(a){a&&a instanceof t&&(this[0]&&this[0]===a)&&(delete this[0],this.length=0,chrome.browserAction.disable(),a.dispatchEvent(new i("remove",{})),this.dispatchEvent(new i("remove",{})))};var v=function(a){r.call(this);this.properties={};this.properties.textContent=a.textContent;this.properties.backgroundColor=N(a.backgroundColor);this.properties.color=N(a.color);this.properties.display=
a.display};v.prototype=Object.create(w.prototype);v.prototype.apply=function(){chrome.browserAction.setBadgeBackgroundColor({color:this.backgroundColor||"#f00"});"block"===this.display?chrome.browserAction.setBadgeText({text:this.textContent}):chrome.browserAction.setBadgeText({text:""})};v.prototype.__defineGetter__("textContent",function(){return this.properties.textContent});v.prototype.__defineSetter__("textContent",function(a){this.properties.textContent=""+a;"block"===this.properties.display&&
k.enqueue(this,function(e){chrome.browserAction.setBadgeText({text:""+a});e()}.bind(this))});v.prototype.__defineGetter__("backgroundColor",function(){return this.properties.backgroundColor});v.prototype.__defineSetter__("backgroundColor",function(a){this.properties.backgroundColor=N(""+a);k.enqueue(this,function(a){chrome.browserAction.setBadgeBackgroundColor({color:this.properties.backgroundColor});a()}.bind(this))});v.prototype.__defineGetter__("color",function(){return this.properties.color});
v.prototype.__defineSetter__("color",function(a){this.properties.color=N(""+a)});v.prototype.__defineGetter__("display",function(){return this.properties.display});v.prototype.__defineSetter__("display",function(a){"block"===(""+a).toLowerCase()?(this.properties.display="block",k.enqueue(this,function(a){chrome.browserAction.setBadgeText({text:this.properties.textContent});a()}.bind(this))):(this.properties.display="none",k.enqueue(this,function(a){chrome.browserAction.setBadgeText({text:""});a()}.bind(this)))});
var x=function(a){r.call(this);this.properties={};this.properties.href=a.href||"";this.properties.width=a.width;this.properties.height=a.height};x.prototype=Object.create(w.prototype);x.prototype.apply=function(){chrome.browserAction.setPopup({popup:this.href})};x.prototype.__defineGetter__("href",function(){return this.properties.href});x.prototype.__defineSetter__("href",function(a){this.properties.href=""+a;k.enqueue(this,function(e){chrome.browserAction.setPopup({popup:""+a});e()}.bind(this))});
x.prototype.__defineGetter__("width",function(){return this.properties.width});x.prototype.__defineSetter__("width",function(a){this.properties.width=a});x.prototype.__defineGetter__("height",function(){return this.properties.height});x.prototype.__defineSetter__("height",function(a){this.properties.height=a});var t=function(a){r.call(this);this.properties={};this.properties.disabled=a.disabled||!1;this.properties.title=a.title||"";this.properties.icon=a.icon||"";this.properties.popup=new x(a.popup||
{});this.properties.badge=new v(a.badge||{})};t.prototype=Object.create(w.prototype);t.prototype.apply=function(){!0===this.disabled?chrome.browserAction.disable():chrome.browserAction.enable();chrome.browserAction.setTitle({title:this.title});chrome.browserAction.setIcon({path:this.icon})};t.prototype.__defineGetter__("disabled",function(){return this.properties.disabled});t.prototype.__defineSetter__("disabled",function(a){this.properties.disabled!==a&&(!0===a||"true"===a||1===a||"1"===a?(this.properties.disabled=
!0,k.enqueue(this,function(a){chrome.browserAction.disable();a()}.bind(this))):(this.properties.disabled=!1,k.enqueue(this,function(a){chrome.browserAction.enable();a()}.bind(this))))});t.prototype.__defineGetter__("title",function(){return this.properties.title});t.prototype.__defineSetter__("title",function(a){this.properties.title=""+a;k.enqueue(this,function(a){chrome.browserAction.setTitle({title:this.title});a()}.bind(this))});t.prototype.__defineGetter__("icon",function(){return this.properties.icon});
t.prototype.__defineSetter__("icon",function(a){this.properties.icon=""+a;k.enqueue(this,function(a){chrome.browserAction.setIcon({path:this.icon});a()}.bind(this))});t.prototype.__defineGetter__("popup",function(){return this.properties.popup});t.prototype.__defineGetter__("badge",function(){return this.properties.badge});L.toolbar=L.toolbar||new q;var A=function(a,e,b){for(var c=null,d=h.tabs.getAll(),f=0;f<d.length;f++)d[f].properties.id==e.tab.id&&d[f].browserWindow.properties.id==e.tab.windowId&&
(c=d[f]);a="click"==a?i(a,{documentURL:e.info.pageUrl,pageURL:e.info.pageUrl,isEditable:e.info.editable,linkURL:e.info.linkUrl||null,mediaType:e.info.mediaType||null,selectionText:e.info.selectionText||null,source:c,srcURL:e.info.srcUrl||null}):i(a,e);Object.defineProperty(a,"target",{enumerable:!0,configurable:!1,get:function(){return b||null},set:function(){}});return a};A.prototype=Object.create(aa.prototype);var fa=function(){var a={};E.mixin(a);var e=null;Object.defineProperty(this,"onclick",
{enumerable:!0,configurable:!1,get:function(){return e},set:function(a){null!=e&&this.removeEventListener("click",e,!1);e=a;null!=e&&e instanceof Function?this.addEventListener("click",e,!1):e=null}});Object.defineProperty(this,"dispatchEvent",{enumerable:!1,configurable:!1,writable:!1,value:function(b){var c=this,d=!1;Object.defineProperty(b,"currentTarget",{enumerable:!0,configurable:!1,get:function(){return c},set:function(){}});Object.defineProperty(b,"stopImmediatePropagation",{enumerable:!0,
configurable:!1,writable:!1,value:function(){d=!0}});var e=O(a)[b.type],g,h;if(e)for(var i=0,j=e.length;i<j;i++)g=e[i],h=g[0],g=g[1],d||h.call(g,b)}});Object.defineProperty(this,"addEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,c){a.on(b,c,this)}});Object.defineProperty(this,"removeEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,c){a.off(b,c,this)}})},J=function(a){if(a!==y)throw new j("NotSupportedError","NOT_SUPPORTED_ERR",DOMException.NOT_SUPPORTED_ERR);
fa.call(this);var e=0;Object.defineProperty(this,"length",{enumerable:!0,configurable:!1,get:function(){return e},set:function(){}});Object.defineProperty(this,"addItem",{enumerable:!0,configurable:!1,writable:!1,value:function(a,c){if(this instanceof B&&0<this.length)throw new j("NotSupportedError","NOT_SUPPORTED_ERR",DOMException.NOT_SUPPORTED_ERR);if(!a||!(a instanceof G))throw new j("TypeMismatchError","TYPE_MISMATCH_ERR",DOMException.TYPE_MISMATCH_ERR);if(this instanceof G&&"folder"!=this.type)throw new j("TypeMismatchError",
"TYPE_MISMATCH_ERR",DOMException.TYPE_MISMATCH_ERR);if(-1==Array.prototype.indexOf.apply(this,[a])){if(void 0===c||this instanceof B)c=this.length;else if(c instanceof G){var d=Array.prototype.indexOf.apply(this,[c]);if(c.parent!=this||-1==d)throw new j("HierarchyRequestError","HIERARCHY_REQUEST_ERR",DOMException.HIERARCHY_REQUEST_ERR);c=d}else null===c?c=this.length:(d=Number(c),d=0>d?Math.ceil(d):Math.floor(d),c=d-Math.floor(d/Math.pow(2,32))*Math.pow(2,32));isNaN(c)&&(c=0);for(var d=this,f=!1;!f;)if(d instanceof
B||null==d)f=!0;else{if(d===a)throw new j("HierarchyRequestError","HIERARCHY_REQUEST_ERR",DOMException.HIERARCHY_REQUEST_ERR);d=d.parent}Array.prototype.splice.apply(this,[c,0,a]);e+=1;this instanceof B?a.dispatchEvent(new A("change",{properties:{parent:this}},a)):this.dispatchEvent(new A("change",{properties:{parent:this}},a))}}});Object.defineProperty(this,"removeItem",{enumerable:!0,configurable:!1,writable:!1,value:function(a){if(void 0===a)throw new j("TypeMismatchError","TYPE_MISMATCH_ERR",
DOMException.TYPE_MISMATCH_ERR);0>a||(a>=e||void 0==this[a])||(this[a].dispatchEvent(new A("change",{properties:{parent:null}},this[a])),Array.prototype.splice.apply(this,[a,1]),e-=1)}});Object.defineProperty(this,"item",{enumerable:!0,configurable:!1,writable:!1,value:function(a){return this[a]||null}})};J.prototype=Object.create(fa.prototype);var G=function(a,e){J.apply(this,[a]);var b=this,c=!1,d=null,f={id:"",type:"entry",contexts:["page"],disabled:!1,title:"",icon:"",documentURLPatterns:null,
targetURLPatterns:null,parent:null},g="all page frame selection link editable image video audio".split(" "),h=function(){c||b.dispatchEvent(new A("change",{},b))},i=function(a){if(!c){c=!0;if(void 0!=a)for(var e in a)if(void 0!==f[e])if("type"===e)-1!=["entry","folder","line"].indexOf(String(a.type).toLowerCase())&&(f.type=String(a.type));else if("parent"===e)if(null===a.parent||a.parent instanceof J)f.parent=a.parent;else throw new TypeError;else"id"===e?f.id=String(a.id):b[e]=a[e];c=!1;!0==f.disabled||
null==f.parent?null!=d&&(chrome.contextMenus.remove(d),d=null):(a={title:0==f.title.length?chrome.app.getDetails().name:f.title,type:"line"==f.type.toLowerCase()?"separator":"normal"},e=f.contexts.join(",").toLowerCase().split(",").filter(function(a){return-1!=g.indexOf(a.toLowerCase())}),a.contexts=0==e.length?["page"]:e,f.parent instanceof G&&void 0!=f.parent.menuItemId&&(a.parentId=f.parent.menuItemId),null==d)?(""!=f.id&&(a.id=f.id),d=chrome.contextMenus.create(a)):chrome.contextMenus.update(d,
a)}},j=function(){};Object.defineProperty(b,"id",{enumerable:!0,configurable:!1,get:function(){return f.id},set:j});Object.defineProperty(b,"type",{enumerable:!0,configurable:!1,get:function(){return f.type},set:j});Object.defineProperty(b,"contexts",{enumerable:!0,configurable:!1,get:function(){return f.contexts},set:function(a){if(!Array.isArray(a))throw new TypeError;f.contexts=0==a.length?a:a.join(",").split(",");h()}});Object.defineProperty(b,"disabled",{enumerable:!0,configurable:!1,get:function(){return f.disabled},
set:function(a){f.disabled=Boolean(a);h()}});Object.defineProperty(b,"title",{enumerable:!0,configurable:!1,get:function(){return f.title},set:function(a){f.title=String(a);h()}});Object.defineProperty(b,"icon",{enumerable:!0,configurable:!1,get:function(){return f.icon},set:function(a){"string"===typeof a&&(f.icon=a,-1==f.icon.indexOf(":")&&(-1==f.icon.indexOf("/")&&0<f.icon.length)&&(f.icon="/"+f.icon));h()}});Object.defineProperty(b,"documentURLPatterns",{enumerable:!0,configurable:!1,get:function(){return f.documentURLPatterns},
set:function(a){if(Array.isArray(a)){f.documentURLPatterns=[];for(var b=0;b<a.length;b++)f.documentURLPatterns.push(String(a[b]).toLowerCase())}h()}});Object.defineProperty(b,"targetURLPatterns",{enumerable:!0,configurable:!1,get:function(){return f.targetURLPatterns},set:function(a){if(Array.isArray(a)){f.targetURLPatterns=[];for(var b=0;b<a.length;b++)f.targetURLPatterns.push(String(a[b]).toLowerCase())}h()}});Object.defineProperty(b,"menuItemId",{enumerable:!1,configurable:!1,get:function(){return d},
set:j});Object.defineProperty(b,"parent",{enumerable:!0,configurable:!1,get:function(){return f.parent},set:j});void 0!=e&&i(e);void 0!=e.onclick&&(this.onclick=e.onclick);"entry"===this.type.toLowerCase()&&chrome.contextMenus.onClicked.addListener(function(a,b){if(this.menuItemId!=null&&(this.menuItemId===a.menuItemId||this.id===a.menuItemId)){this.dispatchEvent(new A("click",{info:a,tab:b},this));var c=new A("click",{info:a,tab:b},this);L.menu.dispatchEvent(c);c.source.postMessage({action:"___O_MenuItem_Click",
info:a,menuItemId:this.id})}}.bind(this));this.addEventListener("change",function(a){a.target===this?i(a.properties):i();for(var b=0;b<this.length;b++)this[b].dispatchEvent(new A("change",{properties:a.properties},a.target))},!1);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuItem]"}})};G.prototype=Object.create(J.prototype);m.MenuItem=G;var B=function(a){chrome.contextMenus.removeAll();J.apply(this,[a]);Object.defineProperty(this,
"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuContext]"}})};B.prototype=Object.create(J.prototype);B.prototype.createItem=function(a){return new G(y,a)};m.MenuContext=B;L.menu=L.menu||new B(y);if(m.opera)H=!0,z.isReady=function(a){a.call(z);for(var a=0,e=D.length;a<e;a++){var b=D[a];b.target[b.methodName].apply(b.target,b.args)}D=[]};else{q=function(a,e){var b=a.addEventListener;a.addEventListener=function(c,d,f){c.toLowerCase()===e.toLowerCase()?void 0===
d||(null===d||"[object Function]"!==Object.prototype.toString.call(d))||(H?d.call(m):C[e.toLowerCase()].push(d)):b.call(a,c,d,f)};a.__defineSetter__("on"+e.toLowerCase(),function(b){a.addEventListener(e.toLowerCase(),b,!1)})};var ga=function(a,e){for(var b=a.toLowerCase(),c=new i(b,{}),d=0,f=C[b].length;d<f;d++)C[b][d].call(e,c);C[b]=[]},C={isready:[],domcontentloaded:[],load:[]},ha=!1,S=!1;m.document.addEventListener("DOMContentLoaded",function e(){ha=!0;m.document.removeEventListener("DOMContentLoaded",
e,!0)},!0);m.addEventListener("load",function b(){S=!0;m.removeEventListener("load",b,!0)},!0);q(m,"load");q(m.document,"domcontentloaded");q(m,"domcontentloaded");var la=(new Date).getTime()+3E3;(function c(){if((new Date).getTime()>=la)console.warn("opera.isReady check timed out"),S=!0;else for(var d in K)if(!0!==K[d]){m.setTimeout(function(){c()},20);return}m.setTimeout(function(){if(!H){for(var c=0,d=C.isready.length;c<d;c++)C.isready[c].call(m);C.isready=[];var h=(new Date).getTime()+3E3;(function ia(){var c=
(new Date).getTime();if(ha||S||c>=h){ga("domcontentloaded",m.document);c>=h&&console.warn("document.domcontentloaded event fired on check timeout");var d=(new Date).getTime()+3E3;(function ja(){var c=(new Date).getTime();if(S||c>=d){ga("load",window);c>=d&&console.warn("window.load event fired on check timeout");for(var c=0,f=D.length;c<f;c++){var g=D[c];g.target[g.methodName].apply(g.target,g.args)}D=[]}else m.setTimeout(function(){ja()},50)})()}else m.setTimeout(function(){ia()},50)})();H=!0}},
0)})();z.isReady=function(c){H?c.call(m):C.isready.push(c)}}m.opera=z}(window);
