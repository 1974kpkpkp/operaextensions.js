// operaextensions_background.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(m){function I(a,c,b){y?a[c].apply(a,b):w.push({target:a,methodName:c,args:b})}function E(a,c){function b(a,c,b){0>b&&(b+=1);1<b&&(b-=1);return b<1/6?a+6*(c-a)*b:0.5>b?c:b<2/3?a+6*(c-a)*(2/3-b):a}function e(a){a=parseInt(a,10);a=a.toString(16);return 0==a?"00":a}if(void 0===a||null===a)return a;var a=a+"",d={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,
235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,
50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,
128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,
160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,
21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,
230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,
130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}[a.toLowerCase()];if(d)return"#"+e(d[0])+e(d[1])+e(d[2]);var d={hexLong:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hexShort:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},f;for(f in d)if(a.match(d[f]))return a;f=[["rgb",/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/],["rgb",/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsl",/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/],
["hsl",/^hsla\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%,\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsv",/^hsv\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/]];for(var d={rgb:function(a){return[a[1],a[2],a[3],a[4]||1]},hsl:function(a){var c=parseInt(a[1],10)%360/360,e=parseInt(a[2],10)%101/100,d=parseInt(a[3],10)%101/100,a=a[4]||1;if(0===e)return[d,d,d];e=0.5>d?d*(1+e):d+e-d*e;d=2*d-e;return[(256*b(d,e,c+1/3)).toFixed(0),(256*b(d,e,c)).toFixed(0),(256*b(d,e,c-1/3)).toFixed(0),a]},hsv:function(a){var c,b,e,d=parseInt(a[1],
10)%360/360,f=parseInt(a[2],10)%101/100,a=parseInt(a[3],10)%101/100,h=Math.floor(6*d),g=6*d-h,d=a*(1-f),i=a*(1-g*f),f=a*(1-(1-g)*f);switch(h%6){case 0:c=a;b=f;e=d;break;case 1:c=i;b=a;e=d;break;case 2:c=d;b=a;e=f;break;case 3:c=d;b=i;e=a;break;case 4:c=f;b=d;e=a;break;case 5:c=a,b=d,e=i}return[256*c,256*b,256*e]}},h=0,g=f.length;h<g;h++){var i=f[h][1].exec(a);if(i)return f=d[f[h][0]](i),d=parseFloat(f[3]||1),f="NaN"===d+""||0>d||1<=d?f:0==d?[255,255,255]:[d*parseInt(f[0],10)+(1-d)*(c||255),d*parseInt(f[1],
10)+(1-d)*(c||255),d*parseInt(f[2],10)+(1-d)*(c||255)],"#"+e(f[0]||255)+e(f[1]||255)+e(f[2]||255)}return"#f00"}var i=function(){};i.prototype.REVISION="1";i.prototype.version=function(){return this.REVISION};i.prototype.buildNumber=function(){return this.REVISION};i.prototype.postError=function(a){console.log(a)};var t=m.opera||new i,y=!1,w=[],C={WINTABS_LOADED:!1,WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},z={},i="undefined"!==typeof window?window:{},i=i.MutationObserver||i.WebKitMutationObserver;
if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))i=function(a,c){process.nextTick(function(){a.call(c)})};else if(i){var J=[],i=new i(function(){var a=J.slice();J=[];a.forEach(function(a){a[0].call(a[1])})}),M=document.createElement("div");i.observe(M,{attributes:!0});i=function(a,c){J.push([a,c]);M.setAttribute("drainQueue","drainQueue")}}else i=function(a,c){setTimeout(function(){a.call(c)},1)};z.async=i;var V=z.Event=function(a,c){this.type=a;for(var b in c)c.hasOwnProperty(b)&&
(this[b]=c[b])},N=function(a,c){for(var b=0,e=a.length;b<e;b++)if(a[b][0]===c)return b;return-1},K=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},A=z.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,b){for(var e=K(this),d,f,a=a.split(/\s+/),b=b||this;f=a.shift();)(d=e[f])||(d=e[f]=[]),-1===N(d,c)&&d.push([c,b])},off:function(a,c){for(var b=K(this),e,d,a=a.split(/\s+/);e=a.shift();)c?(e=b[e],d=N(e,c),-1!==d&&
e.splice(d,1)):b[e]=[]},trigger:function(a,c){var b,e,d,f;if(b=K(this)[a])for(var h=0,g=b.length;h<g;h++)e=b[h],d=e[0],e=e[1],"object"!==typeof c&&(c={detail:c}),f=new V(a,c),d.call(e,f)}},B=z.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},O=function(){},P=function(a,c,b,e){var d,f;if(b)try{d=b(e.detail)}catch(h){f=h}else d=e.detail;if(d instanceof B)d.then(function(a){c.resolve(a)},
function(a){c.reject(a)});else if(b&&d)c.resolve(d);else if(f)c.reject(f);else c[a](d)};B.prototype={then:function(a,c){var b=new B;this.on("promise:resolved",function(c){P("resolve",b,a,c)});this.on("promise:failed",function(a){P("reject",b,c,a)});return b},resolve:function(a){z.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=O},reject:function(a){z.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=O}};A.mixin(B.prototype);var k=function(a,c){var b=document.createEvent("Event");b.initEvent(a,!0,!0);for(var e in c)b[e]=c[e];return b},i=function(){A.mixin(this)};i.prototype.constructor=i;i.prototype.addEventListener=function(a,c){this.on(a,c)};i.prototype.removeEventListener=function(a,c){this.off(a,c)};i.prototype.dispatchEvent=function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};var n=function(){B.call(this);
this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};n.prototype=Object.create(B.prototype);for(var o in i.prototype)n.prototype[o]=i.prototype[o];n.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],c=[];if(1<arguments.length)for(var b=1,e=arguments.length;b<e;b++)c.push(arguments[b]);this.resolved?a.apply(this,c):this._queue.push({action:a,args:c})}};n.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,
1),a.action&&a.action.apply(this,a.args))};var F=function(a){A.mixin(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new k("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,b){var e=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new k("controlmessage",
{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}})):I(this,"dispatchEvent",[new k("message",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}})])}.bind(this)),I(this,"dispatchEvent",[new k("connect",{source:this._localPort})]))};F.prototype=Object.create(i.prototype);F.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var G=function(){F.call(this,
!0);this._allPorts=[];chrome.extension.onConnect.addListener(function(a){var c=this._allPorts.length;a.onDisconnect.addListener(function(){this._allPorts.splice(c-1,1);this.dispatchEvent(new k("disconnect",{source:a}))}.bind(this));this._allPorts[c]=a;a.onMessage.addListener(function(b){b&&b.action&&0===b.action.indexOf("___O_")?this.dispatchEvent(new k("controlmessage",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})):I(this,"dispatchEvent",
[new k("message",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})])}.bind(this));this.dispatchEvent(new k("connect",{source:a}))}.bind(this))};G.prototype=Object.create(F.prototype);G.prototype.broadcastMessage=function(a){for(var c=0,b=this._allPorts.length;c<b;c++)this._allPorts[c].postMessage(a)};var l=function(){G.call(this)};l.prototype=Object.create(G.prototype);var j=t.extension=t.extension||new l,Q=t.contexts=t.contexts||{};l.prototype.getFile=
function(a){var c=null;if("string"!=typeof a)return c;try{var b=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(b)?b:"")+a,e=new XMLHttpRequest;e.onloadend=function(){e.readyState==e.DONE&&200==e.status&&(result=e.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},c=result)};e.open("GET",a,!1);e.responseType=
"blob";e.send(null)}catch(d){}return c};var x=function(){Object.defineProperty(this,"_storage",{value:localStorage});Object.defineProperty(this,"length",{value:0,writable:!0});for(var a in localStorage)this[a]=localStorage[a],this.length++;Object.defineProperty(x.prototype,"getItem",{value:function(a){return this._storage.getItem(a)}.bind(this)});Object.defineProperty(x.prototype,"key",{value:function(a){return this._storage.key(a)}.bind(this)});Object.defineProperty(x.prototype,"removeItem",{value:function(a,
b){this._storage.removeItem(a);this.hasOwnProperty(a)&&(delete this[a],this.length--);b||j.postMessage({action:"___O_widgetPreferences_removeItem_RESPONSE",data:{key:a}})}.bind(this)});Object.defineProperty(x.prototype,"setItem",{value:function(a,b,e){var d=this._storage.getItem(a);this._storage.setItem(a,b);this[a]||this.length++;this[a]=b;e||j.postMessage({action:"___O_widgetPreferences_setItem_RESPONSE",data:{key:a,val:b}});a=new k("storage",{key:a,oldValue:d,newValue:this._storage.getItem(a),
url:chrome.extension.getURL(""),storageArea:this._storage});m.dispatchEvent(a)}.bind(this)});Object.defineProperty(x.prototype,"clear",{value:function(a){this._storage.clear();for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||j.postMessage({action:"___O_widgetPreferences_clearItem_RESPONSE"})}.bind(this)})};x.prototype=Object.create(Storage.prototype);l=function(){A.mixin(this);this.properties={};this._preferences=new x;C.WIDGET_PREFERENCES_LOADED=!0;var a=new XMLHttpRequest;
a.open("GET","/manifest.json",!0);a.onreadystatechange=function(){4==a.readyState&&(this.properties=JSON.parse(a.responseText),this.properties.id=/^chrome\-extension\:\/\/(.*)\/$/.exec(chrome.extension.getURL(""))[1],C.WIDGET_API_LOADED=!0)}.bind(this);a.send();j.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_REQUEST":var b={},e;for(e in this.properties)b[e]=this.properties[e];a.source.postMessage({action:"___O_widget_setup_RESPONSE",
attrs:b,_prefs:this._preferences});break;case "___O_widgetPreferences_setItem_REQUEST":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_REQUEST":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_REQUEST":this._preferences.clear(!0)}}.bind(this),!1)};l.prototype=Object.create(i.prototype);l.prototype.__defineGetter__("name",function(){return this.properties.name||""});l.prototype.__defineGetter__("shortName",
function(){return this.properties.name?this.properties.name.short||"":""});l.prototype.__defineGetter__("id",function(){return this.properties.id||""});l.prototype.__defineGetter__("description",function(){return this.properties.description||""});l.prototype.__defineGetter__("author",function(){return this.properties.author?this.properties.author.name||"":""});l.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});l.prototype.__defineGetter__("authorEmail",
function(){return this.properties.author?this.properties.author.email||"":""});l.prototype.__defineGetter__("version",function(){return this.properties.version||""});l.prototype.__defineGetter__("preferences",function(){return this._preferences});m.widget=m.widget||new l;l=function(){n.call(this);this[0]=new p;this.length=1;this._lastFocusedWindow=this[0];chrome.windows.getAll({populate:!0},function(a){var c=[];if(0<a.length){for(var b in a[0])this[0].properties[b]=a[0][b];for(var e=[],d=0,f=a[0].tabs.length;d<
f;d++)e[d]=new g(a[0].tabs[d],this[0]),!0==e[d].properties.active&&!0==this[0].properties.focused&&(this[0].tabs._lastFocusedTab=e[d],j.tabs._lastFocusedTab=e[d]);this[0].tabs.replaceTabs(e);c=c.concat(e)}b=1;for(var h=a.length;b<h;b++){this[b]=new p(a[b]);this.length=b+1;e=[];d=0;for(f=a[b].tabs.length;d<f;d++)e[d]=new g(a[b].tabs[d],this[b]),!0==e[d].properties.active&&!0==this[b].properties.focused&&(this[b].tabs._lastFocusedTab=e[d],j.tabs._lastFocusedTab=e[d]);this[b].tabs.replaceTabs(e);c=c.concat(e)}j.tabs.replaceTabs(c);
chrome.windows.getLastFocused({populate:!1},function(a){for(var b=0,c=this.length;b<c;b++)if(this[b].properties.id===a.id){this._lastFocusedWindow=this[b];break}}.bind(this));this.resolve();j.tabs.resolve();b=0;for(h=this.length;b<h;b++){this[b].resolve();this[b].tabs.resolve();d=0;for(f=this[b].tabs.length;d<f;d++)this[b].tabs[d].resolve()}C.WINTABS_LOADED=!0}.bind(this));chrome.windows.onCreated.addListener(function(a){for(var c=!1,b=0,e=this.length;b<e;b++)if(this[b].properties.id==a.id){c=!0;
this[b].focused&&(this._lastFocusedWindow=this[b]);break}if(!c){c=new p(a);e=[];for(b in a.tabs){var d=new g(a.tabs[b],c);e.push(d)}c.tabs.replaceTabs(e);this[this.length]=c;this.length+=1;c.focused&&(this._lastFocusedWindow=c);c.resolve();c.tabs.resolve();b=0;for(e=c.tabs.length;b<e;b++)c.tabs[b].resolve();this.dispatchEvent(new k("create",{browserWindow:c}))}}.bind(this));chrome.windows.onRemoved.addListener(function(a){for(var c=-1,b=0,e=this.length;b<e;b++)if(this[b].properties.id==a){c=b;break}if(-1<
c){this[c].dispatchEvent(new k("close",{browserWindow:this[c]}));this.dispatchEvent(new k("close",{browserWindow:this[c]}));b=c;for(e=this.length;b<e;b++)this[b+1]&&(this[b]=this[b+1]);delete this[this.length-1];this.length-=1}}.bind(this));chrome.windows.onFocusChanged.addListener(function(a){for(var c=0,b=this.length;c<b;c++)if(this[c]==this._lastFocusedWindow&&this[c].properties.id!=a){this.dispatchEvent(new k("blur",{browserWindow:this[c]}));break}if(a!==chrome.windows.WINDOW_ID_NONE){c=0;for(b=
this.length;c<b;c++)if(this[c].properties.id==a&&this[c]!==this._lastFocusedWindow){this._lastFocusedWindow=this[c];this.dispatchEvent(new k("focus",{browserWindow:this[c]}));break}}}.bind(this))};l.prototype=Object.create(n.prototype);l.prototype.create=function(a,c){var c=c||{},b=new p(c);c.incognito=c.private||!1;this[this.length]=b;this.length+=1;this.enqueue(chrome.windows.create,c,function(c){for(var d in c)b.properties[d]=c[d];var f=[];if(c.tabs){d=0;for(var h=c.tabs.length;d<h;d++){var i=
new g(c.tabs[d],b);f.push(i)}}b.tabs.replaceTabs(f);b.resolve();b.tabs.resolve();if(a)for(d in a)a[d]instanceof g?function(a){chrome.tabs.move(a.properties.id,{index:-1,windowId:c.id},function(b){for(var c in b)a.properties[c]=b[c];a.resolve()})}(a[d]):function(a){var d=new g(a,b);d.properties.windowId=c.id;chrome.tabs.create(d.properties,function(a){for(var b in a)d.properties[b]=a[b];d.resolve()});b.tabs.addTabs([d])}(a[d]);this.dispatchEvent(new k("create",{browserWindow:b}));this.dequeue()}.bind(this));
return b};l.prototype.getAll=function(){for(var a=[],c=0,b=this.length;c<b;c++)a[c]=this[c];return a};l.prototype.getLastFocused=function(){return this._lastFocusedWindow};l.prototype.close=function(a){a&&!(!a instanceof p)&&a.close()};var p=function(a){n.call(this);this.properties=a||{};this._parent=null;this._operaId=Math.floor(1E16*Math.random());this.tabs=new q(this);this.tabGroups=new D(this)};p.prototype=Object.create(n.prototype);p.prototype.__defineGetter__("id",function(){return this._operaId});
p.prototype.__defineGetter__("closed",function(){return this.properties.closed||!1});p.prototype.__defineGetter__("focused",function(){return this.properties.focused||!1});p.prototype.__defineGetter__("private",function(){return this.properties.incognito||!1});p.prototype.__defineGetter__("parent",function(){return this._parent});p.prototype.insert=function(a,c){if(a&&!(!a instanceof g)){if(!0===this.properties.closed)throw{name:"Invalid State Error",message:"Current window is in the closed state and therefore is invalid"};
var b={windowId:this.properties.id};if(c&&c instanceof g){if(!0===c.closed)throw{name:"Invalid State Error",message:"'child' attribute is in the closed state and therefore is invalid"};if(c._windowParent&&!0===c._windowParent.closed)throw{name:"Invalid State Error",message:"Parent window of 'child' attribute is in the closed state and therefore is invalid"};b.windowId=c._windowParent?c._windowParent.properties.id:b.windowId;b.index=c.position}this.enqueue(chrome.tabs.move,a.properties.id,b,function(){this.dequeue()}.bind(this))}};
p.prototype.focus=function(){this.properties.focused=!0;this.enqueue(chrome.windows.update,this.properties.id,{focused:!0},function(){this.dequeue()}.bind(this))};p.prototype.update=function(a){delete a.closed;for(var c in a)this.properties[c]=a[c];this.enqueue(chrome.windows.update,this.properties.id,a,function(){this.dequeue()}.bind(this))};p.prototype.close=function(){this.properties.closed=!0;this.enqueue(function(){chrome.windows.remove(this.properties.id,function(){this.dequeue();j.windows.dequeue()}.bind(this))}.bind(this))};
var q=function(a){n.call(this);this.length=0;this._lastFocusedTab=null;this._parent=a;this.replaceTabs=function(a){for(var b=0,e=this.length;b<e;b++)delete this[b];b=this.length=0;for(e=a.length;b<e;b++)this!==j.tabs&&(a[b].properties.index=b),a[b].properties.closed=!1,this[b]=a[b];this.length=a.length};this.addTabs=function(a,b){for(var e=[],d=0,f=this.length;d<f;d++)e[d]=this[d];d=[b||e.length-1,0].concat(a);Array.prototype.splice.apply(e,d);d=0;for(f=e.length;d<f;d++)this!==j.tabs&&(e[d].properties.index=
d),e[d].properties.closed=!1,this[d]=e[d];this.length=e.length};this.removeTab=function(a){for(var b=this.length,e=[],d=-1,f=0,h=this.length;f<h;f++)e[f]=this[f],e[f].id==a.id&&(d=f);-1<d&&e.splice(d,1);a.properties.closed=!0;a._windowParent=null;f=0;for(h=e.length;f<h;f++)this!==j.tabs&&(e[f].properties.index=f),this[f]=e[f];this.length=e.length;if(b>this.length){f=this.length;for(h=b;f<h;f++)delete this[f]}}};q.prototype=Object.create(n.prototype);q.prototype.create=function(a,c){var a=a||{},b=
new g;void 0!==a.focused?(a.active=!!a.focused,delete a.focused):a.active=!1;void 0!==a.locked&&(a.pinned=!!a.locked,delete a.locked);for(var e in a)b.properties[e]=a[e];if(this._parent&&!0===this._parent.closed)throw{name:"Invalid State Error",message:"Parent window is in the closed state and therefore is invalid"};a.windowId=this._parent?this._parent.properties.id:j.windows.getLastFocused().properties.id;if(c&&c instanceof g){if(!0===c.closed)throw{name:"Invalid State Error",message:"'before' attribute is in the closed state and therefore is invalid"};
if(c._windowParent&&!0===c._windowParent.closed)throw{name:"Invalid State Error",message:"Parent window of 'before' attribute is in the closed state and therefore is invalid"};a.windowId=c._windowParent?c._windowParent.properties.id:a.windowId;a.index=c.position}this.addTabs([b]);this!==j.tabs&&j.tabs.addTabs([b]);this.enqueue(chrome.tabs.create,a,function(a){for(var c in a)b.properties[c]=a[c];var e=true;if(a.windowId){var g=t.extension.windows;c=0;for(var i=g.length;c<i;c++)if(g[c].properties.id===
a.windowId){e=false;b._windowParent=g[c];break}}if(e)b._windowParent=j.windows.getLastFocused();b.resolve(a);this.dispatchEvent(new k("create",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:-1}));this.dequeue()}.bind(this));return b};q.prototype.getAll=function(){for(var a=[],c=0,b=this.length;c<b;c++)a[c]=this[c];return a};q.prototype.getSelected=function(){return this._lastFocusedTab||this[0]};q.prototype.getFocused=q.prototype.getSelected;q.prototype.close=function(a){a&&!(!a instanceof
g)&&a.close()};var L=function(){function a(a,b){for(var e=-1,d=0,f=this.length;d<f;d++)if(this[d].properties.id==a){e=d;break}if(!(0>e)){var h=(e=this[e])?e._windowParent:null;if(e){var g=e.properties.position;if(h){for(var i=-1,d=0,f=h.tabs.length;d<f;d++)if(h.tabs[d].properties.id==a){i=d;break}if(-1<i){d=i;for(f=h.tabs.length;d<f;d++)h.tabs[d+1]&&(h.tabs[d]=h.tabs[d+1]);delete h.tabs[e._windowParent.length-1];h.tabs.length-=1}}d=0;for(f=j.windows.length;d<f;d++)if(j.windows[d].properties.id==(b.windowId||
b.newWindowId)){j.windows[d].tabs.addTabs([e],b.toIndex||b.newPosition);e._windowParent=j.windows[d];break}e.dispatchEvent(new k("move",{tab:e,prevWindow:h,prevTabGroup:null,prevPosition:g}));this.dispatchEvent(new k("move",{tab:e,prevWindow:h,prevTabGroup:null,prevPosition:g}))}}}q.call(this);chrome.tabs.onCreated.addListener(function(a){for(var b=!1,e=0,d=this.length;e<d;e++)if(this[e].properties.id==a.id){b=!0;break}if(!b){for(var b=new g(a),f=!0,h=t.extension.windows,e=0,d=h.length;e<d;e++)if(h[e].properties.id==
a.windowId){f=!1;b._windowParent=h[e];break}f&&(b._windowParent=j.windows.getLastFocused());b._windowParent.tabs.addTabs([b],b.properties.index);b._windowParent.tabs.dispatchEvent(new k("create",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:NaN}));this.addTabs([b]);b.resolve();this.dispatchEvent(new k("create",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:NaN}))}}.bind(this));chrome.tabs.onRemoved.addListener(function(a){for(var b=-1,e=0,d=this.length;e<d;e++)if(this[e].properties.id==
a){b=e;break}-1<b&&(b=(a=this[b])?a._windowParent:null,e=a?a.position:NaN,b&&b.tabs.removeTab(a),this.removeTab(a),a.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:e})),b&&b.tabs.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:e})),this.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:e})))}.bind(this));chrome.tabs.onUpdated.addListener(function(a,b,e){for(var d=-1,f=0,h=this.length;f<h;f++)if(this[f].properties.id==
a){d=f;break}if(!(0>d)){var d=this[d],g;for(g in e)"id"==g||"windowId"==g||(d.properties[g]=e[g]);if(d._windowParent){e=-1;f=0;for(h=d._windowParent.tabs.length;f<h;f++)if(d._windowParent.tabs[f].properties.id==a){e=f;break}if(-1<e)for(f in b)d._windowParent.tabs[e].properties[f]=b[f]}}}.bind(this));chrome.tabs.onMoved.addListener(a.bind(this));chrome.tabs.onAttached.addListener(a.bind(this));chrome.tabs.onActivated.addListener(function(a){if(a.tabId)for(var b=0,e=this.length;b<e;b++)this[b].properties.id==
a.tabId?(this[b].properties.active=!0,this[b]._windowParent&&(this[b]._windowParent.tabs._lastFocusedTab=this[b]),this._lastFocusedTab=this[b]):this[b].properties.active=!1}.bind(this));j.addEventListener("controlmessage",function(a){if(a.data&&a.data.action&&"___O_getScreenshot_REQUEST"===a.data.action&&a.source.tabId){for(var b=null,e=0,d=this.length;e<d;e++)if(this[e].properties.id==a.source.tabId){b=this[e];break}if(null!==b&&b._windowParent&&!0!=b._windowParent.properties.closed)try{chrome.tabs.captureVisibleTab(b._windowParent.properties.id,
{},function(b){a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:b||null})}.bind(this))}catch(f){}else a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:void 0})}}.bind(this))};L.prototype=Object.create(q.prototype);for(o in q.prototype)q.prototype.hasOwnProperty(o)&&(L.prototype[o]=q.prototype[o]);var g=function(a,c){n.call(this);this.properties=a||{};this._windowParent=c;this._operaId=Math.floor(1E16*Math.random())};g.prototype=Object.create(n.prototype);g.prototype.__defineGetter__("id",
function(){return this._operaId});g.prototype.__defineGetter__("closed",function(){return this.properties.closed||!1});g.prototype.__defineGetter__("locked",function(){return this.properties.pinned||!1});g.prototype.__defineGetter__("focused",function(){return this.properties.active||!1});g.prototype.__defineGetter__("selected",function(){return this.properties.active||!1});g.prototype.__defineGetter__("private",function(){return this.properties.incognito||!1});g.prototype.__defineGetter__("faviconUrl",
function(){return this.properties.closed?"":this.properties.favIconUrl||""});g.prototype.__defineGetter__("title",function(){return this.properties.closed?"":this.properties.title||""});g.prototype.__defineGetter__("url",function(){return this.properties.closed?"":this.properties.url||""});g.prototype.__defineGetter__("readyState",function(){return this.properties.status||"loading"});g.prototype.__defineGetter__("browserWindow",function(){return this._windowParent});g.prototype.__defineGetter__("tabGroup",
function(){return null});g.prototype.__defineGetter__("position",function(){return this.properties.index||NaN});g.prototype.focus=function(){this.properties.active=!0;this.enqueue(chrome.tabs.update,this.properties.id,{active:!0},function(){this.dequeue()}.bind(this))};g.prototype.update=function(a){void 0!==a.focused&&(!1!==a.focused&&(a.active=!!a.focused),delete a.focused);void 0!==a.locked&&(a.pinned=!!a.locked,delete a.locked);delete a.closed;for(var c in a)this.properties[c]=a[c];this.enqueue(chrome.tabs.update,
this.properties.id,a,function(){this.dequeue()}.bind(this))};g.prototype.refresh=function(){};g.prototype.postMessage=function(a){if(!0===this.properties.closed)throw{name:"Invalid State Error",message:"BrowserTab is in the closed state"};this.enqueue(chrome.tabs.sendMessage,this.properties.id,a,function(){this.dequeue()}.bind(this))};g.prototype.getScreenshot=function(a){if(!0===this.properties.closed)throw{name:"Invalid State Error",message:"BrowserTab is in the closed state"};if(!this._windowParent||
!0===this._windowParent.properties.closed)a.call(this,void 0);else try{this.enqueue(chrome.tabs.captureVisibleTab,this._windowParent.properties.id,{},function(b){if(b){var c=document.createElement("canvas"),d=c.getContext("2d"),f=new Image;f.onload=function(){c.width=f.width;c.height=f.height;d.drawImage(f,0,0);var b=d.getImageData(0,0,c.width,c.height);a.call(this,b);this.dequeue()}.bind(this);f.src=b}else a.call(this,void 0);this.dequeue()}.bind(this))}catch(c){}};g.prototype.close=function(){this.properties.closed=
!0;this.enqueue(function(){chrome.tabs.remove(this.properties.id,function(){this.dequeue();this._parent&&this._parent.dequeue();j.tabs.dequeue()}.bind(this))}.bind(this))};var D=function(a){A.mixin(this);this._parent=a;this.length=0};D.prototype=Object.create(i.prototype);D.prototype.create=function(){throw{name:"Not Supported Error",message:"The current user agent does not support Tab Groups"};};D.prototype.getAll=function(){return[]};j.windows=j.windows||new l;j.tabs=j.tabs||new L;j.tabGroups=j.tabGroups||
new D;o=function(){A.mixin(this);chrome.browserAction.onClicked.addListener(function(){this[0]&&this[0].dispatchEvent(new k("click",{}));this.dispatchEvent(new k("click",{}))}.bind(this))};o.prototype=Object.create(i.prototype);o.prototype.createItem=function(a){return new r(a)};o.prototype.addItem=function(a){a&&a instanceof r&&(this[0]=a,this.length=1,a.resolve(),a.apply(),a.badge.resolve(),a.badge.apply(),a.popup.resolve(),a.popup.apply(),chrome.browserAction.enable())};o.prototype.removeItem=
function(a){a&&a instanceof r&&(this[0]&&this[0]===a)&&(delete this[0],this.length=0,chrome.browserAction.disable(),a.dispatchEvent(new k("remove",{})),this.dispatchEvent(new k("remove",{})))};var s=function(a){n.call(this);this.properties={};this.properties.textContent=a.textContent;this.properties.backgroundColor=E(a.backgroundColor);this.properties.color=E(a.color);this.properties.display=a.display};s.prototype=Object.create(n.prototype);s.prototype.apply=function(){chrome.browserAction.setBadgeBackgroundColor({color:this.backgroundColor||
"#f00"});"block"===this.display?chrome.browserAction.setBadgeText({text:this.textContent}):chrome.browserAction.setBadgeText({text:""})};s.prototype.__defineGetter__("textContent",function(){return this.properties.textContent});s.prototype.__defineSetter__("textContent",function(a){this.properties.textContent=""+a;this.resolved&&"block"===this.properties.display&&chrome.browserAction.setBadgeText({text:""+a})});s.prototype.__defineGetter__("backgroundColor",function(){return this.properties.backgroundColor});
s.prototype.__defineSetter__("backgroundColor",function(a){this.properties.backgroundColor=E(""+a);this.resolved&&chrome.browserAction.setBadgeBackgroundColor({color:this.properties.backgroundColor})});s.prototype.__defineGetter__("color",function(){return this.properties.color});s.prototype.__defineSetter__("color",function(a){this.properties.color=E(""+a)});s.prototype.__defineGetter__("display",function(){return this.properties.display});s.prototype.__defineSetter__("display",function(a){"block"===
(""+a).toLowerCase()?(this.properties.display="block",this.resolved&&chrome.browserAction.setBadgeText({text:this.properties.textContent})):(this.properties.display="none",this.resolved&&chrome.browserAction.setBadgeText({text:""}))});var u=function(a){n.call(this);this.properties={};this.properties.href=a.href||"";this.properties.width=a.width;this.properties.height=a.height};u.prototype=Object.create(n.prototype);u.prototype.apply=function(){chrome.browserAction.setPopup({popup:this.href})};u.prototype.__defineGetter__("href",
function(){return this.properties.href});u.prototype.__defineSetter__("href",function(a){this.properties.href=""+a;this.resolved&&chrome.browserAction.setPopup({popup:""+a})});u.prototype.__defineGetter__("width",function(){return this.properties.width});u.prototype.__defineSetter__("width",function(a){this.properties.width=a});u.prototype.__defineGetter__("height",function(){return this.properties.height});u.prototype.__defineSetter__("height",function(a){this.properties.height=a});var r=function(a){n.call(this);
this.properties={};this.properties.disabled=a.disabled||!1;this.properties.title=a.title||"";this.properties.icon=a.icon||"";this.properties.popup=new u(a.popup||{});this.properties.badge=new s(a.badge||{})};r.prototype=Object.create(n.prototype);r.prototype.apply=function(){!0===this.disabled?chrome.browserAction.disable():chrome.browserAction.enable();chrome.browserAction.setTitle({title:this.title});chrome.browserAction.setIcon({path:this.icon})};r.prototype.__defineGetter__("disabled",function(){return this.properties.disabled});
r.prototype.__defineSetter__("disabled",function(a){this.properties.disabled!==a&&(!0===a||"true"===a||1===a||"1"===a?(this.properties.disabled=!0,this.resolved&&chrome.browserAction.disable()):(this.properties.disabled=!1,this.resolved&&chrome.browserAction.enable()))});r.prototype.__defineGetter__("title",function(){return this.properties.title});r.prototype.__defineSetter__("title",function(a){this.properties.title=""+a;this.resolved&&chrome.browserAction.setTitle({title:this.title})});r.prototype.__defineGetter__("icon",
function(){return this.properties.icon});r.prototype.__defineSetter__("icon",function(a){this.properties.icon=""+a;this.resolved&&chrome.browserAction.setIcon({path:this.icon})});r.prototype.__defineGetter__("popup",function(){return this.properties.popup});r.prototype.__defineGetter__("badge",function(){return this.properties.badge});Q.toolbar=Q.toolbar||new o;if(m.opera)y=!0,t.isReady=function(a){a.call(t);for(var a=0,c=w.length;a<c;a++){var b=w[a];b.target[b.methodName].apply(b.target,b.args)}w=
[]};else{o=function(a,c){var b=a.addEventListener;a.addEventListener=function(e,d,f){e.toLowerCase()===c.toLowerCase()?void 0===d||(null===d||"[object Function]"!==Object.prototype.toString.call(d))||(y?d.call(m):v[c.toLowerCase()].push(d)):b.call(a,e,d,f)};a.__defineSetter__("on"+c.toLowerCase(),function(b){a.addEventListener(c.toLowerCase(),b,!1)})};var R=function(a,c){for(var b=a.toLowerCase(),e=new k(b,{}),d=0,f=v[b].length;d<f;d++)v[b][d].call(c,e);v[b]=[]},v={isready:[],domcontentloaded:[],
load:[]},S=!1,H=!1;m.document.addEventListener("DOMContentLoaded",function c(){S=!0;m.document.removeEventListener("DOMContentLoaded",c,!0)},!0);m.addEventListener("load",function b(){H=!0;m.removeEventListener("load",b,!0)},!0);o(m,"load");o(m.document,"domcontentloaded");o(m,"domcontentloaded");var W=(new Date).getTime()+3E3;(function e(){if((new Date).getTime()>=W)console.warn("opera.isReady check timed out"),H=!0;else for(var d in C)if(!0!==C[d]){m.setTimeout(function(){e()},20);return}m.setTimeout(function(){if(!y){for(var d=
0,e=v.isready.length;d<e;d++)v.isready[d].call(m);v.isready=[];var g=(new Date).getTime()+3E3;(function T(){var d=(new Date).getTime();if(S||H||d>=g){R("domcontentloaded",m.document);d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var e=(new Date).getTime()+3E3;(function U(){var d=(new Date).getTime();if(H||d>=e){R("load",window);d>=e&&console.warn("window.load event fired on check timeout");for(var d=0,f=w.length;d<f;d++){var g=w[d];g.target[g.methodName].apply(g.target,
g.args)}w=[]}else m.setTimeout(function(){U()},50)})()}else m.setTimeout(function(){T()},50)})();y=!0}},0)})();t.isReady=function(e){y?e.call(m):v.isready.push(e)}}m.opera=t}(window);
