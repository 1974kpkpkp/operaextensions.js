// operaextensions_background.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(x){function A(a,b,c){t?a[b].apply(a,c):r.push({target:a,methodName:b,args:c})}var o=x.opera||{REVISION:"1",version:function(){return this.REVISION},postError:function(a){console.log(a)}},t=!1,r=[],w={WINTABS_LOADED:!1,WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},u={},i="undefined"!==typeof window?window:{},i=i.MutationObserver||i.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))i=function(a,b){process.nextTick(function(){a.call(b)})};
else if(i){var B=[],i=new i(function(){var a=B.slice();B=[];a.forEach(function(a){a[0].call(a[1])})}),E=document.createElement("div");i.observe(E,{attributes:!0});i=function(a,b){B.push([a,b]);E.setAttribute("drainQueue","drainQueue")}}else i=function(a,b){setTimeout(function(){a.call(b)},1)};u.async=i;var K=u.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},F=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===b)return c;return-1},C=function(a){var b=a._promiseCallbacks;
b||(b=a._promiseCallbacks={});return b},i=u.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){for(var d=C(this),f,e,a=a.split(/\s+/),c=c||this;e=a.shift();)(f=d[e])||(f=d[e]=[]),-1===F(f,b)&&f.push([b,c])},off:function(a,b){for(var c=C(this),d,f,a=a.split(/\s+/);d=a.shift();)b?(d=c[d],f=F(d,b),-1!==f&&d.splice(f,1)):c[d]=[]},trigger:function(a,b){var c,d,f,e;if(c=C(this)[a])for(var m=0,h=c.length;m<h;m++)d=c[m],f=d[0],d=d[1],"object"!==
typeof b&&(b={detail:b}),e=new K(a,b),f.call(d,e)}},v=u.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},G=function(){},H=function(a,b,c,d){var f,e;if(c)try{f=c(d.detail)}catch(m){e=m}else f=d.detail;if(f instanceof v)f.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(c&&f)b.resolve(f);else if(e)b.reject(e);else b[a](f)};v.prototype={then:function(a,
b){var c=new v;this.on("promise:resolved",function(b){H("resolve",c,a,b)});this.on("promise:failed",function(a){H("reject",c,b,a)});return c},resolve:function(a){u.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=G},reject:function(a){u.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=G}};i.mixin(v.prototype);var h=function(){v.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",
function(){this.resolved=!0;this.dequeue()}.bind(this))};h.prototype=Object.create(v.prototype);h.prototype.addEventListener=h.prototype.on;h.prototype.removeEventListener=h.prototype.off;h.prototype.fireEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};h.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],b=[];if(1<arguments.length)for(var c=1,d=arguments.length;c<d;c++)b.push(arguments[c]);
this._queue.push({action:a,args:b})}};h.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var j=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!0,!0);for(var d in b)c[d]=b[d];return c},y=function(a){h.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new j("disconnect",
{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.fireEvent(new j("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})):A(this,"fireEvent",[new j("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})])}.bind(this)),A(this,"fireEvent",[new j("connect",{source:this._localPort})]))};
y.prototype=Object.create(h.prototype);y.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var z=function(){y.call(this,!0);this._allPorts=[];chrome.extension.onConnect.addListener(function(a){var b=this._allPorts.length;a.onDisconnect.addListener(function(){this._allPorts.splice(b-1,1);this.fireEvent(new j("disconnect",{source:a}))}.bind(this));this._allPorts[b]=a;a.onMessage.addListener(function(b){b&&b.action&&0===b.action.indexOf("___O_")?
this.fireEvent(new j("controlmessage",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})):A(this,"fireEvent",[new j("message",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})])}.bind(this));this.fireEvent(new j("connect",{source:a}))}.bind(this))};z.prototype=Object.create(y.prototype);z.prototype.broadcastMessage=function(a){for(var b=0,c=this._allPorts.length;b<c;b++)this._allPorts[b].postMessage(a)};
var k=function(){z.call(this)};k.prototype=Object.create(z.prototype);var e=o.extension=o.extension||new k,i=o.contexts=o.contexts||{};k.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var c=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(c)?c:"")+a,d=new XMLHttpRequest;d.onloadend=function(){d.readyState==d.DONE&&200==d.status&&(result=d.response,result.name=a.substring(a.lastIndexOf("/")+
1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};d.open("GET",a,!1);d.responseType="blob";d.send(null)}catch(e){}return b};var s=function(){Object.defineProperty(this,"_storage",{value:localStorage});Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(s.prototype,"getItem",{value:function(a){a=this._storage.getItem(a);return null===a?void 0:a}.bind(this)});Object.defineProperty(s.prototype,"key",{value:function(a){return this._storage.key(a)}.bind(this)});
Object.defineProperty(s.prototype,"removeItem",{value:function(a,b){this._storage.removeItem(a);this.hasOwnProperty(a)&&(delete this[a],this.length--);b||e.postMessage({action:"___O_widgetPreferences_removeItem_RESPONSE",data:{key:a}})}.bind(this)});Object.defineProperty(s.prototype,"setItem",{value:function(a,b,c){this._storage.setItem(a,b);this[a]||this.length++;this[a]=b;c||e.postMessage({action:"___O_widgetPreferences_setItem_RESPONSE",data:{key:a,val:b}})}.bind(this)});Object.defineProperty(s.prototype,
"clear",{value:function(a){this._storage.clear();for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||e.postMessage({action:"___O_widgetPreferences_clearItem_RESPONSE"})}.bind(this)})};s.prototype=Object.create(Storage.prototype);k=function(){h.call(this);this.properties={};this._preferences=new s;w.WIDGET_PREFERENCES_LOADED=!0;var a=new XMLHttpRequest;a.open("GET","/manifest.json",!0);a.onreadystatechange=function(){4==a.readyState&&(this.properties=JSON.parse(a.responseText),
this.resolve(),w.WIDGET_API_LOADED=!0)}.bind(this);a.send();e.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_REQUEST":var c={},d;for(d in this.properties)c[d]=this.properties[d];a.source.postMessage({action:"___O_widget_setup_RESPONSE",attrs:c,_prefs:this._preferences});break;case "___O_widgetPreferences_setItem_REQUEST":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_REQUEST":this._preferences.removeItem(a.data.data.key,
!0);break;case "___O_widgetPreferences_clear_REQUEST":this._preferences.clear(!0)}}.bind(this),!1)};k.prototype=Object.create(h.prototype);k.prototype.__defineGetter__("name",function(){return this.properties.name||""});k.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});k.prototype.__defineGetter__("id",function(){return this.properties.id||""});k.prototype.__defineGetter__("description",function(){return this.properties.description||
""});k.prototype.__defineGetter__("author",function(){return this.properties.author||""});k.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});k.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});k.prototype.__defineGetter__("version",function(){return this.properties.version||""});k.prototype.__defineGetter__("preferences",function(){return this._preferences});x.widget=
x.widget||new k;e.BrowserWindowsManager=function(){h.call(this);this[0]=new e.BrowserWindow;this.length=1;this._lastFocusedWindow=this[0];chrome.windows.getAll({populate:!0},function(a){var b=[];if(0<a.length){for(var c in a[0])this[0].properties[c]=a[0][c];for(var d=[],f=0,g=a[0].tabs.length;f<g;f++)d[f]=new e.BrowserTab(a[0].tabs[f],this[0]),!0==d[f].properties.active&&!0==this[0].properties.focused&&(this[0].tabs._lastFocusedTab=d[f],e.tabs._lastFocusedTab=d[f]);this[0].tabs.replaceTabs(d);b=b.concat(d)}c=
1;for(var m=a.length;c<m;c++){this[c]=new e.BrowserWindow(a[c]);this.length=c+1;d=[];f=0;for(g=a[c].tabs.length;f<g;f++)d[f]=new e.BrowserTab(a[c].tabs[f],this[c]),!0==d[f].properties.active&&!0==this[c].properties.focused&&(this[c].tabs._lastFocusedTab=d[f],e.tabs._lastFocusedTab=d[f]);this[c].tabs.replaceTabs(d);b=b.concat(d)}e.tabs.replaceTabs(b);chrome.windows.getLastFocused({populate:!1},function(a){for(var b=0,c=this.length;b<c;b++)if(this[b].properties.id===a.id){this._lastFocusedWindow=this[b];
break}}.bind(this));this.resolve();e.tabs.resolve();c=0;for(m=this.length;c<m;c++){this[c].resolve();this[c].tabs.resolve();f=0;for(g=this[c].tabs.length;f<g;f++)this[c].tabs[f].resolve()}w.WINTABS_LOADED=!0}.bind(this));chrome.windows.onCreated.addListener(function(a){window.setTimeout(function(){for(var b=!1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.id){b=!0;break}if(!b){b=new e.BrowserWindow(a);d=[];for(c in a.tabs){var f=new e.BrowserTab(a.tabs[c],b);d.push(f)}b.tabs.replaceTabs(d);
this[this.length]=b;this.length+=1;b.resolve();b.tabs.resolve();c=0;for(d=b.tabs.length;c<d;c++)b.tabs[c].resolve();this.fireEvent(new j("create",{browserWindow:b}))}}.bind(this),200)}.bind(this));chrome.windows.onRemoved.addListener(function(a){for(var b=-1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a){b=c;break}if(-1<b){this[b].fireEvent(new j("close",{browserWindow:this[b]}));this.fireEvent(new j("close",{browserWindow:this[b]}));c=b;for(d=this.length;c<d;c++)this[c+1]&&(this[c]=this[c+
1]);delete this[this.length-1];this.length-=1}}.bind(this));chrome.windows.onFocusChanged.addListener(function(a){for(var b=0,c=this.length;b<c;b++)if(this[b].properties.id==a){this._lastFocusedWindow=this[b];break}}.bind(this))};e.BrowserWindowsManager.prototype=Object.create(h.prototype);e.BrowserWindowsManager.prototype.create=function(a,b,c){var b=b||{},d=c||new e.BrowserWindow(b);if(!this.resolved)return this.enqueue("create",a,b,d),d;b.incognito=b.private||!1;chrome.windows.create(b,function(b){for(var c in b)d.properties[c]=
b[c];var m=[];if(b.tabs){c=0;for(var h=b.tabs.length;c<h;c++){var i=new e.BrowserTab(b.tabs[c],d);m.push(i)}}d.tabs.replaceTabs(m);this[this.length]=d;this.length+=1;d.resolve();d.tabs.resolve();if(a)for(c in a)a[c]instanceof e.BrowserTab?function(a){chrome.tabs.move(a.properties.id,{index:-1,windowId:b.id},function(b){for(var c in b)a.properties[c]=b[c];a.resolve()})}(a[c]):a[c]instanceof e.BrowserTabGroup||function(a){var c=new e.BrowserTab(a,d);chrome.tabs.create(c.properties,{index:-1,windowId:b.id},
function(a){for(var b in a)c.properties[b]=a[b];c.resolve()});d.tabs.addTabs([c])}(a[c]);this.fireEvent(new j("create",{browserWindow:d}));this.dequeue()}.bind(this));return d};e.BrowserWindowsManager.prototype.getAll=function(){for(var a=[],b=0,c=this.length;b<c;b++)a[b]=this[b];return a};e.BrowserWindowsManager.prototype.getLastFocused=function(){return this._lastFocusedWindow};e.BrowserWindowsManager.prototype.close=function(a){chrome.windows.remove(a.properties.id,function(){a.properties.closed=
!0;a.dequeue()})};e.BrowserWindow=function(a){h.call(this);this.properties=a||{};this._parent=null;this._tabGroups=[];this._operaId=Math.floor(1E16*Math.random());this.tabs=new e.BrowserTabsManager(this)};e.BrowserWindow.prototype=Object.create(h.prototype);e.BrowserWindow.prototype.__defineGetter__("id",function(){return this._operaId});e.BrowserWindow.prototype.__defineGetter__("closed",function(){return this.properties.closed||!1});e.BrowserWindow.prototype.__defineGetter__("focused",function(){return this.properties.focused||
!1});e.BrowserWindow.prototype.__defineGetter__("private",function(){return this.properties.incognito||!1});e.BrowserWindow.prototype.__defineGetter__("parent",function(){return this._parent});e.BrowserWindow.prototype.insert=function(a,b){if(!this.resolved||this._parent&&!this._parent.resolved||!a.resolved||b&&!b.resolved)this.enqueue("insert",a,b);else{if(!0===this.closed)throw{name:"Invalid State Error",message:"Current window is in the closed state and therefore is invalid"};var c={windowId:this.properties.id};
if(b&&b instanceof e.BrowserTab){if(!0===b.closed)throw{name:"Invalid State Error",message:"'child' attribute is in the closed state and therefore is invalid"};if(b._windowParent&&!0===b._windowParent.closed)throw{name:"Invalid State Error",message:"Parent window of 'child' attribute is in the closed state and therefore is invalid"};c.windowId=b._windowParent?b._windowParent.properties.id:c.windowId;c.index=b.position}a instanceof e.BrowserTab&&chrome.tabs.move(a.properties.id,c,function(){this.dequeue()}.bind(this))}};
e.BrowserWindow.prototype.focus=function(){!this.resolved||this._parent&&!this._parent.resolved?this.enqueue("focus"):chrome.windows.update(this.properties.id,{focused:!0},function(){this.dequeue()})};e.BrowserWindow.prototype.update=function(a){if(!this.resolved||this._parent&&!this._parent.resolved)this.enqueue("update",a);else{for(var b in a)this.properties[b]=a[b];chrome.windows.update(this.properties.id,a,function(){this.dequeue()})}};e.BrowserWindow.prototype.close=function(){!this.resolved||
this._parent&&!this._parent.resolved?this.enqueue("close"):e.windows.close(this)};e.BrowserTabsManager=function(a){h.call(this);this.length=0;this._lastFocusedTab=null;this._parent=a;this.replaceTabs=function(a){for(var c=0,d=this.length;c<d;c++)delete this[c];c=this.length=0;for(d=a.length;c<d;c++)this!==e.tabs&&(a[c].properties.index=c),a[c].properties.closed=!1,this[c]=a[c];this.length=a.length};this.addTabs=function(a,c){for(var d=[],f=0,g=this.length;f<g;f++)d[f]=this[f];f=[c||d.length-1,0].concat(a);
Array.prototype.splice.apply(d,f);f=0;for(g=d.length;f<g;f++)this!==e.tabs&&(d[f].properties.index=f),d[f].properties.closed=!1,this[f]=d[f];this.length=d.length};this.removeTab=function(a){for(var c=this.length,d=[],f=-1,g=0,h=this.length;g<h;g++)d[g]=this[g],d[g].id==a.id&&(f=g);-1<f&&d.splice(f,1);a.properties.closed=!0;a._windowParent=null;g=0;for(h=d.length;g<h;g++)this!==e.tabs&&(d[g].properties.index=g),this[g]=d[g];this.length=d.length;if(c>this.length){g=this.length;for(h=c;g<h;g++)delete this[g]}}};
e.BrowserTabsManager.prototype=Object.create(h.prototype);e.BrowserTabsManager.prototype.create=function(a,b,c){var a=a||{},d=c||new e.BrowserTab;if(!this.resolved||this._parent&&!this._parent.resolved)return this.enqueue("create",a,b,d),d;a.pinned=a.locked||!1;a.active=a.focused||!1;delete a.focused;if(this._parent&&!0===this._parent.closed)throw{name:"Invalid State Error",message:"Parent window is in the closed state and therefore is invalid"};a.windowId=this._parent?this._parent.properties.id:
void 0;if(b&&b instanceof e.BrowserTab){if(!0===b.closed)throw{name:"Invalid State Error",message:"'before' attribute is in the closed state and therefore is invalid"};if(b._windowParent&&!0===b._windowParent.closed)throw{name:"Invalid State Error",message:"Parent window of 'before' attribute is in the closed state and therefore is invalid"};a.windowId=b._windowParent?b._windowParent.properties.id:a.windowId;a.index=b.position}chrome.tabs.create(a,function(a){for(var b in a)d.properties[b]=a[b];var c=
!0;if(a.windowId){var h=o.extension.windows;b=0;for(var i=h.length;b<i;b++)if(h[b].properties.id===a.windowId){c=!1;d._windowParent=h[b];break}}c&&(d._windowParent=e.windows.getLastFocused());this.addTabs([d],d.properties.index);this!==e.tabs&&e.tabs.addTabs([d]);d.resolve(a);this.fireEvent(new j("create",{tab:d,prevWindow:d._windowParent,prevTabGroup:null,prevPosition:-1}));this.dequeue()}.bind(this));return d};e.BrowserTabsManager.prototype.getAll=function(){for(var a=[],b=0,c=this.length;b<c;b++)a[b]=
this[b];return a};e.BrowserTabsManager.prototype.getSelected=function(){return this._lastFocusedTab||this[0]};e.BrowserTabsManager.prototype.getFocused=e.BrowserTabsManager.prototype.getSelected;e.BrowserTabsManager.prototype.close=function(a){a&&(!this.resolved||this._parent&&!this._parent.resolved||!a.resolved?this.enqueue("close",a):chrome.tabs.remove(a.properties.id,function(){a.dequeue();this.dequeue()}.bind(this)))};e.RootBrowserTabsManager=function(){e.BrowserTabsManager.call(this);chrome.tabs.onCreated.addListener(function(a){window.setTimeout(function(){for(var b=
!1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.id){b=!0;break}if(!b){for(var b=new e.BrowserTab(a),f=!0,g=o.extension.windows,c=0,d=g.length;c<d;c++)if(g[c].properties.id==a.windowId){f=!1;b._windowParent=g[c];break}f&&(b._windowParent=e.windows.getLastFocused());b._windowParent.tabs.addTabs([b],b.properties.index);b._windowParent.tabs.fireEvent(new j("create",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:NaN}));this.addTabs([b]);b.resolve();this.fireEvent(new j("create",
{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:NaN}))}}.bind(this),200)}.bind(this));chrome.tabs.onRemoved.addListener(function(a){for(var b=-1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a){b=c;break}-1<b&&(b=(a=this[b])?a._windowParent:null,c=a?a.position:NaN,b&&b.tabs.removeTab(a),this.removeTab(a),a.fireEvent(new j("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})),b&&b.tabs.fireEvent(new j("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})),
this.fireEvent(new j("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})))}.bind(this));chrome.tabs.onUpdated.addListener(function(a,b){for(var c=-1,d=0,e=this.length;d<e;d++)if(this[d].properties.id==a){c=d;break}if(!(0>c)){c=this[c];for(d in b)c.properties[d]=b[d];if(c._windowParent){for(var g=-1,d=0,e=c._windowParent.tabs.length;d<e;d++)if(c._windowParent.tabs[d].properties.id==a){g=d;break}if(-1<g)for(d in b)c._windowParent.tabs[g].properties[d]=b[d]}}}.bind(this));chrome.tabs.onMoved.addListener(function(a,
b){for(var c=-1,d=0,f=this.length;d<f;d++)if(this[d].properties.id==a){c=d;break}if(!(0>c)){var g=(c=this[c])?c._windowParent:null;if(c){if(g){for(var h=-1,d=0,f=g.tabs.length;d<f;d++)if(g.tabs[d].properties.id==a){h=d;break}if(-1<h){d=h;for(f=g.tabs.length;d<f;d++)g.tabs[d+1]&&(g.tabs[d]=g.tabs[d+1]);delete g.tabs[c._windowParent.length-1];g.tabs.length-=1}}d=0;for(f=e.windows.length;d<f;d++)if(e.windows[d].properties.id==b.windowId){e.windows[d].tabs.addTabs([c],b.toIndex);c._windowParent=e.windows[d];
break}c.fireEvent(new j("move",{tab:c,prevWindow:g,prevTabGroup:null,prevPosition:b.fromIndex}));this.fireEvent(new j("move",{tab:c,prevWindow:g,prevTabGroup:null,prevPosition:b.fromIndex}))}}}.bind(this));chrome.tabs.onHighlighted.addListener(function(a){for(var b=0,c=e.windows.length;b<c;b++)for(var d=0,f=e.windows[b].tabs.length;d<f;d++)for(var g=0,h=a.tabIds.length;g<h;g++)e.windows[b]==a.windowId&&e.windows[b].tabs[d].properties.id==a.tabIds[g]?(e.windows[b].tabs[d].properties.active=!0,e.windows[b].tabs._lastFocusedTab=
e.windows[b].tabs[d],this._lastFocusedTab=e.windows[b].tabs[d]):e.windows[b].tabs[d].properties.active=!1}.bind(this));e.addEventListener("controlmessage",function(a){if(a.data&&a.data.action&&"___O_getScreenshot_REQUEST"===a.data.action&&a.source.tabId){for(var b=null,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.source.tabId){b=this[c];break}if(null!==b&&b._windowParent&&!0!=b._windowParent.properties.closed)try{chrome.tabs.captureVisibleTab(b._windowParent.properties.id,{},function(b){a.source.postMessage({action:"___O_getScreenshot_RESPONSE",
dataUrl:b||null})}.bind(this))}catch(e){}else a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:void 0})}}.bind(this))};e.RootBrowserTabsManager.prototype=Object.create(e.BrowserTabsManager.prototype);e.BrowserTab=function(a,b){h.call(this);this.properties=a||{};this._windowParent=b;this._operaId=Math.floor(1E16*Math.random())};e.BrowserTab.prototype=Object.create(h.prototype);e.BrowserTab.prototype.__defineGetter__("id",function(){return this._operaId});e.BrowserTab.prototype.__defineGetter__("closed",
function(){return this.properties.closed||!1});e.BrowserTab.prototype.__defineGetter__("locked",function(){return this.properties.pinned||!1});e.BrowserTab.prototype.__defineGetter__("focused",function(){return this.properties.active||!1});e.BrowserTab.prototype.__defineGetter__("selected",function(){return this.properties.active||!1});e.BrowserTab.prototype.__defineGetter__("private",function(){return this.properties.incognito||!1});e.BrowserTab.prototype.__defineGetter__("faviconUrl",function(){return this.properties.closed?
"":this.properties.favIconUrl||""});e.BrowserTab.prototype.__defineGetter__("title",function(){return this.properties.closed?"":this.properties.title||""});e.BrowserTab.prototype.__defineGetter__("url",function(){return this.properties.closed?"":this.properties.url||""});e.BrowserTab.prototype.__defineGetter__("readyState",function(){return this.properties.status||"loading"});e.BrowserTab.prototype.__defineGetter__("browserWindow",function(){return this._windowParent});e.BrowserTab.prototype.__defineGetter__("tabGroup",
function(){return null});e.BrowserTab.prototype.__defineGetter__("position",function(){return this.properties.index||NaN});e.BrowserTab.prototype.close=function(){e.tabs.close(this)};e.BrowserTab.prototype.focus=function(){this.resolved?chrome.tabs.update(this.properties.id,{active:!0},function(){this.dequeue()}.bind(this)):this.enqueue("focus")};e.BrowserTab.prototype.update=function(a){if(this.resolved){for(var b in a)this.properties[b]=a[b];a.active=a.focused||!1;a.pinned=a.locked||!1;delete a.focused;
chrome.tabs.update(this.properties.id,a,function(){this.dequeue()}.bind(this))}else this.enqueue("update",a)};e.BrowserTab.prototype.refresh=function(){};e.BrowserTab.prototype.postMessage=function(a){!this.resolved||this._windowParent&&!this._windowParent.resolved||this._windowParent&&this._windowParent._parent&&!this._windowParent._parent.resolved?this.enqueue("postMessage",a):(chrome.tabs.sendMessage(this.properties.id,a),this.dequeue())};e.BrowserTab.prototype.getScreenshot=function(a){if(!this.resolved||
this._windowParent&&!this._windowParent.resolved||this._windowParent&&this._windowParent._parent&&!this._windowParent._parent.resolved)this.enqueue("getScreenshot",a);else if(!this._windowParent||!0===this._windowParent.properties.closed)a.call(this,void 0);else try{chrome.tabs.captureVisibleTab(this._windowParent.properties.id,{},function(b){if(b){var d=document.createElement("canvas"),e=d.getContext("2d"),g=new Image;g.onload=function(){d.width=g.width;d.height=g.height;e.drawImage(g,0,0);var b=
e.getImageData(0,0,d.width,d.height);a.call(this,b);this.dequeue()}.bind(this);g.src=b}else a.call(this,void 0)}.bind(this))}catch(b){}};e.windows=e.windows||new e.BrowserWindowsManager;e.tabs=e.tabs||new e.RootBrowserTabsManager;i.ToolbarContext=function(){h.call(this);this.resolve();chrome.browserAction.onClicked.addListener(function(){this[0]&&this[0].fireEvent(new j("click",{}));this.fireEvent(new j("click",{}))}.bind(this))};i.ToolbarContext.prototype=Object.create(h.prototype);i.ToolbarContext.prototype.createItem=
function(a){return new l(a)};i.ToolbarContext.prototype.addItem=function(a){a&&a instanceof l&&(this[0]=a,this.length=1,a.resolve(),a.apply(),a.badge.resolve(),a.badge.apply(),a.popup.resolve(),a.popup.apply(),chrome.browserAction.enable())};i.ToolbarContext.prototype.removeItem=function(a){a&&a instanceof l&&(this[0]&&this[0]===a)&&(delete this[0],this.length=0,chrome.browserAction.disable(),a.fireEvent(new j("remove",{})),this.fireEvent(new j("remove",{})))};var n=function(a){h.call(this);this.properties=
{};this.properties.textContent=a.textContent;this.properties.backgroundColor=a.backgroundColor;this.properties.color=a.color;this.properties.display=a.display};n.prototype=Object.create(h.prototype);n.prototype.apply=function(){chrome.browserAction.setBadgeBackgroundColor({color:this.backgroundColor||"#f00"});"block"===this.display?chrome.browserAction.setBadgeText({text:this.textContent}):chrome.browserAction.setBadgeText({text:""})};n.prototype.__defineGetter__("textContent",function(){return this.properties.textContent});
n.prototype.__defineSetter__("textContent",function(a){this.properties.textContent=""+a;this.resolved&&"block"===this.properties.display&&chrome.browserAction.setBadgeText({text:""+a})});n.prototype.__defineGetter__("backgroundColor",function(){return this.properties.backgroundColor});n.prototype.__defineSetter__("backgroundColor",function(a){this.properties.backgroundColor=""+a;this.resolved&&chrome.browserAction.setBadgeBackgroundColor({color:""+a})});n.prototype.__defineGetter__("color",function(){return this.properties.color});
n.prototype.__defineSetter__("color",function(a){this.properties.color=""+a});n.prototype.__defineGetter__("display",function(){return this.properties.display});n.prototype.__defineSetter__("display",function(a){"block"===(""+a).toLowerCase()?(this.properties.display="block",this.resolved&&chrome.browserAction.setBadgeText({text:this.properties.textContent})):(this.properties.display="none",this.resolved&&chrome.browserAction.setBadgeText({text:""}))});var p=function(a){h.call(this);this.properties=
{};this.properties.href=a.href||"";this.properties.width=a.width;this.properties.height=a.height};p.prototype=Object.create(h.prototype);p.prototype.apply=function(){chrome.browserAction.setPopup({popup:this.href})};p.prototype.__defineGetter__("href",function(){return this.properties.href});p.prototype.__defineSetter__("href",function(a){this.properties.href=""+a;this.resolved&&chrome.browserAction.setPopup({popup:""+a})});p.prototype.__defineGetter__("width",function(){return this.properties.width});
p.prototype.__defineSetter__("width",function(a){this.properties.width=a});p.prototype.__defineGetter__("height",function(){return this.properties.height});p.prototype.__defineSetter__("height",function(a){this.properties.height=a});var l=function(a){h.call(this);this.properties={};this.properties.disabled=a.disabled||!1;this.properties.title=a.title||"";this.properties.icon=a.icon||"";this.properties.popup=new p(a.popup||{});this.properties.badge=new n(a.badge||{})};l.prototype=Object.create(h.prototype);
l.prototype.apply=function(){!0===this.disabled?chrome.browserAction.disable():chrome.browserAction.enable();chrome.browserAction.setTitle({title:this.title});chrome.browserAction.setIcon({path:this.icon})};l.prototype.__defineGetter__("disabled",function(){return this.properties.disabled});l.prototype.__defineSetter__("disabled",function(a){this.properties.disabled!==a&&(!0===a||"true"===a||1===a||"1"===a?(this.properties.disabled=!0,this.resolved&&chrome.browserAction.disable()):(this.properties.disabled=
!1,this.resolved&&chrome.browserAction.enable()))});l.prototype.__defineGetter__("title",function(){return this.properties.title});l.prototype.__defineSetter__("title",function(a){this.properties.title=""+a;this.resolved&&chrome.browserAction.setTitle({title:this.title})});l.prototype.__defineGetter__("icon",function(){return this.properties.icon});l.prototype.__defineSetter__("icon",function(a){this.properties.icon=""+a;this.resolved&&chrome.browserAction.setIcon({path:this.icon})});l.prototype.__defineGetter__("popup",
function(){return this.properties.popup});l.prototype.__defineGetter__("badge",function(){return this.properties.badge});i.toolbar=i.toolbar||new i.ToolbarContext;if(window.opera)t=!0,o.isReady=function(a){a.call(o);for(var a=0,b=r.length;a<b;a++){var c=r[a];c.target[c.methodName].apply(c.target,c.args)}r=[]};else{var i=function(a,b){var c=a.addEventListener;a.addEventListener=function(d,e,g){d.toLowerCase()===b.toLowerCase()?void 0===e||(null===e||"[object Function]"!==Object.prototype.toString.call(e))||
(t?e.call(window):q[b.toLowerCase()].push(e)):c.call(a,d,e,g)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},I=function(a,b){var c=a.toLowerCase(),d=document.createEvent("Event");d.initEvent(c,!0,!0);for(var e=0,g=q[c].length;e<g;e++)q[c][e].call(b,d);q[c]=[]},q={isready:[],domcontentloaded:[],load:[]},J=!1,D=!1;document.addEventListener("DOMContentLoaded",function b(){J=!0;document.removeEventListener("DOMContentLoaded",b,!0)},!0);window.addEventListener("load",
function c(){D=!0;window.removeEventListener("load",c,!0)},!0);i(window,"load");i(document,"domcontentloaded");i(window,"domcontentloaded");var N=(new Date).getTime()+3E3;(function d(){if((new Date).getTime()>=N)console.error("opera.isReady check timed out");else for(var e in w)if(!0!==w[e]){window.setTimeout(function(){d()},20);return}window.setTimeout(function(){if(!t){for(var d=0,e=q.isready.length;d<e;d++)q.isready[d].call(window);q.isready=[];(function L(){J||D?(I("domcontentloaded",document),
function M(){if(D){I("load",window);for(var d=0,e=r.length;d<e;d++){var f=r[d];f.target[f.methodName].apply(f.target,f.args)}r=[]}else window.setTimeout(function(){M()},20)}()):window.setTimeout(function(){L()},20)})();t=!0}},0)})();o.isReady=function(d){t?d.call(window):q.isready.push(d)}}x.opera=o}(window);
