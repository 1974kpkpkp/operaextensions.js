// operaextensions_background.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(l){function H(a,b,c){x?a[b].apply(a,c):u.push({target:a,methodName:b,args:c})}function D(a,b){function c(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a}function d(a){a=parseInt(a,10);a=a.toString(16);return 0==a?"00":a}if(void 0===a||null===a)return a;var a=a+"",e={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,
235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,
50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,
128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,
160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,
21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,
230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,
130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}[a.toLowerCase()];if(e)return"#"+d(e[0])+d(e[1])+d(e[2]);var e={hexLong:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hexShort:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},f;for(f in e)if(a.match(e[f]))return a;f=[["rgb",/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/],["rgb",/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsl",/^hsl\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/],
["hsl",/^hsla\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%,\s*(\d+(?:\.\d+)?|\.\d+)\s*\)$/],["hsv",/^hsv\((\d{1,3}),\s*(\d{1,3})%,\s*(\d{1,3})%\)$/]];for(var e={rgb:function(a){return[a[1],a[2],a[3],a[4]||1]},hsl:function(a){var b=parseInt(a[1],10)%360/360,d=parseInt(a[2],10)%101/100,e=parseInt(a[3],10)%101/100,a=a[4]||1;if(0===d)return[e,e,e];d=0.5>e?e*(1+d):e+d-e*d;e=2*e-d;return[(256*c(e,d,b+1/3)).toFixed(0),(256*c(e,d,b)).toFixed(0),(256*c(e,d,b-1/3)).toFixed(0),a]},hsv:function(a){var b,c,d,e=parseInt(a[1],
10)%360/360,f=parseInt(a[2],10)%101/100,a=parseInt(a[3],10)%101/100,h=Math.floor(6*e),v=6*e-h,e=a*(1-f),g=a*(1-v*f),f=a*(1-(1-v)*f);switch(h%6){case 0:b=a;c=f;d=e;break;case 1:b=g;c=a;d=e;break;case 2:b=e;c=a;d=f;break;case 3:b=e;c=g;d=a;break;case 4:b=f;c=e;d=a;break;case 5:b=a,c=e,d=g}return[256*b,256*c,256*d]}},v=0,h=f.length;v<h;v++){var g=f[v][1].exec(a);if(g)return f=e[f[v][0]](g),e=parseFloat(f[3]||1),f="NaN"===e+""||0>e||1<=e?f:0==e?[255,255,255]:[e*parseInt(f[0],10)+(1-e)*(b||255),e*parseInt(f[1],
10)+(1-e)*(b||255),e*parseInt(f[2],10)+(1-e)*(b||255)],"#"+d(f[0]||255)+d(f[1]||255)+d(f[2]||255)}return"#f00"}var g=function(){};g.prototype.REVISION="1";g.prototype.version=function(){return this.REVISION};g.prototype.buildNumber=function(){return this.REVISION};g.prototype.postError=function(a){console.log(a)};var p=l.opera||new g,x=!1,u=[],A={WINTABS_LOADED:!1,WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},y={},g="undefined"!==typeof window?window:{},g=g.MutationObserver||g.WebKitMutationObserver;
if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))g=function(a,b){process.nextTick(function(){a.call(b)})};else if(g){var I=[],g=new g(function(){var a=I.slice();I=[];a.forEach(function(a){a[0].call(a[1])})}),K=document.createElement("div");g.observe(K,{attributes:!0});g=function(a,b){I.push([a,b]);K.setAttribute("drainQueue","drainQueue")}}else g=function(a,b){setTimeout(function(){a.call(b)},1)};y.async=g;var T=y.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&
(this[c]=b[c])},L=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===b)return c;return-1},J=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},B=y.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){for(var d=J(this),e,f,a=a.split(/\s+/),c=c||this;f=a.shift();)(e=d[f])||(e=d[f]=[]),-1===L(e,b)&&e.push([b,c])},off:function(a,b){for(var c=J(this),d,e,a=a.split(/\s+/);d=a.shift();)b?(d=c[d],e=L(d,b),-1!==e&&
d.splice(e,1)):c[d]=[]},trigger:function(a,b){var c,d,e,f;if(c=J(this)[a])for(var h=0,g=c.length;h<g;h++)d=c[h],e=d[0],d=d[1],"object"!==typeof b&&(b={detail:b}),f=new T(a,b),e.call(d,f)}},z=y.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},M=function(){},N=function(a,b,c,d){var e,f;if(c)try{e=c(d.detail)}catch(h){f=h}else e=d.detail;if(e instanceof z)e.then(function(a){b.resolve(a)},
function(a){b.reject(a)});else if(c&&e)b.resolve(e);else if(f)b.reject(f);else b[a](e)};z.prototype={then:function(a,b){var c=new z;this.on("promise:resolved",function(b){N("resolve",c,a,b)});this.on("promise:failed",function(a){N("reject",c,b,a)});return c},resolve:function(a){y.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=M},reject:function(a){y.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=M}};B.mixin(z.prototype);var k=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!0,!0);for(var d in b)c[d]=b[d];return c},g=function(){B.mixin(this)};g.prototype.constructor=g;g.prototype.addEventListener=function(a,b){this.on(a,b)};g.prototype.removeEventListener=function(a,b){this.off(a,b)};g.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};var m=function(){z.call(this);
this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};m.prototype=Object.create(z.prototype);for(var C in g.prototype)m.prototype[C]=g.prototype[C];m.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],b=[];if(1<arguments.length)for(var c=1,d=arguments.length;c<d;c++)b.push(arguments[c]);this._queue.push({action:a,args:b})}};m.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&
this[a.action].apply(this,a.args))};var E=function(a){B.mixin(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new k("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new k("controlmessage",
{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})):H(this,"dispatchEvent",[new k("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})])}.bind(this)),H(this,"dispatchEvent",[new k("connect",{source:this._localPort})]))};E.prototype=Object.create(g.prototype);E.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var F=function(){E.call(this,
!0);this._allPorts=[];chrome.extension.onConnect.addListener(function(a){var b=this._allPorts.length;a.onDisconnect.addListener(function(){this._allPorts.splice(b-1,1);this.dispatchEvent(new k("disconnect",{source:a}))}.bind(this));this._allPorts[b]=a;a.onMessage.addListener(function(b){b&&b.action&&0===b.action.indexOf("___O_")?this.dispatchEvent(new k("controlmessage",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})):H(this,"dispatchEvent",
[new k("message",{data:b,source:{postMessage:function(b){a.postMessage(b)},tabId:a.sender&&a.sender.tab?a.sender.tab.id:null}})])}.bind(this));this.dispatchEvent(new k("connect",{source:a}))}.bind(this))};F.prototype=Object.create(E.prototype);F.prototype.broadcastMessage=function(a){for(var b=0,c=this._allPorts.length;b<c;b++)this._allPorts[b].postMessage(a)};var j=function(){F.call(this)};j.prototype=Object.create(F.prototype);var h=p.extension=p.extension||new j;C=p.contexts=p.contexts||{};j.prototype.getFile=
p.extension.getFile||function(a){var b=null;if("string"!=typeof a)return b;try{var c=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(c)?c:"")+a,d=new XMLHttpRequest;d.onloadend=function(){d.readyState==d.DONE&&200==d.status&&(result=d.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};d.open("GET",
a,!1);d.responseType="blob";d.send(null)}catch(e){}return b};var w=function(){Object.defineProperty(this,"_storage",{value:localStorage});Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(w.prototype,"getItem",{value:function(a){return this._storage.getItem(a)}.bind(this)});Object.defineProperty(w.prototype,"key",{value:function(a){return this._storage.key(a)}.bind(this)});Object.defineProperty(w.prototype,"removeItem",{value:function(a,b){this._storage.removeItem(a);
this.hasOwnProperty(a)&&(delete this[a],this.length--);b||h.postMessage({action:"___O_widgetPreferences_removeItem_RESPONSE",data:{key:a}})}.bind(this)});Object.defineProperty(w.prototype,"setItem",{value:function(a,b,c){var d=this._storage.getItem(a);this._storage.setItem(a,b);this[a]||this.length++;this[a]=b;c||h.postMessage({action:"___O_widgetPreferences_setItem_RESPONSE",data:{key:a,val:b}});a=new k("storage",{key:a,oldValue:d,newValue:this._storage.getItem(a),url:chrome.extension.getURL(""),
storageArea:this._storage});l.dispatchEvent(a)}.bind(this)});Object.defineProperty(w.prototype,"clear",{value:function(a){this._storage.clear();for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||h.postMessage({action:"___O_widgetPreferences_clearItem_RESPONSE"})}.bind(this)})};w.prototype=Object.create(Storage.prototype);j=function(){B.mixin(this);this.properties={};this._preferences=new w;A.WIDGET_PREFERENCES_LOADED=!0;var a=new XMLHttpRequest;a.open("GET","/manifest.json",
!0);a.onreadystatechange=function(){4==a.readyState&&(this.properties=JSON.parse(a.responseText),A.WIDGET_API_LOADED=!0)}.bind(this);a.send();h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_REQUEST":var c={},d;for(d in this.properties)c[d]=this.properties[d];a.source.postMessage({action:"___O_widget_setup_RESPONSE",attrs:c,_prefs:this._preferences});break;case "___O_widgetPreferences_setItem_REQUEST":this._preferences.setItem(a.data.data.key,
a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_REQUEST":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_REQUEST":this._preferences.clear(!0)}}.bind(this),!1)};j.prototype=Object.create(g.prototype);j.prototype.__defineGetter__("name",function(){return this.properties.name||""});j.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});j.prototype.__defineGetter__("id",function(){return this.properties.id||
""});j.prototype.__defineGetter__("description",function(){return this.properties.description||""});j.prototype.__defineGetter__("author",function(){return this.properties.author||""});j.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});j.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});j.prototype.__defineGetter__("version",function(){return this.properties.version||
""});j.prototype.__defineGetter__("preferences",function(){return this._preferences});l.widget=l.widget||new j;j=function(){m.call(this);this[0]=new n;this.length=1;this._lastFocusedWindow=this[0];chrome.windows.getAll({populate:!0},function(a){var b=[];if(0<a.length){for(var c in a[0])this[0].properties[c]=a[0][c];for(var d=[],e=0,f=a[0].tabs.length;e<f;e++)d[e]=new i(a[0].tabs[e],this[0]),!0==d[e].properties.active&&!0==this[0].properties.focused&&(this[0].tabs._lastFocusedTab=d[e],h.tabs._lastFocusedTab=
d[e]);this[0].tabs.replaceTabs(d);b=b.concat(d)}c=1;for(var g=a.length;c<g;c++){this[c]=new n(a[c]);this.length=c+1;d=[];e=0;for(f=a[c].tabs.length;e<f;e++)d[e]=new i(a[c].tabs[e],this[c]),!0==d[e].properties.active&&!0==this[c].properties.focused&&(this[c].tabs._lastFocusedTab=d[e],h.tabs._lastFocusedTab=d[e]);this[c].tabs.replaceTabs(d);b=b.concat(d)}h.tabs.replaceTabs(b);chrome.windows.getLastFocused({populate:!1},function(a){for(var b=0,c=this.length;b<c;b++)if(this[b].properties.id===a.id){this._lastFocusedWindow=
this[b];break}}.bind(this));this.resolve();h.tabs.resolve();c=0;for(g=this.length;c<g;c++){this[c].resolve();this[c].tabs.resolve();e=0;for(f=this[c].tabs.length;e<f;e++)this[c].tabs[e].resolve()}A.WINTABS_LOADED=!0}.bind(this));chrome.windows.onCreated.addListener(function(a){window.setTimeout(function(){for(var b=!1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.id){b=!0;break}if(!b){b=new n(a);d=[];for(c in a.tabs){var e=new i(a.tabs[c],b);d.push(e)}b.tabs.replaceTabs(d);this[this.length]=
b;this.length+=1;b.resolve();b.tabs.resolve();c=0;for(d=b.tabs.length;c<d;c++)b.tabs[c].resolve();this.dispatchEvent(new k("create",{browserWindow:b}))}}.bind(this),200)}.bind(this));chrome.windows.onRemoved.addListener(function(a){for(var b=-1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a){b=c;break}if(-1<b){this[b].dispatchEvent(new k("close",{browserWindow:this[b]}));this.dispatchEvent(new k("close",{browserWindow:this[b]}));c=b;for(d=this.length;c<d;c++)this[c+1]&&(this[c]=this[c+1]);
delete this[this.length-1];this.length-=1}}.bind(this));chrome.windows.onFocusChanged.addListener(function(a){for(var b=0,c=this.length;b<c;b++)if(this[b].properties.id==a){this._lastFocusedWindow=this[b];break}}.bind(this))};j.prototype=Object.create(m.prototype);j.prototype.create=function(a,b,c){var b=b||{},d=c||new n(b);if(!this.resolved)return this.enqueue("create",a,b,d),d;b.incognito=b.private||!1;chrome.windows.create(b,function(b){for(var c in b)d.properties[c]=b[c];var h=[];if(b.tabs){c=
0;for(var g=b.tabs.length;c<g;c++){var j=new i(b.tabs[c],d);h.push(j)}}d.tabs.replaceTabs(h);this[this.length]=d;this.length+=1;d.resolve();d.tabs.resolve();if(a)for(c in a)a[c]instanceof i?function(a){chrome.tabs.move(a.properties.id,{index:-1,windowId:b.id},function(b){for(var c in b)a.properties[c]=b[c];a.resolve()})}(a[c]):a[c]instanceof BrowserTabGroup||function(a){var c=new i(a,d);chrome.tabs.create(c.properties,{index:-1,windowId:b.id},function(a){for(var b in a)c.properties[b]=a[b];c.resolve()});
d.tabs.addTabs([c])}(a[c]);this.dispatchEvent(new k("create",{browserWindow:d}));this.dequeue()}.bind(this));return d};j.prototype.getAll=function(){for(var a=[],b=0,c=this.length;b<c;b++)a[b]=this[b];return a};j.prototype.getLastFocused=function(){return this._lastFocusedWindow};j.prototype.close=function(a){chrome.windows.remove(a.properties.id,function(){a.properties.closed=!0;a.dequeue()})};var n=function(a){m.call(this);this.properties=a||{};this._parent=null;this._tabGroups=[];this._operaId=
Math.floor(1E16*Math.random());this.tabs=new r(this)};n.prototype=Object.create(m.prototype);n.prototype.__defineGetter__("id",function(){return this._operaId});n.prototype.__defineGetter__("closed",function(){return this.properties.closed||!1});n.prototype.__defineGetter__("focused",function(){return this.properties.focused||!1});n.prototype.__defineGetter__("private",function(){return this.properties.incognito||!1});n.prototype.__defineGetter__("parent",function(){return this._parent});n.prototype.insert=
function(a,b){if(!this.resolved||this._parent&&!this._parent.resolved||!a.resolved||b&&!b.resolved)this.enqueue("insert",a,b);else{if(!0===this.closed)throw{name:"Invalid State Error",message:"Current window is in the closed state and therefore is invalid"};var c={windowId:this.properties.id};if(b&&b instanceof i){if(!0===b.closed)throw{name:"Invalid State Error",message:"'child' attribute is in the closed state and therefore is invalid"};if(b._windowParent&&!0===b._windowParent.closed)throw{name:"Invalid State Error",
message:"Parent window of 'child' attribute is in the closed state and therefore is invalid"};c.windowId=b._windowParent?b._windowParent.properties.id:c.windowId;c.index=b.position}a instanceof i&&chrome.tabs.move(a.properties.id,c,function(){this.dequeue()}.bind(this))}};n.prototype.focus=function(){!this.resolved||this._parent&&!this._parent.resolved?this.enqueue("focus"):chrome.windows.update(this.properties.id,{focused:!0},function(){this.dequeue()})};n.prototype.update=function(a){if(!this.resolved||
this._parent&&!this._parent.resolved)this.enqueue("update",a);else{for(var b in a)this.properties[b]=a[b];chrome.windows.update(this.properties.id,a,function(){this.dequeue()})}};n.prototype.close=function(){!this.resolved||this._parent&&!this._parent.resolved?this.enqueue("close"):h.windows.close(this)};var r=function(a){m.call(this);this.length=0;this._lastFocusedTab=null;this._parent=a;this.replaceTabs=function(a){for(var c=0,d=this.length;c<d;c++)delete this[c];c=this.length=0;for(d=a.length;c<
d;c++)this!==h.tabs&&(a[c].properties.index=c),a[c].properties.closed=!1,this[c]=a[c];this.length=a.length};this.addTabs=function(a,c){for(var d=[],e=0,f=this.length;e<f;e++)d[e]=this[e];e=[c||d.length-1,0].concat(a);Array.prototype.splice.apply(d,e);e=0;for(f=d.length;e<f;e++)this!==h.tabs&&(d[e].properties.index=e),d[e].properties.closed=!1,this[e]=d[e];this.length=d.length};this.removeTab=function(a){for(var c=this.length,d=[],e=-1,f=0,g=this.length;f<g;f++)d[f]=this[f],d[f].id==a.id&&(e=f);-1<
e&&d.splice(e,1);a.properties.closed=!0;a._windowParent=null;f=0;for(g=d.length;f<g;f++)this!==h.tabs&&(d[f].properties.index=f),this[f]=d[f];this.length=d.length;if(c>this.length){f=this.length;for(g=c;f<g;f++)delete this[f]}}};r.prototype=Object.create(m.prototype);r.prototype.create=function(a,b,c){var a=a||{},d=c||new i;if(!this.resolved||this._parent&&!this._parent.resolved)return this.enqueue("create",a,b,d),d;a.pinned=a.locked||!1;a.active=a.focused||!1;delete a.focused;if(this._parent&&!0===
this._parent.closed)throw{name:"Invalid State Error",message:"Parent window is in the closed state and therefore is invalid"};a.windowId=this._parent?this._parent.properties.id:void 0;if(b&&b instanceof i){if(!0===b.closed)throw{name:"Invalid State Error",message:"'before' attribute is in the closed state and therefore is invalid"};if(b._windowParent&&!0===b._windowParent.closed)throw{name:"Invalid State Error",message:"Parent window of 'before' attribute is in the closed state and therefore is invalid"};
a.windowId=b._windowParent?b._windowParent.properties.id:a.windowId;a.index=b.position}chrome.tabs.create(a,function(a){for(var b in a)d.properties[b]=a[b];var c=!0;if(a.windowId){var g=p.extension.windows;b=0;for(var i=g.length;b<i;b++)if(g[b].properties.id===a.windowId){c=!1;d._windowParent=g[b];break}}c&&(d._windowParent=h.windows.getLastFocused());this.addTabs([d],d.properties.index);this!==h.tabs&&h.tabs.addTabs([d]);d.resolve(a);this.dispatchEvent(new k("create",{tab:d,prevWindow:d._windowParent,
prevTabGroup:null,prevPosition:-1}));this.dequeue()}.bind(this));return d};r.prototype.getAll=function(){for(var a=[],b=0,c=this.length;b<c;b++)a[b]=this[b];return a};r.prototype.getSelected=function(){return this._lastFocusedTab||this[0]};r.prototype.getFocused=r.prototype.getSelected;r.prototype.close=function(a){a&&(!this.resolved||this._parent&&!this._parent.resolved||!a.resolved?this.enqueue("close",a):chrome.tabs.remove(a.properties.id,function(){a.dequeue();this.dequeue()}.bind(this)))};var O=
function(){r.call(this);chrome.tabs.onCreated.addListener(function(a){l.setTimeout(function(){for(var b=!1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.id){b=!0;break}if(!b){for(var b=new i(a),e=!0,f=p.extension.windows,c=0,d=f.length;c<d;c++)if(f[c].properties.id==a.windowId){e=!1;b._windowParent=f[c];break}e&&(b._windowParent=h.windows.getLastFocused());b._windowParent.tabs.addTabs([b],b.properties.index);b._windowParent.tabs.dispatchEvent(new k("create",{tab:b,prevWindow:b._windowParent,
prevTabGroup:null,prevPosition:NaN}));this.addTabs([b]);b.resolve();this.dispatchEvent(new k("create",{tab:b,prevWindow:b._windowParent,prevTabGroup:null,prevPosition:NaN}))}}.bind(this),200)}.bind(this));chrome.tabs.onRemoved.addListener(function(a){for(var b=-1,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a){b=c;break}-1<b&&(b=(a=this[b])?a._windowParent:null,c=a?a.position:NaN,b&&b.tabs.removeTab(a),this.removeTab(a),a.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})),
b&&b.tabs.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})),this.dispatchEvent(new k("close",{tab:a,prevWindow:b,prevTabGroup:null,prevPosition:c})))}.bind(this));chrome.tabs.onUpdated.addListener(function(a,b){for(var c=-1,d=0,e=this.length;d<e;d++)if(this[d].properties.id==a){c=d;break}if(!(0>c)){c=this[c];for(d in b)c.properties[d]=b[d];if(c._windowParent){for(var f=-1,d=0,e=c._windowParent.tabs.length;d<e;d++)if(c._windowParent.tabs[d].properties.id==a){f=d;break}if(-1<
f)for(d in b)c._windowParent.tabs[f].properties[d]=b[d]}}}.bind(this));chrome.tabs.onMoved.addListener(function(a,b){for(var c=-1,d=0,e=this.length;d<e;d++)if(this[d].properties.id==a){c=d;break}if(!(0>c)){var f=(c=this[c])?c._windowParent:null;if(c){if(f){for(var g=-1,d=0,e=f.tabs.length;d<e;d++)if(f.tabs[d].properties.id==a){g=d;break}if(-1<g){d=g;for(e=f.tabs.length;d<e;d++)f.tabs[d+1]&&(f.tabs[d]=f.tabs[d+1]);delete f.tabs[c._windowParent.length-1];f.tabs.length-=1}}d=0;for(e=h.windows.length;d<
e;d++)if(h.windows[d].properties.id==b.windowId){h.windows[d].tabs.addTabs([c],b.toIndex);c._windowParent=h.windows[d];break}c.dispatchEvent(new k("move",{tab:c,prevWindow:f,prevTabGroup:null,prevPosition:b.fromIndex}));this.dispatchEvent(new k("move",{tab:c,prevWindow:f,prevTabGroup:null,prevPosition:b.fromIndex}))}}}.bind(this));chrome.tabs.onHighlighted.addListener(function(a){for(var b=0,c=h.windows.length;b<c;b++)for(var d=0,e=h.windows[b].tabs.length;d<e;d++)for(var f=0,g=a.tabIds.length;f<
g;f++)h.windows[b]==a.windowId&&h.windows[b].tabs[d].properties.id==a.tabIds[f]?(h.windows[b].tabs[d].properties.active=!0,h.windows[b].tabs._lastFocusedTab=h.windows[b].tabs[d],this._lastFocusedTab=h.windows[b].tabs[d]):h.windows[b].tabs[d].properties.active=!1}.bind(this));h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action&&"___O_getScreenshot_REQUEST"===a.data.action&&a.source.tabId){for(var b=null,c=0,d=this.length;c<d;c++)if(this[c].properties.id==a.source.tabId){b=this[c];
break}if(null!==b&&b._windowParent&&!0!=b._windowParent.properties.closed)try{chrome.tabs.captureVisibleTab(b._windowParent.properties.id,{},function(b){a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:b||null})}.bind(this))}catch(e){}else a.source.postMessage({action:"___O_getScreenshot_RESPONSE",dataUrl:void 0})}}.bind(this))};O.prototype=Object.create(r.prototype);var i=function(a,b){m.call(this);this.properties=a||{};this._windowParent=b;this._operaId=Math.floor(1E16*Math.random())};
i.prototype=Object.create(m.prototype);i.prototype.__defineGetter__("id",function(){return this._operaId});i.prototype.__defineGetter__("closed",function(){return this.properties.closed||!1});i.prototype.__defineGetter__("locked",function(){return this.properties.pinned||!1});i.prototype.__defineGetter__("focused",function(){return this.properties.active||!1});i.prototype.__defineGetter__("selected",function(){return this.properties.active||!1});i.prototype.__defineGetter__("private",function(){return this.properties.incognito||
!1});i.prototype.__defineGetter__("faviconUrl",function(){return this.properties.closed?"":this.properties.favIconUrl||""});i.prototype.__defineGetter__("title",function(){return this.properties.closed?"":this.properties.title||""});i.prototype.__defineGetter__("url",function(){return this.properties.closed?"":this.properties.url||""});i.prototype.__defineGetter__("readyState",function(){return this.properties.status||"loading"});i.prototype.__defineGetter__("browserWindow",function(){return this._windowParent});
i.prototype.__defineGetter__("tabGroup",function(){return null});i.prototype.__defineGetter__("position",function(){return this.properties.index||NaN});i.prototype.close=function(){h.tabs.close(this)};i.prototype.focus=function(){this.resolved?chrome.tabs.update(this.properties.id,{active:!0},function(){this.dequeue()}.bind(this)):this.enqueue("focus")};i.prototype.update=function(a){if(this.resolved){for(var b in a)this.properties[b]=a[b];a.active=a.focused||!1;a.pinned=a.locked||!1;delete a.focused;
chrome.tabs.update(this.properties.id,a,function(){this.dequeue()}.bind(this))}else this.enqueue("update",a)};i.prototype.refresh=function(){};i.prototype.postMessage=function(a){!this.resolved||this._windowParent&&!this._windowParent.resolved||this._windowParent&&this._windowParent._parent&&!this._windowParent._parent.resolved?this.enqueue("postMessage",a):(chrome.tabs.sendMessage(this.properties.id,a),this.dequeue())};i.prototype.getScreenshot=function(a){if(!this.resolved||this._windowParent&&
!this._windowParent.resolved||this._windowParent&&this._windowParent._parent&&!this._windowParent._parent.resolved)this.enqueue("getScreenshot",a);else if(!this._windowParent||!0===this._windowParent.properties.closed)a.call(this,void 0);else try{chrome.tabs.captureVisibleTab(this._windowParent.properties.id,{},function(b){if(b){var d=document.createElement("canvas"),e=d.getContext("2d"),f=new Image;f.onload=function(){d.width=f.width;d.height=f.height;e.drawImage(f,0,0);var b=e.getImageData(0,0,
d.width,d.height);a.call(this,b);this.dequeue()}.bind(this);f.src=b}else a.call(this,void 0)}.bind(this))}catch(b){}};h.windows=h.windows||new j;h.tabs=h.tabs||new O;j=function(){B.mixin(this);chrome.browserAction.onClicked.addListener(function(){this[0]&&this[0].dispatchEvent(new k("click",{}));this.dispatchEvent(new k("click",{}))}.bind(this))};j.prototype=Object.create(g.prototype);j.prototype.createItem=function(a){return new o(a)};j.prototype.addItem=function(a){a&&a instanceof o&&(this[0]=a,
this.length=1,a.resolve(),a.apply(),a.badge.resolve(),a.badge.apply(),a.popup.resolve(),a.popup.apply(),chrome.browserAction.enable())};j.prototype.removeItem=function(a){a&&a instanceof o&&(this[0]&&this[0]===a)&&(delete this[0],this.length=0,chrome.browserAction.disable(),a.dispatchEvent(new k("remove",{})),this.dispatchEvent(new k("remove",{})))};var q=function(a){m.call(this);this.properties={};this.properties.textContent=a.textContent;this.properties.backgroundColor=D(a.backgroundColor);this.properties.color=
D(a.color);this.properties.display=a.display};q.prototype=Object.create(m.prototype);q.prototype.apply=function(){chrome.browserAction.setBadgeBackgroundColor({color:this.backgroundColor||"#f00"});"block"===this.display?chrome.browserAction.setBadgeText({text:this.textContent}):chrome.browserAction.setBadgeText({text:""})};q.prototype.__defineGetter__("textContent",function(){return this.properties.textContent});q.prototype.__defineSetter__("textContent",function(a){this.properties.textContent=""+
a;this.resolved&&"block"===this.properties.display&&chrome.browserAction.setBadgeText({text:""+a})});q.prototype.__defineGetter__("backgroundColor",function(){return this.properties.backgroundColor});q.prototype.__defineSetter__("backgroundColor",function(a){this.properties.backgroundColor=D(""+a);this.resolved&&chrome.browserAction.setBadgeBackgroundColor({color:this.properties.backgroundColor})});q.prototype.__defineGetter__("color",function(){return this.properties.color});q.prototype.__defineSetter__("color",
function(a){this.properties.color=D(""+a)});q.prototype.__defineGetter__("display",function(){return this.properties.display});q.prototype.__defineSetter__("display",function(a){"block"===(""+a).toLowerCase()?(this.properties.display="block",this.resolved&&chrome.browserAction.setBadgeText({text:this.properties.textContent})):(this.properties.display="none",this.resolved&&chrome.browserAction.setBadgeText({text:""}))});var s=function(a){m.call(this);this.properties={};this.properties.href=a.href||
"";this.properties.width=a.width;this.properties.height=a.height};s.prototype=Object.create(m.prototype);s.prototype.apply=function(){chrome.browserAction.setPopup({popup:this.href})};s.prototype.__defineGetter__("href",function(){return this.properties.href});s.prototype.__defineSetter__("href",function(a){this.properties.href=""+a;this.resolved&&chrome.browserAction.setPopup({popup:""+a})});s.prototype.__defineGetter__("width",function(){return this.properties.width});s.prototype.__defineSetter__("width",
function(a){this.properties.width=a});s.prototype.__defineGetter__("height",function(){return this.properties.height});s.prototype.__defineSetter__("height",function(a){this.properties.height=a});var o=function(a){m.call(this);this.properties={};this.properties.disabled=a.disabled||!1;this.properties.title=a.title||"";this.properties.icon=a.icon||"";this.properties.popup=new s(a.popup||{});this.properties.badge=new q(a.badge||{})};o.prototype=Object.create(m.prototype);o.prototype.apply=function(){!0===
this.disabled?chrome.browserAction.disable():chrome.browserAction.enable();chrome.browserAction.setTitle({title:this.title});chrome.browserAction.setIcon({path:this.icon})};o.prototype.__defineGetter__("disabled",function(){return this.properties.disabled});o.prototype.__defineSetter__("disabled",function(a){this.properties.disabled!==a&&(!0===a||"true"===a||1===a||"1"===a?(this.properties.disabled=!0,this.resolved&&chrome.browserAction.disable()):(this.properties.disabled=!1,this.resolved&&chrome.browserAction.enable()))});
o.prototype.__defineGetter__("title",function(){return this.properties.title});o.prototype.__defineSetter__("title",function(a){this.properties.title=""+a;this.resolved&&chrome.browserAction.setTitle({title:this.title})});o.prototype.__defineGetter__("icon",function(){return this.properties.icon});o.prototype.__defineSetter__("icon",function(a){this.properties.icon=""+a;this.resolved&&chrome.browserAction.setIcon({path:this.icon})});o.prototype.__defineGetter__("popup",function(){return this.properties.popup});
o.prototype.__defineGetter__("badge",function(){return this.properties.badge});C.toolbar=C.toolbar||new j;if(l.opera)x=!0,p.isReady=function(a){a.call(p);for(var a=0,b=u.length;a<b;a++){var c=u[a];c.target[c.methodName].apply(c.target,c.args)}u=[]};else{var g=function(a,b){var c=a.addEventListener;a.addEventListener=function(d,e,f){d.toLowerCase()===b.toLowerCase()?void 0===e||(null===e||"[object Function]"!==Object.prototype.toString.call(e))||(x?e.call(l):t[b.toLowerCase()].push(e)):c.call(a,d,
e,f)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},P=function(a,b){for(var c=a.toLowerCase(),d=new k(c,{}),e=0,f=t[c].length;e<f;e++)t[c][e].call(b,d);t[c]=[]},t={isready:[],domcontentloaded:[],load:[]},Q=!1,G=!1;l.document.addEventListener("DOMContentLoaded",function b(){Q=!0;l.document.removeEventListener("DOMContentLoaded",b,!0)},!0);l.addEventListener("load",function c(){G=!0;l.removeEventListener("load",c,!0)},!0);g(l,"load");g(l.document,"domcontentloaded");
g(l,"domcontentloaded");var U=(new Date).getTime()+3E3;(function d(){if((new Date).getTime()>=U)console.warn("opera.isReady check timed out"),G=!0;else for(var e in A)if(!0!==A[e]){l.setTimeout(function(){d()},20);return}l.setTimeout(function(){if(!x){for(var d=0,e=t.isready.length;d<e;d++)t.isready[d].call(l);t.isready=[];var g=(new Date).getTime()+3E3;(function R(){var d=(new Date).getTime();if(Q||G||d>=g){P("domcontentloaded",l.document);d>=g&&console.warn("document.domcontentloaded event fired on check timeout");
var e=(new Date).getTime()+3E3;(function S(){var d=(new Date).getTime();if(G||d>=e){P("load",window);d>=e&&console.warn("window.load event fired on check timeout");for(var d=0,f=u.length;d<f;d++){var g=u[d];g.target[g.methodName].apply(g.target,g.args)}u=[]}else l.setTimeout(function(){S()},50)})()}else l.setTimeout(function(){R()},50)})();x=!0}},0)})();p.isReady=function(d){x?d.call(l):t.isready.push(d)}}l.opera=p}(window);
