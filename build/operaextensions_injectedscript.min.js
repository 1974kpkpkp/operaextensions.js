// operaextensions_injectedscript.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(e,k){function t(a,b,d){r?a[b].apply(a,d):o.push({target:a,methodName:b,args:d})}var f=function(){};f.prototype.REVISION="1";f.prototype.version=function(){return this.REVISION};f.prototype.buildNumber=function(){return this.REVISION};f.prototype.postError=function(a){console.log(a)};var m=e.opera||new f,r=!1,o=[],u={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},s={},g="undefined"!==typeof window?window:{},g=g.MutationObserver||g.WebKitMutationObserver;if("undefined"!==
typeof process&&"[object process]"==={}.toString.call(process))g=function(a,b){process.nextTick(function(){a.call(b)})};else if(g){var A=[],g=new g(function(){var a=A.slice();A=[];a.forEach(function(a){a[0].call(a[1])})}),C=document.createElement("div");g.observe(C,{attributes:!0});g=function(a,b){A.push([a,b]);C.setAttribute("drainQueue","drainQueue")}}else g=function(a,b){setTimeout(function(){a.call(b)},1)};s.async=g;var D=s.Event=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=
b[d])},E=function(a,b){for(var d=0,c=a.length;d<c;d++)if(a[d][0]===b)return d;return-1},v=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},p=s.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){for(var c=v(this),i,e,a=a.split(/\s+/),d=d||this;e=a.shift();)(i=c[e])||(i=c[e]=[]),-1===E(i,b)&&i.push([b,d])},off:function(a,b){for(var d=v(this),c,i,a=a.split(/\s+/);c=a.shift();)b?(c=d[c],i=E(c,b),-1!==i&&c.splice(i,
1)):d[c]=[]},trigger:function(a,b){var d,c,i,e;if(d=v(this)[a])for(var f=0,g=d.length;f<g;f++)c=d[f],i=c[0],c=c[1],"object"!==typeof b&&(b={detail:b}),e=new D(a,b),i.call(c,e)}},w=s.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},F=function(){},G=function(a,b,d,c){var i,e;if(d)try{i=d(c.detail)}catch(f){e=f}else i=c.detail;if(i instanceof w)i.then(function(a){b.resolve(a)},
function(a){b.reject(a)});else if(d&&i)b.resolve(i);else if(e)b.reject(e);else b[a](i)};w.prototype={then:function(a,b){var d=new w;this.on("promise:resolved",function(b){G("resolve",d,a,b)});this.on("promise:failed",function(a){G("reject",d,b,a)});return d},resolve:function(a){s.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=F},reject:function(a){s.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=F}};p.mixin(w.prototype);var l=function(a,b){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var c in b)d[c]=b[c];return d},g=function(){p.mixin(this)};g.prototype.constructor=g;g.prototype.addEventListener=function(a,b){this.on(a,b)};g.prototype.removeEventListener=function(a,b){this.off(a,b)};g.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};var x=function(a){p.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new l("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,d,c){var e=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new l("controlmessage",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:d&&d.tab?d.tab.id:
null}})):t(this,"dispatchEvent",[new l("message",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})]);c&&c({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),t(this,"dispatchEvent",[new l("connect",{source:this._localPort})]))};x.prototype=Object.create(g.prototype);x.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var h=function(){x.call(this,
!1)};h.prototype=Object.create(x.prototype);h.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});h.prototype.getScreenshot=function(a){var b=function(d){if(d.data&&d.data.action&&"___O_getScreenshot_RESPONSE"===d.data.action&&d.data.dataUrl){var c=document.createElement("canvas"),e=c.getContext("2d"),f=new Image;f.onload=function(){c.width=f.width;c.height=f.height;e.drawImage(f,0,0);var b=e.getImageData(0,0,c.width,c.height);a.call(this,b)};f.src=d.data.dataUrl;
j.removeEventListener("controlmessage",b)}}.bind(this);j.addEventListener("controlmessage",b);j.postMessage({action:"___O_getScreenshot_REQUEST"})};var j=m.extension=m.extension||new h,H=m.contexts=m.contexts||{};h.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var d=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(d)?d:"")+a,c=new XMLHttpRequest;c.onloadend=function(){c.readyState==
c.DONE&&200==c.status&&(result=c.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};c.open("GET",a,!1);c.responseType="blob";c.send(null)}catch(e){}return b};var q=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(q.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(q.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==
a)return a;b++}return null}});Object.defineProperty(q.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||j.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(q.prototype,"setItem",{value:function(a,b,d){this[a]||this.length++;this[a]=b;d||j.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(q.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&
delete this[b];this.length=0;a||j.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};q.prototype=Object.create(Storage.prototype);h=function(){p.mixin(this);this.properties=k||{};this._preferences=new q;this._preferencesSet={};j.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];u.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=
a.data._prefs[b],this._preferences.length++;u.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);j.postMessage({action:"___O_widget_setup_REQUEST"});e.addEventListener("beforeunload",function(){},!1)};h.prototype=
Object.create(g.prototype);h.prototype.__defineGetter__("name",function(){return this.properties.name||""});h.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});h.prototype.__defineGetter__("id",function(){return this.properties.id||""});h.prototype.__defineGetter__("description",function(){return this.properties.description||""});h.prototype.__defineGetter__("author",function(){return this.properties.author||""});h.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});h.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});h.prototype.__defineGetter__("version",function(){return this.properties.version||""});h.prototype.__defineGetter__("preferences",function(){return this._preferences});e.widget=e.widget||new h;p.mixin(f.prototype);f.prototype.defineMagicVariable=function(a,b,d){if(!(void 0===b||void 0===d)){var c={"[object Function]":1,
"[object Null]":1};Object.prototype.toString.call(b)in c&&Object.prototype.toString.call(d)in c&&(c=document.createElement("script"),c.setAttribute("type","text/javascript"),"[object Function]"===Object.prototype.toString.call(b)&&(c.textContent+="window.__defineGetter__('"+a+"', "+b.toString()+");\n"),d&&"[object Function]"===Object.prototype.toString.call(d)&&(c.textContent+="window.__defineSetter__('"+a+"', "+d.toString()+");\n"),document.getElementsByTagName("head")[0].appendChild(c),document.getElementsByTagName("head")[0].removeChild(c))}};
f.prototype.defineMagicFunction=function(a,b){if(b&&"[object Function]"===Object.prototype.toString.call(b)){var d=document.createElement("script");d.setAttribute("type","text/javascript");d.textContent="var "+a+" = "+b.toString()+";";document.getElementsByTagName("head")[0].appendChild(d);document.getElementsByTagName("head")[0].removeChild(d)}};f.prototype.addEventListener=function(){};f.prototype.removeEventListener=function(){};f.prototype.__defineGetter__("scriptStorage",function(){return widget.preferences});
f.prototype.setOverrideHistoryNavigationMode=function(){};f.prototype.__defineGetter__("getOverrideHistoryNavigationMode",function(){return"automatic"});var B,I=null;document.addEventListener("contextmenu",function(a){I=a.srcElement},!1);B=function(a,b,d){a=l(a,{documentURL:b.info.pageUrl,pageURL:b.info.pageUrl,isEditable:b.info.editable,linkURL:b.info.linkUrl||null,mediaType:b.info.mediaType||null,selectionText:b.info.selectionText||null,source:null,srcURL:b.info.srcUrl||null});Object.defineProperty(a,
"target",{enumerable:!0,configurable:!1,get:function(){return d||null},set:function(){}});Object.defineProperty(a,"srcElement",{enumerable:!0,configurable:!1,get:function(a){return function(){return a||null}}(I),set:function(){}});return a};B.prototype=Object.create(D.prototype);var y=function(){var a={};p.mixin(a);var b=null;Object.defineProperty(this,"onclick",{enumerable:!0,configurable:!1,get:function(){return b},set:function(a){null!=b&&this.removeEventListener("click",b,!1);b=a;null!=b&&b instanceof
Function?this.addEventListener("click",b,!1):b=null}});Object.defineProperty(this,"dispatchEvent",{enumerable:!1,configurable:!1,writable:!1,value:function(b){var c=this,e=!1;Object.defineProperty(b,"currentTarget",{enumerable:!0,configurable:!1,get:function(){return c},set:function(){}});Object.defineProperty(b,"stopImmediatePropagation",{enumerable:!0,configurable:!1,writable:!1,value:function(){e=!0}});var f=v(a)[b.type],g,h;if(f)for(var j=0,k=f.length;j<k;j++)g=f[j],h=g[0],g=g[1],e||h.call(g,
b)}});Object.defineProperty(this,"addEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,c){a.on(b,c,this)}});Object.defineProperty(this,"removeEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,c){a.off(b,c,this)}})},J=function(a){y.call(this);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuItemProxy]"}});Object.defineProperty(this,"id",{enumerable:!0,configurable:!1,get:function(){return a},
set:function(){}})};J.prototype=Object.create(y.prototype);f=function(){y.call(this);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuContextProxy]"}});j.addEventListener("controlmessage",function(a){a.data&&(a.data.action&&"___O_MenuItem_Click"===a.data.action)&&this.dispatchEvent(new B("click",{info:a.data.info,tab:null},new J(a.data.menuItemId)))}.bind(this))};f.prototype=Object.create(y.prototype);k&&(k.permissions&&-1!=k.permissions.indexOf("contextMenus"))&&
(H.menu=H.menu||new f);f=function(){p.mixin(this);this.pageSrcElements={};e.addEventListener("load",function(){for(var a=e.document.querySelectorAll("[src],link[rel='stylesheet'][href],object[data],body[background]"),b=0,d=a.length;b<d;b++){var c=e.encodeURIComponent(a[b].src||a[b].href||a[b].data||a[b].background);this.pageSrcElements[c]===void 0&&(this.pageSrcElements[c]=[]);this.pageSrcElements[c].push(a[b])}}.bind(this),false);this.matchUrlToInPageElement=function(a){a=e.encodeURIComponent(a);
if(this.pageSrcElements[a]!==void 0&&this.pageSrcElements[a].length>0)return this.pageSrcElements[a].shift()};j.addEventListener("controlmessage",function(a){if(a.data&&a.data.action){a.data.data=a.data.data||{};switch(a.data.action){case "___O_urlfilter_contentblocked":a.data.data.element=this.matchUrlToInPageElement(a.data.data.url);this.dispatchEvent(new l("contentblocked",a.data.data));break;case "___O_urlfilter_contentunblocked":a.data.data.element=this.matchUrlToInPageElement(a.data.data.url);
this.dispatchEvent(new l("contentunblocked",a.data.data));break;case "___O_urlfilter_contentallowed":a.data.data.element=this.matchUrlToInPageElement(a.data.data.url);this.dispatchEvent(new l("contentallowed",a.data.data))}}}.bind(this))};f.prototype=Object.create(g.prototype);f.prototype.addEventListener=function(a,b){a=(a+"").toLowerCase();this.on(a,b);t(j,"postMessage",[{action:"___O_urlfilter_DRAINQUEUE",eventType:a}])};j.urlfilter=j.urlfilter||new f;if(e.opera)r=!0,m.isReady=function(a){a.call(m);
for(var a=0,b=o.length;a<b;a++){var d=o[a];d.target[d.methodName].apply(d.target,d.args)}o=[]};else{var f=function(a,b){var d=a.addEventListener;a.addEventListener=function(c,f,g){c.toLowerCase()===b.toLowerCase()?f===void 0||(f===null||Object.prototype.toString.call(f)!=="[object Function]")||(r?f.call(e):n[b.toLowerCase()].push(f)):d.call(a,c,f,g)};a.__defineSetter__("on"+b.toLowerCase(),function(d){a.addEventListener(b.toLowerCase(),d,false)})},K=function(a,b){for(var d=a.toLowerCase(),c=new l(d,
{}),e=0,f=n[d].length;e<f;e++)n[d][e].call(b,c);n[d]=[]},n={isready:[],domcontentloaded:[],load:[]},L=!1,z=!1;e.document.addEventListener("DOMContentLoaded",function b(){L=true;e.document.removeEventListener("DOMContentLoaded",b,true)},!0);e.addEventListener("load",function d(){z=true;e.removeEventListener("load",d,true)},!0);f(e,"load");f(e.document,"domcontentloaded");f(e,"domcontentloaded");var N=(new Date).getTime()+3E3;(function c(){if((new Date).getTime()>=N){console.warn("opera.isReady check timed out");
z=true}else for(var f in u)if(u[f]!==true){e.setTimeout(function(){c()},20);return}e.setTimeout(function(){if(!r){for(var c=0,f=n.isready.length;c<f;c++)n.isready[c].call(e);n.isready=[];var g=(new Date).getTime()+3E3;(function M(){var c=(new Date).getTime();if(L||z||c>=g){K("domcontentloaded",e.document);c>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+3E3;(function O(){var c=(new Date).getTime();if(z||c>=f){K("load",window);c>=f&&console.warn("window.load event fired on check timeout");
for(var c=0,g=o.length;c<g;c++){var h=o[c];h.target[h.methodName].apply(h.target,h.args)}o=[]}else e.setTimeout(function(){O()},50)})()}else e.setTimeout(function(){M()},50)})();r=true}},0)})();m.isReady=function(c){r?c.call(e):n.isready.push(c)}}e.opera=m}(window,function(){var e=null;try{if(e=chrome.app.getDetails(),null==e){var k=new XMLHttpRequest;k.onloadend=function(){k.readyState==k.DONE&&200==k.status&&(e=JSON.parse(k.responseText),e.id=/^chrome\-extension\:\/\/(.*)\/$/.exec(chrome.extension.getURL(""))[1])};
k.open("GET",chrome.extension.getURL("")+"manifest.json",!1);k.send(null)}}catch(t){e=null}return e}());
