// operaextensions_injectedscript.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(f){function B(a,b,c){q?a[b].apply(a,c):n.push({target:a,methodName:b,args:c})}var g=function(){};g.prototype.REVISION="1";g.prototype.version=function(){return this.REVISION};g.prototype.buildNumber=function(){return this.REVISION};g.prototype.postError=function(a){console.log(a)};var l=f.opera||new g,q=!1,n=[],u={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},r={},j="undefined"!==typeof window?window:{},j=j.MutationObserver||j.WebKitMutationObserver;if("undefined"!==typeof process&&
"[object process]"==={}.toString.call(process))j=function(a,b){process.nextTick(function(){a.call(b)})};else if(j){var z=[],j=new j(function(){var a=z.slice();z=[];a.forEach(function(a){a[0].call(a[1])})}),C=document.createElement("div");j.observe(C,{attributes:!0});j=function(a,b){z.push([a,b]);C.setAttribute("drainQueue","drainQueue")}}else j=function(a,b){setTimeout(function(){a.call(b)},1)};r.async=j;var D=r.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},E=
function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===b)return c;return-1},v=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},s=r.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){for(var d=v(this),e,h,a=a.split(/\s+/),c=c||this;h=a.shift();)(e=d[h])||(e=d[h]=[]),-1===E(e,b)&&e.push([b,c])},off:function(a,b){for(var c=v(this),d,e,a=a.split(/\s+/);d=a.shift();)b?(d=c[d],e=E(d,b),-1!==e&&d.splice(e,1)):c[d]=
[]},trigger:function(a,b){var c,d,e,h;if(c=v(this)[a])for(var f=0,g=c.length;f<g;f++)d=c[f],e=d[0],d=d[1],"object"!==typeof b&&(b={detail:b}),h=new D(a,b),e.call(d,h)}},w=r.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},F=function(){},G=function(a,b,c,d){var e,h;if(c)try{e=c(d.detail)}catch(f){h=f}else e=d.detail;if(e instanceof w)e.then(function(a){b.resolve(a)},
function(a){b.reject(a)});else if(c&&e)b.resolve(e);else if(h)b.reject(h);else b[a](e)};w.prototype={then:function(a,b){var c=new w;this.on("promise:resolved",function(b){G("resolve",c,a,b)});this.on("promise:failed",function(a){G("reject",c,b,a)});return c},resolve:function(a){r.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=F},reject:function(a){r.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=F}};s.mixin(w.prototype);var t=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!0,!0);for(var d in b)c[d]=b[d];return c},o=function(){s.mixin(this)};o.prototype.constructor=o;o.prototype.addEventListener=function(a,b){this.on(a,b)};o.prototype.removeEventListener=function(a,b){this.off(a,b)};o.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};var x=function(a){s.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new t("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new t("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},
tabId:c&&c.tab?c.tab.id:null}})):B(this,"dispatchEvent",[new t("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})])}.bind(this)),B(this,"dispatchEvent",[new t("connect",{source:this._localPort})]))};x.prototype=Object.create(o.prototype);x.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var i=function(){x.call(this,!1)};i.prototype=Object.create(x.prototype);i.prototype.__defineGetter__("bgProcess",
function(){return chrome.extension.getBackgroundPage()});i.prototype.getScreenshot=function(a){var b=function(c){if(c.data&&c.data.action&&"___O_getScreenshot_RESPONSE"===c.data.action&&c.data.dataUrl){var d=document.createElement("canvas"),e=d.getContext("2d"),h=new Image;h.onload=function(){d.width=h.width;d.height=h.height;e.drawImage(h,0,0);var b=e.getImageData(0,0,d.width,d.height);a.call(this,b)};h.src=c.data.dataUrl;k.removeEventListener("controlmessage",b)}}.bind(this);k.addEventListener("controlmessage",
b);k.postMessage({action:"___O_getScreenshot_REQUEST"})};var k=l.extension=l.extension||new i,j=l.contexts=l.contexts||{};i.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var c=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(c)?c:"")+a,d=new XMLHttpRequest;d.onloadend=function(){d.readyState==d.DONE&&200==d.status&&(result=d.response,result.name=a.substring(a.lastIndexOf("/")+
1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};d.open("GET",a,!1);d.responseType="blob";d.send(null)}catch(e){}return b};var p=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(p.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(p.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});Object.defineProperty(p.prototype,
"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||k.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(p.prototype,"setItem",{value:function(a,b,c){this[a]||this.length++;this[a]=b;c||k.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(p.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||
k.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};p.prototype=Object.create(Storage.prototype);i=function(){s.mixin(this);this.properties={};this._preferences=new p;this._preferencesSet={};k.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];u.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;
u.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);k.postMessage({action:"___O_widget_setup_REQUEST"});f.addEventListener("beforeunload",function(){},!1)};i.prototype=Object.create(o.prototype);i.prototype.__defineGetter__("name",
function(){return this.properties.name||""});i.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});i.prototype.__defineGetter__("id",function(){return this.properties.id||""});i.prototype.__defineGetter__("description",function(){return this.properties.description||""});i.prototype.__defineGetter__("author",function(){return this.properties.author||""});i.prototype.__defineGetter__("authorHref",function(){return this.properties.author?
this.properties.author.href||"":""});i.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});i.prototype.__defineGetter__("version",function(){return this.properties.version||""});i.prototype.__defineGetter__("preferences",function(){return this._preferences});f.widget=f.widget||new i;s.mixin(g.prototype);g.prototype.defineMagicVariable=function(a,b,c){if(b&&"[object Function]"===Object.prototype.toString.call(b)&&c&&"[object Function]"===
Object.prototype.toString.call(c)){var d=document.createElement("script");d.setAttribute("type","text/javascript");b&&"[object Function]"===Object.prototype.toString.call(b)&&(d.textContent+="window.__defineGetter__('"+a+"', "+b.toString()+");\n");c&&"[object Function]"===Object.prototype.toString.call(c)&&(d.textContent+="window.__defineSetter__('"+a+"', "+c.toString()+");\n");document.getElementsByTagName("head")[0].appendChild(d)}};g.prototype.defineMagicFunction=function(a,b){if(b&&"[object Function]"===
Object.prototype.toString.call(b)){var c=document.createElement("script");c.setAttribute("type","text/javascript");c.textContent="var "+a+" = "+b.toString()+";";document.getElementsByTagName("head")[0].appendChild(c)}};g.prototype.addEventListener=function(){};g.prototype.removeEventListener=function(){};g.prototype.__defineGetter__("scriptStorage",function(){return widget.preferences});g.prototype.setOverrideHistoryNavigationMode=function(){};g.prototype.__defineGetter__("getOverrideHistoryNavigationMode",
function(){return"automatic"});document.addEventListener("contextmenu",function(){},!1);Object.create(D.prototype);var A=function(){var a={};s.mixin(a);var b=null;Object.defineProperty(this,"onclick",{enumerable:!0,configurable:!1,get:function(){return b},set:function(a){null!=b&&this.removeEventListener("click",b,!1);b=a;null!=b&&b instanceof Function?this.addEventListener("click",b,!1):b=null}});Object.defineProperty(this,"dispatchEvent",{enumerable:!1,configurable:!1,writable:!1,value:function(b){var d=
this,e=!1;Object.defineProperty(b,"currentTarget",{enumerable:!0,configurable:!1,get:function(){return d},set:function(){}});Object.defineProperty(b,"stopImmediatePropagation",{enumerable:!0,configurable:!1,writable:!1,value:function(){e=!0}});var h=v(a)[b.type],f,g;if(h)for(var i=0,j=h.length;i<j;i++)f=h[i],g=f[0],f=f[1],e||g.call(f,b)}});Object.defineProperty(this,"addEventListener",{enumerable:!0,configurable:!1,writable:!1,value:function(b,d){a.on(b,d,this)}});Object.defineProperty(this,"removeEventListener",
{enumerable:!0,configurable:!1,writable:!1,value:function(b,d){a.off(b,d,this)}})};Object.create(A.prototype);g=function(){A.call(this);Object.defineProperty(this,"toString",{enumerable:!1,configurable:!1,writable:!1,value:function(){return"[object MenuContextProxy]"}});k.addEventListener("controlmessage",function(a){a.data&&(a.data.action&&"___O_MenuItem_Click"===a.data.action)&&alert("content menu event message")}.bind(this));k.postMessage({})};g.prototype=Object.create(A.prototype);j.menu=j.menu||
new g;if(f.opera)q=!0,l.isReady=function(a){a.call(l);for(var a=0,b=n.length;a<b;a++){var c=n[a];c.target[c.methodName].apply(c.target,c.args)}n=[]};else{var g=function(a,b){var c=a.addEventListener;a.addEventListener=function(d,e,h){d.toLowerCase()===b.toLowerCase()?void 0===e||(null===e||"[object Function]"!==Object.prototype.toString.call(e))||(q?e.call(f):m[b.toLowerCase()].push(e)):c.call(a,d,e,h)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},
H=function(a,b){for(var c=a.toLowerCase(),d=new t(c,{}),e=0,f=m[c].length;e<f;e++)m[c][e].call(b,d);m[c]=[]},m={isready:[],domcontentloaded:[],load:[]},I=!1,y=!1;f.document.addEventListener("DOMContentLoaded",function b(){I=!0;f.document.removeEventListener("DOMContentLoaded",b,!0)},!0);f.addEventListener("load",function c(){y=!0;f.removeEventListener("load",c,!0)},!0);g(f,"load");g(f.document,"domcontentloaded");g(f,"domcontentloaded");var K=(new Date).getTime()+3E3;(function d(){if((new Date).getTime()>=
K)console.warn("opera.isReady check timed out"),y=!0;else for(var e in u)if(!0!==u[e]){f.setTimeout(function(){d()},20);return}f.setTimeout(function(){if(!q){for(var d=0,e=m.isready.length;d<e;d++)m.isready[d].call(f);m.isready=[];var g=(new Date).getTime()+3E3;(function J(){var d=(new Date).getTime();if(I||y||d>=g){H("domcontentloaded",f.document);d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var e=(new Date).getTime()+3E3;(function L(){var d=(new Date).getTime();if(y||
d>=e){H("load",window);d>=e&&console.warn("window.load event fired on check timeout");for(var d=0,g=n.length;d<g;d++){var h=n[d];h.target[h.methodName].apply(h.target,h.args)}n=[]}else f.setTimeout(function(){L()},50)})()}else f.setTimeout(function(){J()},50)})();q=!0}},0)})();l.isReady=function(d){q?d.call(f):m.isready.push(d)}}f.opera=l}(window);
