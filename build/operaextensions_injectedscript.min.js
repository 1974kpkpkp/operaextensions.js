// operaextensions_injectedscript.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(k){var h=k.opera||{REVISION:"1",postError:function(a){console.log(a)}},f=h._RSVP={},c="undefined"!==typeof window?window:{},c=c.MutationObserver||c.WebKitMutationObserver;if("undefined"!==typeof process)c=function(a,b){process.nextTick(function(){a.call(b)})};else if(c){var o=[],c=new c(function(){var a=o.slice();o=[];a.forEach(function(a){a[0].call(a[1])})}),r=document.createElement("div");c.observe(r,{attributes:!0});c=function(a,b){o.push([a,b]);r.setAttribute("drainQueue",
"drainQueue")}}else c=function(a,b){setTimeout(function(){a.call(b)},1)};f.async=c;var u=f.Event=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])},s=function(a,b){for(var d=0,l=a.length;d<l;d++)if(a[d][0]===b)return d;return-1},p=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},c=f.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){var l=p(this),c,d=d||this;(c=l[a])||(c=l[a]=[]);-1===
s(c,b)&&c.push([b,d])},off:function(a,b){var d=p(this);if(b){var d=d[a],c=s(d,b);-1!==c&&d.splice(c,1)}else d[a]=[]},trigger:function(a,b){var d,c,t,g;if(d=p(this)[a])for(var e=0,f=d.length;e<f;e++)c=d[e],t=c[0],c=c[1],"object"!==typeof b&&(b={detail:b}),g=new u(a,b),t.call(c,g)}},m=f.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)};f.invokeCallback=function(a,
b,d,c){var e,g;if(d)try{e=d(c.detail)}catch(f){g=f}else e=c.detail;if(e instanceof m)e.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(d&&e)b.resolve(e);else if(g)b.reject(g);else b[a](e)};m.prototype={then:function(a,b){var d=new m;this.on("promise:resolved",function(b){f.invokeCallback("resolve",d,a,b)});this.on("promise:failed",function(a){f.invokeCallback("reject",d,b,a)});return d},resolve:function(a){f.async(function(){this.trigger("promise:resolved",{detail:a})},this);this.resolve=
function(){};this.reject=function(){}},reject:function(a){f.async(function(){this.trigger("promise:failed",{detail:a})},this);this.resolve=function(){};this.reject=function(){}}};c.mixin(m.prototype);var e=function(){h._RSVP.Promise.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};e.prototype=Object.create(h._RSVP.Promise.prototype);e.prototype.addEventListener=e.prototype.on;e.prototype.removeEventListener=e.prototype.off;
e.prototype.fireEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};e.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],b=[];if(1<arguments.length)for(var d=1,c=arguments.length;d<c;d++)b.push(arguments[d]);this._queue.push({action:a,args:b})}};e.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var q=function(a,
b){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var c in b)d[c]=b[c];return d},n=function(a){e.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new q("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,c){var e="message";a&&(a.action&&
0===a.action.indexOf("___O_"))&&(e="controlmessage");this.fireEvent(new q(e,{data:a,source:{postMessage:function(a){this._localPort.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}}))}.bind(this)),k.addEventListener("load",function(){this.fireEvent(new q("connect",{source:this._localPort}))}.bind(this),!1))};n.prototype=Object.create(e.prototype);n.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};c=function(){n.call(this,!1)};
c.prototype=Object.create(n.prototype);c.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});c.prototype.getScreenshot=function(a){var b=function(c){if(c.data&&c.data.action&&"___O_getScreenshot_RESPONSE"===c.data.action&&c.data.dataUrl){var e=document.createElement("canvas"),f=e.getContext("2d"),g=new Image;g.onload=function(){e.width=g.width;e.height=g.height;f.drawImage(g,0,0);var b=f.getImageData(0,0,e.width,e.height);a.call(this,b)};g.src=c.data.dataUrl;
i.removeEventListener("controlmessage",b)}}.bind(this);i.addEventListener("controlmessage",b);i.postMessage({action:"___O_getScreenshot_REQUEST"})};var i=h.extension=h.extension||new c;h.contexts=h.contexts||{};var j=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(j.prototype,"getItem",{value:function(a){return this[a]}});Object.defineProperty(j.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});
Object.defineProperty(j.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||i.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(j.prototype,"setItem",{value:function(a,b,c){this[a]||this.length++;this[a]=b;c||i.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(j.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&
delete this[b];this.length=0;a||i.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})},c=function(){this.properties={};this._preferences=new j;this._preferencesSet={};i.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,
a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);i.postMessage({action:"___O_widget_setup_REQUEST"})};c.prototype=Object.create(e.prototype);c.prototype.__defineGetter__("name",function(){return this.properties.name||""});c.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||
"":""});c.prototype.__defineGetter__("id",function(){return this.properties.id||""});c.prototype.__defineGetter__("description",function(){return this.properties.description||""});c.prototype.__defineGetter__("author",function(){return this.properties.author||""});c.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});c.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":
""});c.prototype.__defineGetter__("version",function(){return this.properties.version||""});c.prototype.__defineGetter__("preferences",function(){return this._preferences});k.widget=k.widget||new c;k.opera=h}(window);
