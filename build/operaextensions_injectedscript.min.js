// operaextensions_injectedscript.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(l){var m=l.opera||{REVISION:"1",postError:function(a){console.log(a)}},i={},b="undefined"!==typeof window?window:{},b=b.MutationObserver||b.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))b=function(a,c){process.nextTick(function(){a.call(c)})};else if(b){var o=[],b=new b(function(){var a=o.slice();o=[];a.forEach(function(a){a[0].call(a[1])})}),r=document.createElement("div");b.observe(r,{attributes:!0});b=function(a,c){o.push([a,
c]);r.setAttribute("drainQueue","drainQueue")}}else b=function(a,c){setTimeout(function(){a.call(c)},1)};i.async=b;var w=i.Event=function(a,c){this.type=a;for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])},s=function(a,c){for(var e=0,f=a.length;e<f;e++)if(a[e][0]===c)return e;return-1},p=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},b=i.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,e){for(var f=p(this),
b,g,a=a.split(/\s+/),e=e||this;g=a.shift();)(b=f[g])||(b=f[g]=[]),-1===s(b,c)&&b.push([c,e])},off:function(a,c){for(var e=p(this),f,b,a=a.split(/\s+/);f=a.shift();)c?(f=e[f],b=s(f,c),-1!==b&&f.splice(b,1)):e[f]=[]},trigger:function(a,c){var e,b,t,g;if(e=p(this)[a])for(var d=0,h=e.length;d<h;d++)b=e[d],t=b[0],b=b[1],"object"!==typeof c&&(c={detail:c}),g=new w(a,c),t.call(b,g)}},j=i.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",
function(a){this.trigger("error",{detail:a.detail})},this)},u=function(){},v=function(a,c,e,b){var d,g;if(e)try{d=e(b.detail)}catch(h){g=h}else d=b.detail;if(d instanceof j)d.then(function(a){c.resolve(a)},function(a){c.reject(a)});else if(e&&d)c.resolve(d);else if(g)c.reject(g);else c[a](d)};j.prototype={then:function(a,c){var b=new j;this.on("promise:resolved",function(c){v("resolve",b,a,c)});this.on("promise:failed",function(a){v("reject",b,c,a)});return b},resolve:function(a){i.async(function(){this.trigger("promise:resolved",
{detail:a});this.isResolved=a},this);this.reject=this.resolve=u},reject:function(a){i.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=u}};b.mixin(j.prototype);var d=function(){j.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};d.prototype=Object.create(j.prototype);d.prototype.addEventListener=d.prototype.on;d.prototype.removeEventListener=d.prototype.off;d.prototype.fireEvent=
function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};d.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],c=[];if(1<arguments.length)for(var b=1,f=arguments.length;b<f;b++)c.push(arguments[b]);this._queue.push({action:a,args:c})}};d.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var q=function(a,c){var b=document.createEvent("Event");
b.initEvent(a,!0,!0);for(var f in c)b[f]=c[f];return b},n=function(a){d.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new q("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,b){var f="message";a&&(a.action&&0===a.action.indexOf("___O_"))&&(f="controlmessage");
var d=this._localPort;this.fireEvent(new q(f,{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}}))}.bind(this)),l.addEventListener("load",function(){this.fireEvent(new q("connect",{source:this._localPort}))}.bind(this),!1))};n.prototype=Object.create(d.prototype);n.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};b=function(){n.call(this,!1)};b.prototype=Object.create(n.prototype);b.prototype.__defineGetter__("bgProcess",
function(){return chrome.extension.getBackgroundPage()});b.prototype.getScreenshot=function(a){var c=function(b){if(b.data&&b.data.action&&"___O_getScreenshot_RESPONSE"===b.data.action&&b.data.dataUrl){var d=document.createElement("canvas"),i=d.getContext("2d"),g=new Image;g.onload=function(){d.width=g.width;d.height=g.height;i.drawImage(g,0,0);var b=i.getImageData(0,0,d.width,d.height);a.call(this,b)};g.src=b.data.dataUrl;h.removeEventListener("controlmessage",c)}}.bind(this);h.addEventListener("controlmessage",
c);h.postMessage({action:"___O_getScreenshot_REQUEST"})};var h=m.extension=m.extension||new b;m.contexts=m.contexts||{};var k=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(k.prototype,"getItem",{value:function(a){return this[a]}});Object.defineProperty(k.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});Object.defineProperty(k.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&
(delete this[a],this.length--,b||h.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(k.prototype,"setItem",{value:function(a,b,d){this[a]||this.length++;this[a]=b;d||h.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(k.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||h.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})},
b=function(){this.properties={};this._preferences=new k;this._preferencesSet={};h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,
!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);h.postMessage({action:"___O_widget_setup_REQUEST"})};b.prototype=Object.create(d.prototype);b.prototype.__defineGetter__("name",function(){return this.properties.name||""});b.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});b.prototype.__defineGetter__("id",function(){return this.properties.id||""});b.prototype.__defineGetter__("description",
function(){return this.properties.description||""});b.prototype.__defineGetter__("author",function(){return this.properties.author||""});b.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});b.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});b.prototype.__defineGetter__("version",function(){return this.properties.version||""});b.prototype.__defineGetter__("preferences",
function(){return this._preferences});l.widget=l.widget||new b;l.opera=m}(window);
