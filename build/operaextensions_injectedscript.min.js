// operaextensions_injectedscript.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(p){function x(a,b,d){l?a[b].apply(a,d):k.push({target:a,methodName:b,args:d})}var i=p.opera||{REVISION:"1",version:function(){return this.REVISION},postError:function(a){console.log(a)}},l=!1,k=[],q={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},m={},c="undefined"!==typeof window?window:{},c=c.MutationObserver||c.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))c=function(a,b){process.nextTick(function(){a.call(b)})};
else if(c){var t=[],c=new c(function(){var a=t.slice();t=[];a.forEach(function(a){a[0].call(a[1])})}),y=document.createElement("div");c.observe(y,{attributes:!0});c=function(a,b){t.push([a,b]);y.setAttribute("drainQueue","drainQueue")}}else c=function(a,b){setTimeout(function(){a.call(b)},1)};m.async=c;var E=m.Event=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=b[d])},z=function(a,b){for(var d=0,f=a.length;d<f;d++)if(a[d][0]===b)return d;return-1},u=function(a){var b=a._promiseCallbacks;
b||(b=a._promiseCallbacks={});return b},c=m.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){for(var f=u(this),g,c,a=a.split(/\s+/),d=d||this;c=a.shift();)(g=f[c])||(g=f[c]=[]),-1===z(g,b)&&g.push([b,d])},off:function(a,b){for(var d=u(this),f,g,a=a.split(/\s+/);f=a.shift();)b?(f=d[f],g=z(f,b),-1!==g&&f.splice(g,1)):d[f]=[]},trigger:function(a,b){var d,f,g,c;if(d=u(this)[a])for(var e=0,h=d.length;e<h;e++)f=d[e],g=f[0],f=f[1],"object"!==
typeof b&&(b={detail:b}),c=new E(a,b),g.call(f,c)}},n=m.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},A=function(){},B=function(a,b,d,f){var c,v;if(d)try{c=d(f.detail)}catch(e){v=e}else c=f.detail;if(c instanceof n)c.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(d&&c)b.resolve(c);else if(v)b.reject(v);else b[a](c)};n.prototype={then:function(a,
b){var d=new n;this.on("promise:resolved",function(b){B("resolve",d,a,b)});this.on("promise:failed",function(a){B("reject",d,b,a)});return d},resolve:function(a){m.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=A},reject:function(a){m.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=A}};c.mixin(n.prototype);var e=function(){n.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",
function(){this.resolved=!0;this.dequeue()}.bind(this))};e.prototype=Object.create(n.prototype);e.prototype.addEventListener=e.prototype.on;e.prototype.removeEventListener=e.prototype.off;e.prototype.fireEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};e.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],b=[];if(1<arguments.length)for(var d=1,c=arguments.length;d<c;d++)b.push(arguments[d]);
this._queue.push({action:a,args:b})}};e.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var r=function(a,b){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var c in b)d[c]=b[c];return d},s=function(a){e.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new r("disconnect",
{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,d){var c=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.fireEvent(new r("controlmessage",{data:a,source:{postMessage:function(a){c.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})):x(this,"fireEvent",[new r("message",{data:a,source:{postMessage:function(a){c.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})])}.bind(this)),x(this,"fireEvent",[new r("connect",{source:this._localPort})]))};
s.prototype=Object.create(e.prototype);s.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};c=function(){s.call(this,!1)};c.prototype=Object.create(s.prototype);c.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});c.prototype.getScreenshot=function(a){var b=function(d){if(d.data&&d.data.action&&"___O_getScreenshot_RESPONSE"===d.data.action&&d.data.dataUrl){var c=document.createElement("canvas"),
g=c.getContext("2d"),e=new Image;e.onload=function(){c.width=e.width;c.height=e.height;g.drawImage(e,0,0);var b=g.getImageData(0,0,c.width,c.height);a.call(this,b)};e.src=d.data.dataUrl;h.removeEventListener("controlmessage",b)}}.bind(this);h.addEventListener("controlmessage",b);h.postMessage({action:"___O_getScreenshot_REQUEST"})};var h=i.extension=i.extension||new c;i.contexts=i.contexts||{};var o=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(o.prototype,
"getItem",{value:function(a){return this[a]}});Object.defineProperty(o.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});Object.defineProperty(o.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||h.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(o.prototype,"setItem",{value:function(a,b,d){this[a]||this.length++;this[a]=b;
d||h.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(o.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||h.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})},c=function(){this.properties={};this._preferences=new o;this._preferencesSet={};h.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=
a.data.attrs[b];q.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;q.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);h.postMessage({action:"___O_widget_setup_REQUEST"})};
c.prototype=Object.create(e.prototype);c.prototype.__defineGetter__("name",function(){return this.properties.name||""});c.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});c.prototype.__defineGetter__("id",function(){return this.properties.id||""});c.prototype.__defineGetter__("description",function(){return this.properties.description||""});c.prototype.__defineGetter__("author",function(){return this.properties.author||""});c.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});c.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});c.prototype.__defineGetter__("version",function(){return this.properties.version||""});c.prototype.__defineGetter__("preferences",function(){return this._preferences});p.widget=p.widget||new c;h.getFile=function(a){a||retrun};if(window.opera)l=!0,i.isReady=function(a){a.call(i);for(var a=0,b=k.length;a<
b;a++){var d=k[a];d.target[d.methodName].apply(d.target,d.args)}k=[]};else{var c=function(a,b){var d=a.addEventListener;a.addEventListener=function(c,g,e){c.toLowerCase()===b.toLowerCase()?void 0===g||(null===g||"[object Function]"!==Object.prototype.toString.call(g))||(l?g.call(window):j[b.toLowerCase()].push(g)):d.call(a,c,g,e)};a.__defineSetter__("on"+b.toLowerCase(),function(d){a.addEventListener(b.toLowerCase(),d,!1)})},C=function(a,b){var d=a.toLowerCase(),c=document.createEvent("Event");c.initEvent(d,
!0,!0);for(var g=0,e=j[d].length;g<e;g++)j[d][g].call(b,c);j[d]=[]},j={isready:[],domcontentloaded:[],load:[]},D=!1,w=!1;document.addEventListener("DOMContentLoaded",function b(){D=!0;document.removeEventListener("DOMContentLoaded",b,!0)},!0);window.addEventListener("load",function d(){w=!0;window.removeEventListener("load",d,!0)},!0);c(window,"load");c(document,"domcontentloaded");c(window,"domcontentloaded");var F=(new Date).getTime()+3E3;(function f(){if((new Date).getTime()>=F)console.error("opera.isReady check timed out");
else for(var c in q)if(!0!==q[c]){window.setTimeout(function(){f()},20);return}window.setTimeout(function(){if(!l){for(var c=0,e=j.isready.length;c<e;c++)j.isready[c].call(window);j.isready=[];(function G(){D||w?(C("domcontentloaded",document),function H(){if(w){C("load",window);for(var c=0,e=k.length;c<e;c++){var f=k[c];f.target[f.methodName].apply(f.target,f.args)}k=[]}else window.setTimeout(function(){H()},20)}()):window.setTimeout(function(){G()},20)})();l=!0}},0)})();i.isReady=function(c){l?
c.call(window):j.isready.push(c)}}p.opera=i}(window);
