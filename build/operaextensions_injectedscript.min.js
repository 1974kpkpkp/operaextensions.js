// operaextensions_injectedscript.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(s){function z(a,b,c){n?a[b].apply(a,c):l.push({target:a,methodName:b,args:c})}var h=function(){};h.prototype.REVISION="1";h.prototype.version=function(){return this.REVISION};h.prototype.postError=function(a){console.log(a)};var i=s.opera||new h,n=!1,l=[],t={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},o={},e="undefined"!==typeof window?window:{},e=e.MutationObserver||e.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))e=
function(a,b){process.nextTick(function(){a.call(b)})};else if(e){var w=[],e=new e(function(){var a=w.slice();w=[];a.forEach(function(a){a[0].call(a[1])})}),A=document.createElement("div");e.observe(A,{attributes:!0});e=function(a,b){w.push([a,b]);A.setAttribute("drainQueue","drainQueue")}}else e=function(a,b){setTimeout(function(){a.call(b)},1)};o.async=e;var G=o.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},B=function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c][0]===
b)return c;return-1},x=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},q=o.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,c){for(var d=x(this),f,p,a=a.split(/\s+/),c=c||this;p=a.shift();)(f=d[p])||(f=d[p]=[]),-1===B(f,b)&&f.push([b,c])},off:function(a,b){for(var c=x(this),d,f,a=a.split(/\s+/);d=a.shift();)b?(d=c[d],f=B(d,b),-1!==f&&d.splice(f,1)):c[d]=[]},trigger:function(a,b){var c,d,f,p;if(c=x(this)[a])for(var e=
0,g=c.length;e<g;e++)d=c[e],f=d[0],d=d[1],"object"!==typeof b&&(b={detail:b}),p=new G(a,b),f.call(d,p)}},r=o.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},C=function(){},D=function(a,b,c,d){var f,e;if(c)try{f=c(d.detail)}catch(g){e=g}else f=d.detail;if(f instanceof r)f.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(c&&f)b.resolve(f);else if(e)b.reject(e);
else b[a](f)};r.prototype={then:function(a,b){var c=new r;this.on("promise:resolved",function(b){D("resolve",c,a,b)});this.on("promise:failed",function(a){D("reject",c,b,a)});return c},resolve:function(a){o.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=C},reject:function(a){o.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=C}};q.mixin(r.prototype);var u=function(a,b){var c=
document.createEvent("Event");c.initEvent(a,!0,!0);for(var d in b)c[d]=b[d];return c},e=function(){q.mixin(this)};e.prototype.constructor=e;e.prototype.addEventListener=function(a,b){this.on(a,b)};e.prototype.removeEventListener=function(a,b){this.off(a,b)};e.prototype.fireEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};Object.create(r.prototype);for(var g in e.prototype);var v=function(a){q.mixin(this);this._isBackground=
a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new u("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.fireEvent(new u("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?
c.tab.id:null}})):z(this,"fireEvent",[new u("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:c&&c.tab?c.tab.id:null}})])}.bind(this)),z(this,"fireEvent",[new u("connect",{source:this._localPort})]))};v.prototype=Object.create(e.prototype);v.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};g=function(){v.call(this,!1)};g.prototype=Object.create(v.prototype);g.prototype.__defineGetter__("bgProcess",
function(){return chrome.extension.getBackgroundPage()});g.prototype.getScreenshot=function(a){var b=function(c){if(c.data&&c.data.action&&"___O_getScreenshot_RESPONSE"===c.data.action&&c.data.dataUrl){var d=document.createElement("canvas"),f=d.getContext("2d"),e=new Image;e.onload=function(){d.width=e.width;d.height=e.height;f.drawImage(e,0,0);var b=f.getImageData(0,0,d.width,d.height);a.call(this,b)};e.src=c.data.dataUrl;j.removeEventListener("controlmessage",b)}}.bind(this);j.addEventListener("controlmessage",
b);j.postMessage({action:"___O_getScreenshot_REQUEST"})};var j=i.extension=i.extension||new g;i.contexts=i.contexts||{};g.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var c=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(c)?c:"")+a,d=new XMLHttpRequest;d.onloadend=function(){d.readyState==d.DONE&&200==d.status&&(result=d.response,result.name=a.substring(a.lastIndexOf("/")+
1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};d.open("GET",a,!1);d.responseType="blob";d.send(null)}catch(f){}return b};var m=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(m.prototype,"getItem",{value:function(a){return this[a]}});Object.defineProperty(m.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==a)return a;b++}return null}});Object.defineProperty(m.prototype,
"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||j.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(m.prototype,"setItem",{value:function(a,b,c){this[a]||this.length++;this[a]=b;c||j.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(m.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&delete this[b];this.length=0;a||
j.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};m.prototype=Object.create(Storage.prototype);g=function(){q.mixin(this);this.properties={};this._preferences=new m;this._preferencesSet={};j.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];t.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;
t.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);j.postMessage({action:"___O_widget_setup_REQUEST"})};g.prototype=Object.create(e.prototype);g.prototype.__defineGetter__("name",function(){return this.properties.name||
""});g.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});g.prototype.__defineGetter__("id",function(){return this.properties.id||""});g.prototype.__defineGetter__("description",function(){return this.properties.description||""});g.prototype.__defineGetter__("author",function(){return this.properties.author||""});g.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});g.prototype.__defineGetter__("authorEmail",
function(){return this.properties.author?this.properties.author.email||"":""});g.prototype.__defineGetter__("version",function(){return this.properties.version||""});g.prototype.__defineGetter__("preferences",function(){return this._preferences});s.widget=s.widget||new g;q.mixin(h.prototype);h.prototype.defineMagicVariable=function(a,b,c){if(b&&"[object Function]"===Object.prototype.toString.call(b)&&c&&"[object Function]"===Object.prototype.toString.call(c)){var d=document.createElement("script");
d.setAttribute("type","text/javascript");b&&"[object Function]"===Object.prototype.toString.call(b)&&(d.textContent+="window.__defineGetter__('"+a+"', "+b.toString()+");\n");c&&"[object Function]"===Object.prototype.toString.call(c)&&(d.textContent+="window.__defineSetter__('"+a+"', "+c.toString()+");\n");document.getElementsByTagName("head")[0].appendChild(d)}};h.prototype.defineMagicFunction=function(a,b){if(b&&"[object Function]"===Object.prototype.toString.call(b)){var c=document.createElement("script");
c.setAttribute("type","text/javascript");c.textContent="var "+a+" = "+b.toString()+";";document.getElementsByTagName("head")[0].appendChild(c)}};h.prototype.addEventListener=function(){};h.prototype.removeEventListener=function(){};h.prototype.__defineGetter__("scriptStorage",function(){return widget.preferences});h.prototype.setOverrideHistoryNavigationMode=function(){};h.prototype.__defineGetter__("getOverrideHistoryNavigationMode",function(){return"automatic"});if(window.opera)n=!0,i.isReady=function(a){a.call(i);
for(var a=0,b=l.length;a<b;a++){var c=l[a];c.target[c.methodName].apply(c.target,c.args)}l=[]};else{var h=function(a,b){var c=a.addEventListener;a.addEventListener=function(d,f,e){d.toLowerCase()===b.toLowerCase()?void 0===f||(null===f||"[object Function]"!==Object.prototype.toString.call(f))||(n?f.call(window):k[b.toLowerCase()].push(f)):c.call(a,d,f,e)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},E=function(a,b){var c=a.toLowerCase(),d=document.createEvent("Event");
d.initEvent(c,!0,!0);for(var e=0,g=k[c].length;e<g;e++)k[c][e].call(b,d);k[c]=[]},k={isready:[],domcontentloaded:[],load:[]},F=!1,y=!1;document.addEventListener("DOMContentLoaded",function b(){F=!0;document.removeEventListener("DOMContentLoaded",b,!0)},!0);window.addEventListener("load",function c(){y=!0;window.removeEventListener("load",c,!0)},!0);h(window,"load");h(document,"domcontentloaded");h(window,"domcontentloaded");var H=(new Date).getTime()+3E3;(function d(){if((new Date).getTime()>=H)console.error("opera.isReady check timed out");
else for(var e in t)if(!0!==t[e]){window.setTimeout(function(){d()},20);return}window.setTimeout(function(){if(!n){for(var d=0,e=k.isready.length;d<e;d++)k.isready[d].call(window);k.isready=[];(function I(){F||y?(E("domcontentloaded",document),function J(){if(y){E("load",window);for(var d=0,e=l.length;d<e;d++){var f=l[d];f.target[f.methodName].apply(f.target,f.args)}l=[]}else window.setTimeout(function(){J()},20)}()):window.setTimeout(function(){I()},20)})();n=!0}},0)})();i.isReady=function(d){n?
d.call(window):k.isready.push(d)}}s.opera=i}(window);
