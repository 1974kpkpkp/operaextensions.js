// operaextensions_popup.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(j){var h=j.opera||{REVISION:"1",postError:function(a){console.log(a)}},f=h._RSVP={},b="undefined"!==typeof window?window:{},b=b.MutationObserver||b.WebKitMutationObserver;if("undefined"!==typeof process)b=function(a,c){process.nextTick(function(){a.call(c)})};else if(b){var n=[],b=new b(function(){var a=n.slice();n=[];a.forEach(function(a){a[0].call(a[1])})}),q=document.createElement("div");b.observe(q,{attributes:!0});b=function(a,c){n.push([a,c]);q.setAttribute("drainQueue",
"drainQueue")}}else b=function(a,c){setTimeout(function(){a.call(c)},1)};f.async=b;var s=f.Event=function(a,c){this.type=a;for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d])},r=function(a,c){for(var d=0,b=a.length;d<b;d++)if(a[d][0]===c)return d;return-1},o=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},b=f.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,d){var b=o(this),g,d=d||this;(g=b[a])||(g=b[a]=[]);-1===
r(g,c)&&g.push([c,d])},off:function(a,c){var d=o(this);if(c){var d=d[a],b=r(d,c);-1!==b&&d.splice(b,1)}else d[a]=[]},trigger:function(a,c){var d,b,g,e;if(d=o(this)[a])for(var f=0,h=d.length;f<h;f++)b=d[f],g=b[0],b=b[1],"object"!==typeof c&&(c={detail:c}),e=new s(a,c),g.call(b,e)}},l=f.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)};f.invokeCallback=function(a,
c,d,b){var g,e;if(d)try{g=d(b.detail)}catch(f){e=f}else g=b.detail;if(g instanceof l)g.then(function(a){c.resolve(a)},function(a){c.reject(a)});else if(d&&g)c.resolve(g);else if(e)c.reject(e);else c[a](g)};l.prototype={then:function(a,c){var b=new l;this.on("promise:resolved",function(c){f.invokeCallback("resolve",b,a,c)});this.on("promise:failed",function(a){f.invokeCallback("reject",b,c,a)});return b},resolve:function(a){f.async(function(){this.trigger("promise:resolved",{detail:a})},this);this.resolve=
function(){};this.reject=function(){}},reject:function(a){f.async(function(){this.trigger("promise:failed",{detail:a})},this);this.resolve=function(){};this.reject=function(){}}};b.mixin(l.prototype);var e=function(){h._RSVP.Promise.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};e.prototype=Object.create(h._RSVP.Promise.prototype);e.prototype.addEventListener=e.prototype.on;e.prototype.removeEventListener=e.prototype.off;
e.prototype.fireEvent=function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};e.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],c=[];if(1<arguments.length)for(var b=1,e=arguments.length;b<e;b++)c.push(arguments[b]);this._queue.push({action:a,args:c})}};e.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var p=function(a,
c){var b=document.createEvent("Event");b.initEvent(a,!0,!0);for(var e in c)b[e]=c[e];return b},m=function(a){e.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.fireEvent(new p("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,b){var e="message";a&&(a.action&&
0===a.action.indexOf("___O_"))&&(e="controlmessage");this.fireEvent(new p(e,{data:a,source:{postMessage:function(a){this._localPort.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}}))}.bind(this)),j.addEventListener("load",function(){this.fireEvent(new p("connect",{source:this._localPort}))}.bind(this),!1))};m.prototype=Object.create(e.prototype);m.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};b=function(){m.call(this,!1)};
b.prototype=Object.create(m.prototype);b.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var k=h.extension=h.extension||new b;h.contexts=h.contexts||{};var i=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(i.prototype,"getItem",{value:function(a){return this[a]}});Object.defineProperty(i.prototype,"key",{value:function(a){var c=0;for(a in this)if(this.hasOwnProperty(a)){if(c==a)return a;c++}return null}});
Object.defineProperty(i.prototype,"removeItem",{value:function(a,c){this.hasOwnProperty(a)&&(delete this[a],this.length--,c||k.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(i.prototype,"setItem",{value:function(a,c,b){this[a]||this.length++;this[a]=c;b||k.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:c}})}});Object.defineProperty(i.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&
delete this[b];this.length=0;a||k.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})},b=function(){this.properties={};this._preferences=new i;this._preferencesSet={};k.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=a.data._prefs[b],this._preferences.length++;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,
a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);k.postMessage({action:"___O_widget_setup_REQUEST"})};b.prototype=Object.create(e.prototype);b.prototype.__defineGetter__("name",function(){return this.properties.name||""});b.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||
"":""});b.prototype.__defineGetter__("id",function(){return this.properties.id||""});b.prototype.__defineGetter__("description",function(){return this.properties.description||""});b.prototype.__defineGetter__("author",function(){return this.properties.author||""});b.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});b.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":
""});b.prototype.__defineGetter__("version",function(){return this.properties.version||""});b.prototype.__defineGetter__("preferences",function(){return this._preferences});j.widget=j.widget||new b;j.opera=h}(window);
