// operaextensions_popup.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(c){function y(a,b,e){l?a[b].apply(a,e):i.push({target:a,methodName:b,args:e})}var d=function(){};d.prototype.REVISION="1";d.prototype.version=function(){return this.REVISION};d.prototype.buildNumber=function(){return this.REVISION};d.prototype.postError=function(a){console.log(a)};var h=c.opera||new d,F=chrome.app.getDetails(),l=!1,i=[],q={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},m={},d="undefined"!==typeof window?window:{},d=d.MutationObserver||d.WebKitMutationObserver;
if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))d=function(a,b){process.nextTick(function(){a.call(b)})};else if(d){var w=[],d=new d(function(){var a=w.slice();w=[];a.forEach(function(a){a[0].call(a[1])})}),z=document.createElement("div");d.observe(z,{attributes:!0});d=function(a,b){w.push([a,b]);z.setAttribute("drainQueue","drainQueue")}}else d=function(a,b){setTimeout(function(){a.call(b)},1)};m.async=d;var G=m.Event=function(a,b){this.type=a;for(var e in b)b.hasOwnProperty(e)&&
(this[e]=b[e])},A=function(a,b){for(var e=0,g=a.length;e<g;e++)if(a[e][0]===b)return e;return-1},x=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},s=m.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,e){for(var g=x(this),r,c,a=a.split(/\s+/),e=e||this;c=a.shift();)(r=g[c])||(r=g[c]=[]),-1===A(r,b)&&r.push([b,e])},off:function(a,b){for(var e=x(this),g,c,a=a.split(/\s+/);g=a.shift();)b?(g=e[g],c=A(g,b),-1!==c&&
g.splice(c,1)):e[g]=[]},trigger:function(a,b){var e,g,c,d;if(e=x(this)[a])for(var f=0,h=e.length;f<h;f++)g=e[f],c=g[0],g=g[1],"object"!==typeof b&&(b={detail:b}),d=new G(a,b),c.call(g,d)}},t=m.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},B=function(){},C=function(a,b,e,g){var c,d;if(e)try{c=e(g.detail)}catch(f){d=f}else c=g.detail;if(c instanceof t)c.then(function(a){b.resolve(a)},
function(a){b.reject(a)});else if(e&&c)b.resolve(c);else if(d)b.reject(d);else b[a](c)};t.prototype={then:function(a,b){var e=new t;this.on("promise:resolved",function(b){C("resolve",e,a,b)});this.on("promise:failed",function(a){C("reject",e,b,a)});return e},resolve:function(a){m.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=B},reject:function(a){m.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=B}};s.mixin(t.prototype);var n=function(a,b){var e=document.createEvent("Event");e.initEvent(a,!0,!0);for(var c in b)e[c]=b[c];return e},d=function(){s.mixin(this)};d.prototype.constructor=d;d.prototype.addEventListener=function(a,b){this.on(a,b)};d.prototype.removeEventListener=function(a,b){this.off(a,b)};d.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};var u=function(a){s.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new n("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,e,c){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new n("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:
null}})):y(this,"dispatchEvent",[new n("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:null}})]);c&&c({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),y(this,"dispatchEvent",[new n("connect",{source:this._localPort})]))};u.prototype=Object.create(d.prototype);u.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var f=function(){u.call(this,
!1)};f.prototype=Object.create(u.prototype);f.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var o=h.extension=h.extension||new f;h.contexts=h.contexts||{};f.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var e=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(e)?e:"")+a,c=new XMLHttpRequest;c.onloadend=function(){c.readyState==
c.DONE&&200==c.status&&(result=c.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};c.open("GET",a,!1);c.responseType="blob";c.send(null)}catch(d){}return b};var j=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(j.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(j.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==
a)return a;b++}return null}});Object.defineProperty(j.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||o.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(j.prototype,"setItem",{value:function(a,b,c){this[a]||this.length++;this[a]=b;c||o.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(j.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&
delete this[b];this.length=0;a||o.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};j.prototype=Object.create(Storage.prototype);f=function(){s.mixin(this);this.properties=F||{};this._preferences=new j;this._preferencesSet={};o.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];q.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=
a.data._prefs[b],this._preferences.length++;q.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);o.postMessage({action:"___O_widget_setup_REQUEST"});c.addEventListener("beforeunload",function(){},!1)};f.prototype=
Object.create(d.prototype);f.prototype.__defineGetter__("name",function(){return this.properties.name||""});f.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});f.prototype.__defineGetter__("id",function(){return this.properties.id||""});f.prototype.__defineGetter__("description",function(){return this.properties.description||""});f.prototype.__defineGetter__("author",function(){return this.properties.author||""});f.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});f.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});f.prototype.__defineGetter__("version",function(){return this.properties.version||""});f.prototype.__defineGetter__("preferences",function(){return this._preferences});c.widget=c.widget||new f;if(c.opera)l=!0,h.isReady=function(a){a.call(h);for(var a=0,b=i.length;a<b;a++){var c=i[a];c.target[c.methodName].apply(c.target,
c.args)}i=[]};else{var d=function(a,b){var e=a.addEventListener;a.addEventListener=function(d,f,h){d+="";d.toLowerCase()===b.toLowerCase()?void 0===f||(null===f||"[object Function]"!==Object.prototype.toString.call(f))||(l?f.call(c):k[b.toLowerCase()].push(f)):e.call(a,d,f,h)};a.__defineSetter__("on"+b.toLowerCase(),function(c){a.addEventListener(b.toLowerCase(),c,!1)})},p=function(a,b,c){for(var a=a.toLowerCase(),c=new n(a,c||{}),d=0,f=k[a].length;d<f;d++)k[a][d].call(b,c)},k={isready:[],readystatechange:[],
domcontentloaded:[],load:[]},D=!1,v=!1;c.document.addEventListener("DOMContentLoaded",function b(){D=!0;c.document.removeEventListener("DOMContentLoaded",b,!0)},!0);c.addEventListener("load",function e(){v=!0;c.removeEventListener("load",e,!0)},!0);c.document.addEventListener("readystatechange",function(e){e.stopImmediatePropagation();e.stopPropagation();"interactive"!==c.document.readyState&&"complete"!==c.document.readyState?p("readystatechange",c.document):c.document.readyState="loading"},!0);
var E="uninitialized";c.document.__defineSetter__("readyState",function(c){E=c});c.document.__defineGetter__("readyState",function(){return E});d(c,"load");d(c.document,"domcontentloaded");d(c,"domcontentloaded");d(c.document,"readystatechange");var H=(new Date).getTime()+3E3;(function g(){if((new Date).getTime()>=H)console.warn("opera.isReady check timed out"),v=!0;else for(var d in q)if(!0!==q[d]){c.setTimeout(function(){g()},20);return}c.setTimeout(function(){if(!l){for(var d=0,f=k.isready.length;d<
f;d++)k.isready[d].call(c);k.isready=[];var g=(new Date).getTime()+3E3;(function I(){var d=(new Date).getTime();if(D||v||d>=g){c.document.readyState="interactive";p("readystatechange",c.document);p("domcontentloaded",c.document,{bubbles:!0});d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+3E3;(function J(){var d=(new Date).getTime();if(v||d>=f){c.document.readyState="complete";p("readystatechange",c.document);p("load",window);d>=f&&console.warn("window.load event fired on check timeout");
for(var d=0,g=i.length;d<g;d++){var h=i[d];h.target[h.methodName].apply(h.target,h.args)}i=[]}else c.setTimeout(function(){J()},50)})()}else c.setTimeout(function(){I()},50)})();l=!0}},0)})();h.isReady=function(d){l?d.call(c):k.isready.push(d)}}c.opera=h}(window);
