// operaextensions_popup.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(e){function x(a,c,d){m?a[c].apply(a,d):l.push({target:a,methodName:c,args:d})}var g="app extension windows tabs browserAction contextMenus i18n webRequest".split(" ");e.chrome||(e.chrome={});for(var i=0,f=g.length;i<f;i++)e.chrome[g[i]]=e.chrome[g[i]]||e.navigator[g[i]]||{};g=function(){};g.prototype.REVISION="1";g.prototype.version=function(){return this.REVISION};g.prototype.buildNumber=function(){return this.REVISION};g.prototype.postError=function(a){console.log(a)};var j=
e.opera||new g,g=chrome.app.getDetails();navigator.browserLanguage=navigator.language;var m=!1,l=[],y={},n={},f="undefined"!==typeof window?window:{},f=f.MutationObserver||f.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))f=function(a,c){process.nextTick(function(){a.call(c)})};else if(f){var u=[],f=new f(function(){var a=u.slice();u=[];a.forEach(function(a){a[0].call(a[1])})}),z=document.createElement("div");f.observe(z,{attributes:!0});f=function(a,
c){u.push([a,c]);z.setAttribute("drainQueue","drainQueue")}}else f=function(a,c){setTimeout(function(){a.call(c)},1)};n.async=f;var F=n.Event=function(a,c){this.type=a;for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d])},A=function(a,c){for(var d=0,b=a.length;d<b;d++)if(a[d][0]===c)return d;return-1},v=function(a){var c=a._promiseCallbacks;if(!c)c=a._promiseCallbacks={};return c},w=n.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,d){for(var b=
v(this),h,e,a=a.split(/\s+/),d=d||this;e=a.shift();){(h=b[e])||(h=b[e]=[]);A(h,c)===-1&&h.push([c,d])}},off:function(a,c){for(var d=v(this),b,h,a=a.split(/\s+/);b=a.shift();)if(c){b=d[b];h=A(b,c);h!==-1&&b.splice(h,1)}else d[b]=[]},trigger:function(a,c){var d,b,h,e;if(d=v(this)[a])for(var f=0,g=d.length;f<g;f++){b=d[f];h=b[0];b=b[1];typeof c!=="object"&&(c={detail:c});e=new F(a,c);h.call(b,e)}}},o=n.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},
this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},B=function(){},C=function(a,c,d,b){var h,e;if(d)try{h=d(b.detail)}catch(f){e=f}else h=b.detail;if(h instanceof o)h.then(function(a){c.resolve(a)},function(a){c.reject(a)});else if(d&&h)c.resolve(h);else if(e)c.reject(e);else c[a](h)};o.prototype={then:function(a,c){var d=new o;this.on("promise:resolved",function(c){C("resolve",d,a,c)});this.on("promise:failed",function(a){C("reject",d,c,a)});return d},resolve:function(a){n.async(function(){this.trigger("promise:resolved",
{detail:a});this.isResolved=a},this);this.reject=this.resolve=B},reject:function(a){n.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=B}};w.mixin(o.prototype);var p=function(a,c){var d=document.createEvent("Event");d.initEvent(a,true,true);for(var b in c)d[b]=c[b];return d},f=function(){w.mixin(this)};f.prototype.constructor=f;f.prototype.addEventListener=function(a,c){this.on(a,c)};f.prototype.removeEventListener=function(a,c){this.off(a,
c)};f.prototype.dispatchEvent=function(a){var c=a.type;if(typeof this["on"+c.toLowerCase()]==="function")this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};Object.create(o.prototype);for(i in f.prototype);var r=function(a){w.mixin(this);this._isBackground=a||false;this._localPort=null;if(!this._isBackground){this._localPort=chrome.extension.connect({name:""+Math.floor(Math.random()*1E16)});this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new p("disconnect",{source:this._localPort}));
this._localPort=null}.bind(this));a=function(a,d,b){var h=this._localPort;a&&a.action&&a.action.indexOf("___O_")===0?this.dispatchEvent(new p("controlmessage",{data:a,source:{postMessage:function(a){h.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})):x(this,"dispatchEvent",[new p("message",{data:a,source:{postMessage:function(a){h.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})]);b&&b({})}.bind(this);this._localPort.onMessage.addListener(a);chrome.extension.onMessage.addListener(a);x(this,"dispatchEvent",
[new p("connect",{source:this._localPort,origin:""})])}};r.prototype=Object.create(f.prototype);r.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};i=function(){r.call(this,false)};i.prototype=Object.create(r.prototype);i.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var f=j.extension=j.extension||new i,s=j.contexts=j.contexts||{};i.prototype.getFile=function(a){var c=null;
if(typeof a!="string")return c;try{var d=chrome.extension.getURL("");a.indexOf("widget:")==0&&(a=a.replace("widget:","chrome-extension:"));a.indexOf("/")==0&&(a=a.substring(1));var a=(a.indexOf(d)==-1?d:"")+a,b=new XMLHttpRequest;b.onloadend=function(){if(b.readyState==b.DONE&&b.status==200){result=b.response;result.name=a.substring(a.lastIndexOf("/")+1);result.lastModifiedDate=null;result.toString=function(){return"[object File]"};c=result}};b.open("GET",a,false);b.responseType="blob";b.send(null)}catch(h){}return c};
e.widget=e.widget||f.bgProcess.widget;g&&(g.permissions&&-1!=g.permissions.indexOf("tabs"))&&(f.windows=f.windows||f.bgProcess.opera.extension.windows);g&&(g.permissions&&-1!=g.permissions.indexOf("tabs"))&&(f.tabs=f.tabs||f.bgProcess.opera.extension.tabs);g&&(g.permissions&&-1!=g.permissions.indexOf("tabs"))&&(f.tabGroups=f.tabGroups||f.bgProcess.opera.extension.tabGroups);g&&(void 0!==g.browser_action&&null!==g.browser_action)&&(s.toolbar=s.toolbar||f.bgProcess.opera.contexts.toolbar);g&&(g.permissions&&
-1!=g.permissions.indexOf("contextMenus"))&&(e.MenuItem=f.bgProcess.MenuItem,e.MenuContext=f.bgProcess.MenuContext,s.menu=s.menu||f.bgProcess.opera.contexts.menu);if(e.opera)m=!0,j.isReady=function(a){a.call(j);for(var a=0,c=l.length;a<c;a++){var d=l[a];d.target[d.methodName].apply(d.target,d.args)}l=[]};else{var i=function(a,c){var d=a.addEventListener;a.addEventListener=function(b,h,f){b=b+"";b.toLowerCase()===c.toLowerCase()?h===void 0||(h===null||Object.prototype.toString.call(h)!=="[object Function]")||
(m?h.call(e):k[c.toLowerCase()].push(h)):d.call(a,b,h,f)};a.__defineSetter__("on"+c.toLowerCase(),function(d){a.addEventListener(c.toLowerCase(),d,false)})},q=function(a,c,d){for(var a=a.toLowerCase(),d=new p(a,d||{}),b=0,h=k[a].length;b<h;b++)k[a][b].call(c,d)},k={isready:[],readystatechange:[],domcontentloaded:[],load:[]},D=!1,t=!1;e.document.addEventListener("DOMContentLoaded",function c(){D=true;e.document.removeEventListener("DOMContentLoaded",c,true)},!0);e.addEventListener("load",function d(){t=
true;e.removeEventListener("load",d,true)},!0);e.document.addEventListener("readystatechange",function(d){d.stopImmediatePropagation();d.stopPropagation();e.document.readyState!=="interactive"&&e.document.readyState!=="complete"?q("readystatechange",e.document):e.document.readyState="loading"},!0);var E="uninitialized";e.document.__defineSetter__("readyState",function(d){E=d});e.document.__defineGetter__("readyState",function(){return E});i(e,"load");i(e.document,"domcontentloaded");i(e,"domcontentloaded");
i(e.document,"readystatechange");var G=(new Date).getTime()+3E3;(function b(){if((new Date).getTime()>=G){console.warn("opera.isReady check timed out");t=true}else for(var h in y)if(y[h]!==true){e.setTimeout(function(){b()},20);return}e.setTimeout(function(){if(!m){for(var b=0,h=k.isready.length;b<h;b++)k.isready[b].call(e);k.isready=[];var f=(new Date).getTime()+3E3;(function H(){var b=(new Date).getTime();if(D||t||b>=f){e.document.readyState="interactive";q("readystatechange",e.document);q("domcontentloaded",
e.document,{bubbles:true});b>=f&&console.warn("document.domcontentloaded event fired on check timeout");var h=(new Date).getTime()+3E3;(function I(){var b=(new Date).getTime();if(t||b>=h){e.document.readyState="complete";q("readystatechange",e.document);q("load",window);b>=h&&console.warn("window.load event fired on check timeout");for(var b=0,f=l.length;b<f;b++){var g=l[b];g.target[g.methodName].apply(g.target,g.args)}l=[]}else e.setTimeout(function(){I()},50)})()}else e.setTimeout(function(){H()},
50)})();m=true}},0)})();j.isReady=function(b){m?b.call(e):k.isready.push(b)}}j.isReady(function(){function b(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(window.location.search);return b==null?"":window.decodeURIComponent(b[1].replace(/\+/g," "))}window.addEventListener("DOMContentLoaded",function(){var e=b("w"),f=b("h");document.body.style.minWidth=e!==""?e.replace(/\D/g,"")+"px":"300px";document.body.style.minHeight=f!==""?f.replace(/\D/g,"")+"px":"300px"},
false)});j.isReady(function(){document.addEventListener("DOMContentLoaded",function(){for(var b=["load","beforeunload","unload","click","dblclick","mouseover","mousemove","mousedown","mouseup","mouseout","keydown","keypress","keyup","blur","focus"],e=0,f=b.length;e<f;e++)for(var g=document.querySelectorAll("[on"+b[e]+"]"),i=0,j=g.length;i<j;i++){var l=new Function("e",g[i].getAttribute("on"+b[e])),k=g[i];b[e].indexOf("load")>-1&&g[i]===document.body&&(k=window);g[i].removeAttribute("on"+b[e]);k.addEventListener(b[e],
l,true)}},false)});e.opera=j}(window);
