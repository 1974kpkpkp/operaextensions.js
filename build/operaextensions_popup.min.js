// operaextensions_popup.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(b){function q(a,c,e){o?a[c].apply(a,e):l.push({target:a,methodName:c,args:e})}var d=function(){};d.prototype.REVISION="1";d.prototype.version=function(){return this.REVISION};d.prototype.buildNumber=function(){return this.REVISION};d.prototype.postError=function(a){console.log(a)};var k=b.opera||new d,h=chrome.app.getDetails(),o=!1,l=[],u={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1,TOOLBAR_CONTEXT_LOADED:!1},p={},d="undefined"!==typeof window?window:{},d=d.MutationObserver||
d.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))d=function(a,c){process.nextTick(function(){a.call(c)})};else if(d){var y=[],d=new d(function(){var a=y.slice();y=[];a.forEach(function(a){a[0].call(a[1])})}),A=document.createElement("div");d.observe(A,{attributes:!0});d=function(a,c){y.push([a,c]);A.setAttribute("drainQueue","drainQueue")}}else d=function(a,c){setTimeout(function(){a.call(c)},1)};p.async=d;var G=p.Event=function(a,c){this.type=
a;for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])},B=function(a,c){for(var e=0,f=a.length;e<f;e++)if(a[e][0]===c)return e;return-1},z=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},v=p.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,e){for(var f=z(this),b,d,a=a.split(/\s+/),e=e||this;d=a.shift();)(b=f[d])||(b=f[d]=[]),-1===B(b,c)&&b.push([c,e])},off:function(a,c){for(var e=z(this),f,b,a=a.split(/\s+/);f=
a.shift();)c?(f=e[f],b=B(f,c),-1!==b&&f.splice(b,1)):e[f]=[]},trigger:function(a,c){var e,f,b,d;if(e=z(this)[a])for(var g=0,h=e.length;g<h;g++)f=e[g],b=f[0],f=f[1],"object"!==typeof c&&(c={detail:c}),d=new G(a,c),b.call(f,d)}},r=p.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},C=function(){},D=function(a,c,e,f){var b,d;if(e)try{b=e(f.detail)}catch(g){d=g}else b=
f.detail;if(b instanceof r)b.then(function(a){c.resolve(a)},function(a){c.reject(a)});else if(e&&b)c.resolve(b);else if(d)c.reject(d);else c[a](b)};r.prototype={then:function(a,c){var e=new r;this.on("promise:resolved",function(c){D("resolve",e,a,c)});this.on("promise:failed",function(a){D("reject",e,c,a)});return e},resolve:function(a){p.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=C},reject:function(a){p.async(function(){this.trigger("promise:failed",
{detail:a});this.isRejected=a},this);this.reject=this.resolve=C}};v.mixin(r.prototype);var s=function(a,c){var e=document.createEvent("Event");e.initEvent(a,!0,!0);for(var b in c)e[b]=c[b];return e},d=function(){v.mixin(this)};d.prototype.constructor=d;d.prototype.addEventListener=function(a,c){this.on(a,c)};d.prototype.removeEventListener=function(a,c){this.off(a,c)};d.prototype.dispatchEvent=function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);
this.trigger(c,a)};Object.create(r.prototype);for(var j in d.prototype);var w=function(a){v.mixin(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new s("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,e,b){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new s("controlmessage",
{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:null}})):q(this,"dispatchEvent",[new s("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:null}})]);b&&b({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),q(this,"dispatchEvent",[new s("connect",{source:this._localPort,origin:""})]))};w.prototype=Object.create(d.prototype);w.prototype.postMessage=function(a){this._isBackground?
this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var i=function(){w.call(this,!1)};i.prototype=Object.create(w.prototype);i.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var g=k.extension=k.extension||new i;j=k.contexts=k.contexts||{};i.prototype.getFile=function(a){var c=null;if("string"!=typeof a)return c;try{var b=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&
(a=a.substring(1));var a=(-1==a.indexOf(b)?b:"")+a,f=new XMLHttpRequest;f.onloadend=function(){f.readyState==f.DONE&&200==f.status&&(result=f.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},c=result)};f.open("GET",a,!1);f.responseType="blob";f.send(null)}catch(d){}return c};var m=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(m.prototype,"getItem",{value:function(a){a=
this[a];return void 0===a?null:a}});Object.defineProperty(m.prototype,"key",{value:function(a){var c=0;for(a in this)if(this.hasOwnProperty(a)){if(c==a)return a;c++}return null}});Object.defineProperty(m.prototype,"removeItem",{value:function(a,c){this.hasOwnProperty(a)&&(delete this[a],this.length--,c||g.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(m.prototype,"setItem",{value:function(a,c,b){this[a]||this.length++;this[a]=c;b||g.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",
data:{key:a,val:c}})}});Object.defineProperty(m.prototype,"clear",{value:function(a){for(var c in this)this.hasOwnProperty(c)&&delete this[c];this.length=0;a||g.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};m.prototype=Object.create(Storage.prototype);i=function(){v.mixin(this);this.properties=h||{};this._preferences=new m;this._preferencesSet={};g.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var c in a.data.attrs)this.properties[c]=
a.data.attrs[c];u.WIDGET_API_LOADED=!0;if(a.data._prefs)for(c in a.data._prefs)this._preferences[c]=a.data._prefs[c],this._preferences.length++;u.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);g.postMessage({action:"___O_widget_setup_REQUEST"});
b.addEventListener("beforeunload",function(){},!1)};i.prototype=Object.create(d.prototype);i.prototype.__defineGetter__("name",function(){return this.properties.name||""});i.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});i.prototype.__defineGetter__("id",function(){return this.properties.id||""});i.prototype.__defineGetter__("description",function(){return this.properties.description||""});i.prototype.__defineGetter__("author",function(){return this.properties.author||
""});i.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});i.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});i.prototype.__defineGetter__("version",function(){return this.properties.version||""});i.prototype.__defineGetter__("preferences",function(){return this._preferences});b.widget=b.widget||new i;h&&(h.permissions&&-1!=h.permissions.indexOf("tabs"))&&(g.windows=
g.windows||g.bgProcess.opera.extension.windows);h&&(h.permissions&&-1!=h.permissions.indexOf("tabs"))&&(g.tabs=g.tabs||g.bgProcess.opera.extension.tabs);h&&(h.permissions&&-1!=h.permissions.indexOf("tabs"))&&(g.tabGroups=g.tabGroups||g.bgProcess.opera.extension.tabGroups);h&&(void 0!==h.browser_action&&null!==h.browser_action)&&(j.toolbar=j.toolbar||g.bgProcess.opera.contexts.toolbar);h&&(h.permissions&&-1!=h.permissions.indexOf("contextMenus"))&&(b.MenuItem=g.bgProcess.MenuItem,b.MenuContext=g.bgProcess.MenuContext,
j.menu=j.menu||g.bgProcess.opera.contexts.menu);if(b.opera)o=!0,k.isReady=function(a){a.call(k);for(var a=0,c=l.length;a<c;a++){var b=l[a];b.target[b.methodName].apply(b.target,b.args)}l=[]};else{j=function(a,c){var e=a.addEventListener;a.addEventListener=function(f,d,g){f=f+"";f.toLowerCase()===c.toLowerCase()?d===void 0||(d===null||Object.prototype.toString.call(d)!=="[object Function]")||(o?d.call(b):n[c.toLowerCase()].push(d)):e.call(a,f,d,g)};a.__defineSetter__("on"+c.toLowerCase(),function(b){a.addEventListener(c.toLowerCase(),
b,false)})};var t=function(a,c,b){for(var a=a.toLowerCase(),b=new s(a,b||{}),d=0,g=n[a].length;d<g;d++)n[a][d].call(c,b)},n={isready:[],readystatechange:[],domcontentloaded:[],load:[]},E=!1,x=!1;b.document.addEventListener("DOMContentLoaded",function c(){E=true;b.document.removeEventListener("DOMContentLoaded",c,true)},!0);b.addEventListener("load",function e(){x=true;b.removeEventListener("load",e,true)},!0);b.document.addEventListener("readystatechange",function(d){d.stopImmediatePropagation();
d.stopPropagation();b.document.readyState!=="interactive"&&b.document.readyState!=="complete"?t("readystatechange",b.document):b.document.readyState="loading"},!0);var F="uninitialized";b.document.__defineSetter__("readyState",function(b){F=b});b.document.__defineGetter__("readyState",function(){return F});j(b,"load");j(b.document,"domcontentloaded");j(b,"domcontentloaded");j(b.document,"readystatechange");var H=(new Date).getTime()+3E3;(function f(){if((new Date).getTime()>=H){console.warn("opera.isReady check timed out");
x=true}else for(var d in u)if(u[d]!==true){b.setTimeout(function(){f()},20);return}b.setTimeout(function(){if(!o){for(var d=0,f=n.isready.length;d<f;d++)n.isready[d].call(b);n.isready=[];var g=(new Date).getTime()+3E3;(function I(){var d=(new Date).getTime();if(E||x||d>=g){b.document.readyState="interactive";t("readystatechange",b.document);t("domcontentloaded",b.document,{bubbles:true});d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+3E3;(function J(){var d=
(new Date).getTime();if(x||d>=f){b.document.readyState="complete";t("readystatechange",b.document);t("load",window);d>=f&&console.warn("window.load event fired on check timeout");for(var d=0,g=l.length;d<g;d++){var h=l[d];h.target[h.methodName].apply(h.target,h.args)}l=[]}else b.setTimeout(function(){J()},50)})()}else b.setTimeout(function(){I()},50)})();o=true}},0)})();k.isReady=function(d){o?d.call(b):n.isready.push(d)}}b.opera=k}(window);
opera.isReady(function(){function b(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(window.location.search);return null==b?"":window.decodeURIComponent(b[1].replace(/\+/g," "))}var q=b("w"),d=b("h");document.body.style.minWidth=""!==q?q.replace(/\D/g,"")+"px":"300px";document.body.style.minHeight=""!==d?d.replace(/\D/g,"")+"px":"300px"});
