// operaextensions_popup.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(e,i){function w(a,b,d){n?a[b].apply(a,d):l.push({target:a,methodName:b,args:d})}var c=function(){};c.prototype.REVISION="1";c.prototype.version=function(){return this.REVISION};c.prototype.buildNumber=function(){return this.REVISION};c.prototype.postError=function(a){console.log(a)};var j=e.opera||new c,n=!1,l=[],r={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},o={},c="undefined"!==typeof window?window:{},c=c.MutationObserver||c.WebKitMutationObserver;if("undefined"!==
typeof process&&"[object process]"==={}.toString.call(process))c=function(a,b){process.nextTick(function(){a.call(b)})};else if(c){var x=[],c=new c(function(){var a=x.slice();x=[];a.forEach(function(a){a[0].call(a[1])})}),z=document.createElement("div");c.observe(z,{attributes:!0});c=function(a,b){x.push([a,b]);z.setAttribute("drainQueue","drainQueue")}}else c=function(a,b){setTimeout(function(){a.call(b)},1)};o.async=c;var F=o.Event=function(a,b){this.type=a;for(var d in b)b.hasOwnProperty(d)&&(this[d]=
b[d])},A=function(a,b){for(var d=0,f=a.length;d<f;d++)if(a[d][0]===b)return d;return-1},y=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},s=o.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,b,d){for(var f=y(this),h,c,a=a.split(/\s+/),d=d||this;c=a.shift();)(h=f[c])||(h=f[c]=[]),-1===A(h,b)&&h.push([b,d])},off:function(a,b){for(var d=y(this),f,h,a=a.split(/\s+/);f=a.shift();)b?(f=d[f],h=A(f,b),-1!==h&&f.splice(h,
1)):d[f]=[]},trigger:function(a,b){var d,f,h,c;if(d=y(this)[a])for(var e=0,g=d.length;e<g;e++)f=d[e],h=f[0],f=f[1],"object"!==typeof b&&(b={detail:b}),c=new F(a,b),h.call(f,c)}},t=o.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},B=function(){},C=function(a,b,d,f){var c,e;if(d)try{c=d(f.detail)}catch(g){e=g}else c=f.detail;if(c instanceof t)c.then(function(a){b.resolve(a)},
function(a){b.reject(a)});else if(d&&c)b.resolve(c);else if(e)b.reject(e);else b[a](c)};t.prototype={then:function(a,b){var d=new t;this.on("promise:resolved",function(b){C("resolve",d,a,b)});this.on("promise:failed",function(a){C("reject",d,b,a)});return d},resolve:function(a){o.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=B},reject:function(a){o.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=B}};s.mixin(t.prototype);var p=function(a,b){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var f in b)d[f]=b[f];return d},c=function(){s.mixin(this)};c.prototype.constructor=c;c.prototype.addEventListener=function(a,b){this.on(a,b)};c.prototype.removeEventListener=function(a,b){this.off(a,b)};c.prototype.dispatchEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};var u=function(a){s.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new p("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,d,f){var c=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new p("controlmessage",{data:a,source:{postMessage:function(a){c.postMessage(a)},tabId:d&&d.tab?d.tab.id:
null}})):w(this,"dispatchEvent",[new p("message",{data:a,source:{postMessage:function(a){c.postMessage(a)},tabId:d&&d.tab?d.tab.id:null}})]);f&&f({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),w(this,"dispatchEvent",[new p("connect",{source:this._localPort})]))};u.prototype=Object.create(c.prototype);u.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var g=function(){u.call(this,
!1)};g.prototype=Object.create(u.prototype);g.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var q=j.extension=j.extension||new g;j.contexts=j.contexts||{};g.prototype.getFile=function(a){var b=null;if("string"!=typeof a)return b;try{var d=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(d)?d:"")+a,c=new XMLHttpRequest;c.onloadend=function(){c.readyState==
c.DONE&&200==c.status&&(result=c.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},b=result)};c.open("GET",a,!1);c.responseType="blob";c.send(null)}catch(e){}return b};var m=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(m.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(m.prototype,"key",{value:function(a){var b=0;for(a in this)if(this.hasOwnProperty(a)){if(b==
a)return a;b++}return null}});Object.defineProperty(m.prototype,"removeItem",{value:function(a,b){this.hasOwnProperty(a)&&(delete this[a],this.length--,b||q.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(m.prototype,"setItem",{value:function(a,b,d){this[a]||this.length++;this[a]=b;d||q.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:b}})}});Object.defineProperty(m.prototype,"clear",{value:function(a){for(var b in this)this.hasOwnProperty(b)&&
delete this[b];this.length=0;a||q.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};m.prototype=Object.create(Storage.prototype);g=function(){s.mixin(this);this.properties=i||{};this._preferences=new m;this._preferencesSet={};q.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var b in a.data.attrs)this.properties[b]=a.data.attrs[b];r.WIDGET_API_LOADED=!0;if(a.data._prefs)for(b in a.data._prefs)this._preferences[b]=
a.data._prefs[b],this._preferences.length++;r.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);q.postMessage({action:"___O_widget_setup_REQUEST"});e.addEventListener("beforeunload",function(){},!1)};g.prototype=
Object.create(c.prototype);g.prototype.__defineGetter__("name",function(){return this.properties.name||""});g.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});g.prototype.__defineGetter__("id",function(){return this.properties.id||""});g.prototype.__defineGetter__("description",function(){return this.properties.description||""});g.prototype.__defineGetter__("author",function(){return this.properties.author||""});g.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});g.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});g.prototype.__defineGetter__("version",function(){return this.properties.version||""});g.prototype.__defineGetter__("preferences",function(){return this._preferences});e.widget=e.widget||new g;if(e.opera)n=!0,j.isReady=function(a){a.call(j);for(var a=0,b=l.length;a<b;a++){var d=l[a];d.target[d.methodName].apply(d.target,
d.args)}l=[]};else{var c=function(a,b){var d=a.addEventListener;a.addEventListener=function(c,h,g){c.toLowerCase()===b.toLowerCase()?void 0===h||(null===h||"[object Function]"!==Object.prototype.toString.call(h))||(n?h.call(e):k[b.toLowerCase()].push(h)):d.call(a,c,h,g)};a.__defineSetter__("on"+b.toLowerCase(),function(d){a.addEventListener(b.toLowerCase(),d,!1)})},D=function(a,b){for(var d=a.toLowerCase(),c=new p(d,{}),e=0,g=k[d].length;e<g;e++)k[d][e].call(b,c);k[d]=[]},k={isready:[],domcontentloaded:[],
load:[]},E=!1,v=!1;e.document.addEventListener("DOMContentLoaded",function b(){E=!0;e.document.removeEventListener("DOMContentLoaded",b,!0)},!0);e.addEventListener("load",function d(){v=!0;e.removeEventListener("load",d,!0)},!0);c(e,"load");c(e.document,"domcontentloaded");c(e,"domcontentloaded");var G=(new Date).getTime()+3E3;(function f(){if((new Date).getTime()>=G)console.warn("opera.isReady check timed out"),v=!0;else for(var c in r)if(!0!==r[c]){e.setTimeout(function(){f()},20);return}e.setTimeout(function(){if(!n){for(var c=
0,f=k.isready.length;c<f;c++)k.isready[c].call(e);k.isready=[];var g=(new Date).getTime()+3E3;(function H(){var c=(new Date).getTime();if(E||v||c>=g){D("domcontentloaded",e.document);c>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+3E3;(function I(){var c=(new Date).getTime();if(v||c>=f){D("load",window);c>=f&&console.warn("window.load event fired on check timeout");for(var c=0,g=l.length;c<g;c++){var h=l[c];h.target[h.methodName].apply(h.target,
h.args)}l=[]}else e.setTimeout(function(){I()},50)})()}else e.setTimeout(function(){H()},50)})();n=!0}},0)})();j.isReady=function(c){n?c.call(e):k.isready.push(c)}}e.opera=j}(window,function(){var e=null;try{if(e=chrome.app.getDetails(),null==e){var i=new XMLHttpRequest;i.onloadend=function(){i.readyState==i.DONE&&200==i.status&&(e=JSON.parse(i.responseText),e.id=/^chrome\-extension\:\/\/(.*)\/$/.exec(chrome.extension.getURL(""))[1])};i.open("GET",chrome.extension.getURL("")+"manifest.json",!1);i.send(null)}}catch(w){e=
null}return e}());
