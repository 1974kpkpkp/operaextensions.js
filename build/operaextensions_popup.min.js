// operaextensions_popup.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(p){function w(a,c,d){l?a[c].apply(a,d):j.push({target:a,methodName:c,args:d})}var b=function(){};b.prototype.REVISION="1";b.prototype.version=function(){return this.REVISION};b.prototype.postError=function(a){console.log(a)};var h=p.opera||new b,l=!1,j=[],q={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},m={},b="undefined"!==typeof window?window:{},b=b.MutationObserver||b.WebKitMutationObserver;if("undefined"!==typeof process&&"[object process]"==={}.toString.call(process))b=
function(a,c){process.nextTick(function(){a.call(c)})};else if(b){var t=[],b=new b(function(){var a=t.slice();t=[];a.forEach(function(a){a[0].call(a[1])})}),x=document.createElement("div");b.observe(x,{attributes:!0});b=function(a,c){t.push([a,c]);x.setAttribute("drainQueue","drainQueue")}}else b=function(a,c){setTimeout(function(){a.call(c)},1)};m.async=b;var D=m.Event=function(a,c){this.type=a;for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d])},y=function(a,c){for(var d=0,e=a.length;d<e;d++)if(a[d][0]===
c)return d;return-1},u=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},b=m.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,d){for(var e=u(this),b,g,a=a.split(/\s+/),d=d||this;g=a.shift();)(b=e[g])||(b=e[g]=[]),-1===y(b,c)&&b.push([c,d])},off:function(a,c){for(var d=u(this),e,b,a=a.split(/\s+/);e=a.shift();)c?(e=d[e],b=y(e,c),-1!==b&&e.splice(b,1)):d[e]=[]},trigger:function(a,c){var d,e,b,g;if(d=u(this)[a])for(var f=
0,h=d.length;f<h;f++)e=d[f],b=e[0],e=e[1],"object"!==typeof c&&(c={detail:c}),g=new D(a,c),b.call(e,g)}},n=m.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},z=function(){},A=function(a,c,d,e){var b,g;if(d)try{b=d(e.detail)}catch(f){g=f}else b=e.detail;if(b instanceof n)b.then(function(a){c.resolve(a)},function(a){c.reject(a)});else if(d&&b)c.resolve(b);else if(g)c.reject(g);
else c[a](b)};n.prototype={then:function(a,c){var d=new n;this.on("promise:resolved",function(c){A("resolve",d,a,c)});this.on("promise:failed",function(a){A("reject",d,c,a)});return d},resolve:function(a){m.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=z},reject:function(a){m.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=this.resolve=z}};b.mixin(n.prototype);var f=function(){n.call(this);
this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};f.prototype=Object.create(n.prototype);f.prototype.addEventListener=f.prototype.on;f.prototype.removeEventListener=f.prototype.off;f.prototype.fireEvent=function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};f.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],c=[];if(1<arguments.length)for(var d=
1,b=arguments.length;d<b;d++)c.push(arguments[d]);this._queue.push({action:a,args:c})}};f.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};var r=function(a,c){var d=document.createEvent("Event");d.initEvent(a,!0,!0);for(var b in c)d[b]=c[b];return d},s=function(a){f.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),
this._localPort.onDisconnect.addListener(function(){this.fireEvent(new r("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a,b){var e=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.fireEvent(new r("controlmessage",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:b&&b.tab?b.tab.id:null}})):w(this,"fireEvent",[new r("message",{data:a,source:{postMessage:function(a){e.postMessage(a)},tabId:b&&b.tab?
b.tab.id:null}})])}.bind(this)),w(this,"fireEvent",[new r("connect",{source:this._localPort})]))};s.prototype=Object.create(f.prototype);s.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};b=function(){s.call(this,!1)};b.prototype=Object.create(s.prototype);b.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var o=h.extension=h.extension||new b;h.contexts=h.contexts||{};b.prototype.getFile=
function(a){var c=null;if("string"!=typeof a)return c;try{var b=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(b)?b:"")+a,e=new XMLHttpRequest;e.onloadend=function(){e.readyState==e.DONE&&200==e.status&&(result=e.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},c=result)};e.open("GET",a,!1);e.responseType=
"blob";e.send(null)}catch(f){}return c};var k=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(k.prototype,"getItem",{value:function(a){return this[a]}});Object.defineProperty(k.prototype,"key",{value:function(a){var c=0;for(a in this)if(this.hasOwnProperty(a)){if(c==a)return a;c++}return null}});Object.defineProperty(k.prototype,"removeItem",{value:function(a,c){this.hasOwnProperty(a)&&(delete this[a],this.length--,c||o.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",
data:{key:a}}))}});Object.defineProperty(k.prototype,"setItem",{value:function(a,c,b){this[a]||this.length++;this[a]=c;b||o.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:c}})}});Object.defineProperty(k.prototype,"clear",{value:function(a){for(var c in this)this.hasOwnProperty(c)&&delete this[c];this.length=0;a||o.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};k.prototype=Object.create(Storage.prototype);b=function(){this.properties={};this._preferences=
new k;this._preferencesSet={};o.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var c in a.data.attrs)this.properties[c]=a.data.attrs[c];q.WIDGET_API_LOADED=!0;if(a.data._prefs)for(c in a.data._prefs)this._preferences[c]=a.data._prefs[c],this._preferences.length++;q.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,
!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);o.postMessage({action:"___O_widget_setup_REQUEST"})};b.prototype=Object.create(f.prototype);b.prototype.__defineGetter__("name",function(){return this.properties.name||""});b.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});b.prototype.__defineGetter__("id",function(){return this.properties.id||""});b.prototype.__defineGetter__("description",
function(){return this.properties.description||""});b.prototype.__defineGetter__("author",function(){return this.properties.author||""});b.prototype.__defineGetter__("authorHref",function(){return this.properties.author?this.properties.author.href||"":""});b.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});b.prototype.__defineGetter__("version",function(){return this.properties.version||""});b.prototype.__defineGetter__("preferences",
function(){return this._preferences});p.widget=p.widget||new b;if(window.opera)l=!0,h.isReady=function(a){a.call(h);for(var a=0,c=j.length;a<c;a++){var b=j[a];b.target[b.methodName].apply(b.target,b.args)}j=[]};else{var b=function(a,c){var b=a.addEventListener;a.addEventListener=function(e,f,g){e.toLowerCase()===c.toLowerCase()?void 0===f||(null===f||"[object Function]"!==Object.prototype.toString.call(f))||(l?f.call(window):i[c.toLowerCase()].push(f)):b.call(a,e,f,g)};a.__defineSetter__("on"+c.toLowerCase(),
function(b){a.addEventListener(c.toLowerCase(),b,!1)})},B=function(a,b){var d=a.toLowerCase(),e=document.createEvent("Event");e.initEvent(d,!0,!0);for(var f=0,g=i[d].length;f<g;f++)i[d][f].call(b,e);i[d]=[]},i={isready:[],domcontentloaded:[],load:[]},C=!1,v=!1;document.addEventListener("DOMContentLoaded",function c(){C=!0;document.removeEventListener("DOMContentLoaded",c,!0)},!0);window.addEventListener("load",function d(){v=!0;window.removeEventListener("load",d,!0)},!0);b(window,"load");b(document,
"domcontentloaded");b(window,"domcontentloaded");var E=(new Date).getTime()+3E3;(function e(){if((new Date).getTime()>=E)console.error("opera.isReady check timed out");else for(var b in q)if(!0!==q[b]){window.setTimeout(function(){e()},20);return}window.setTimeout(function(){if(!l){for(var b=0,e=i.isready.length;b<e;b++)i.isready[b].call(window);i.isready=[];(function F(){C||v?(B("domcontentloaded",document),function G(){if(v){B("load",window);for(var b=0,e=j.length;b<e;b++){var f=j[b];f.target[f.methodName].apply(f.target,
f.args)}j=[]}else window.setTimeout(function(){G()},20)}()):window.setTimeout(function(){F()},20)})();l=!0}},0)})();h.isReady=function(b){l?b.call(window):i.isready.push(b)}}p.opera=h}(window);
