// operaextensions_popup.min.js - http://github.com/operasoftware/operaextensions.js
'use strict';!function(b,h){function w(a,c,e){m?a[c].apply(a,e):j.push({target:a,methodName:c,args:e})}var d=function(){};d.prototype.REVISION="1";d.prototype.version=function(){return this.REVISION};d.prototype.buildNumber=function(){return this.REVISION};d.prototype.postError=function(a){console.log(a)};var i=b.opera||new d,m=!1,j=[],r={WIDGET_API_LOADED:!1,WIDGET_PREFERENCES_LOADED:!1},n={},d="undefined"!==typeof window?window:{},d=d.MutationObserver||d.WebKitMutationObserver;if("undefined"!==
typeof process&&"[object process]"==={}.toString.call(process))d=function(a,c){process.nextTick(function(){a.call(c)})};else if(d){var x=[],d=new d(function(){var a=x.slice();x=[];a.forEach(function(a){a[0].call(a[1])})}),z=document.createElement("div");d.observe(z,{attributes:!0});d=function(a,c){x.push([a,c]);z.setAttribute("drainQueue","drainQueue")}}else d=function(a,c){setTimeout(function(){a.call(c)},1)};n.async=d;var F=n.Event=function(a,c){this.type=a;for(var e in c)c.hasOwnProperty(e)&&(this[e]=
c[e])},A=function(a,c){for(var e=0,f=a.length;e<f;e++)if(a[e][0]===c)return e;return-1},y=function(a){var c=a._promiseCallbacks;c||(c=a._promiseCallbacks={});return c},s=n.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},on:function(a,c,e){for(var f=y(this),b,d,a=a.split(/\s+/),e=e||this;d=a.shift();)(b=f[d])||(b=f[d]=[]),-1===A(b,c)&&b.push([c,e])},off:function(a,c){for(var e=y(this),f,b,a=a.split(/\s+/);f=a.shift();)c?(f=e[f],b=A(f,c),-1!==b&&f.splice(b,
1)):e[f]=[]},trigger:function(a,c){var e,f,b,d;if(e=y(this)[a])for(var g=0,h=e.length;g<h;g++)f=e[g],b=f[0],f=f[1],"object"!==typeof c&&(c={detail:c}),d=new F(a,c),b.call(f,d)}},t=n.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",{detail:a.detail})},this)},B=function(){},C=function(a,c,e,f){var b,d;if(e)try{b=e(f.detail)}catch(g){d=g}else b=f.detail;if(b instanceof t)b.then(function(a){c.resolve(a)},
function(a){c.reject(a)});else if(e&&b)c.resolve(b);else if(d)c.reject(d);else c[a](b)};t.prototype={then:function(a,c){var e=new t;this.on("promise:resolved",function(c){C("resolve",e,a,c)});this.on("promise:failed",function(a){C("reject",e,c,a)});return e},resolve:function(a){n.async(function(){this.trigger("promise:resolved",{detail:a});this.isResolved=a},this);this.reject=this.resolve=B},reject:function(a){n.async(function(){this.trigger("promise:failed",{detail:a});this.isRejected=a},this);this.reject=
this.resolve=B}};s.mixin(t.prototype);var o=function(a,c){var e=document.createEvent("Event");e.initEvent(a,!0,!0);for(var b in c)e[b]=c[b];return e},d=function(){s.mixin(this)};d.prototype.constructor=d;d.prototype.addEventListener=function(a,c){this.on(a,c)};d.prototype.removeEventListener=function(a,c){this.off(a,c)};d.prototype.dispatchEvent=function(a){var c=a.type;if("function"===typeof this["on"+c.toLowerCase()])this.on(c,this["on"+c.toLowerCase()]);this.trigger(c,a)};var u=function(a){s.mixin(this);
this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this.dispatchEvent(new o("disconnect",{source:this._localPort}));this._localPort=null}.bind(this)),a=function(a,e,b){var d=this._localPort;a&&a.action&&0===a.action.indexOf("___O_")?this.dispatchEvent(new o("controlmessage",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:
null}})):w(this,"dispatchEvent",[new o("message",{data:a,source:{postMessage:function(a){d.postMessage(a)},tabId:e&&e.tab?e.tab.id:null}})]);b&&b({})}.bind(this),this._localPort.onMessage.addListener(a),chrome.extension.onMessage.addListener(a),w(this,"dispatchEvent",[new o("connect",{source:this._localPort})]))};u.prototype=Object.create(d.prototype);u.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};var g=function(){u.call(this,
!1)};g.prototype=Object.create(u.prototype);g.prototype.__defineGetter__("bgProcess",function(){return chrome.extension.getBackgroundPage()});var p=i.extension=i.extension||new g;i.contexts=i.contexts||{};g.prototype.getFile=function(a){var c=null;if("string"!=typeof a)return c;try{var b=chrome.extension.getURL("");0==a.indexOf("widget:")&&(a=a.replace("widget:","chrome-extension:"));0==a.indexOf("/")&&(a=a.substring(1));var a=(-1==a.indexOf(b)?b:"")+a,f=new XMLHttpRequest;f.onloadend=function(){f.readyState==
f.DONE&&200==f.status&&(result=f.response,result.name=a.substring(a.lastIndexOf("/")+1),result.lastModifiedDate=null,result.toString=function(){return"[object File]"},c=result)};f.open("GET",a,!1);f.responseType="blob";f.send(null)}catch(d){}return c};var k=function(){Object.defineProperty(this,"length",{value:0,writable:!0});Object.defineProperty(k.prototype,"getItem",{value:function(a){a=this[a];return void 0===a?null:a}});Object.defineProperty(k.prototype,"key",{value:function(a){var c=0;for(a in this)if(this.hasOwnProperty(a)){if(c==
a)return a;c++}return null}});Object.defineProperty(k.prototype,"removeItem",{value:function(a,c){this.hasOwnProperty(a)&&(delete this[a],this.length--,c||p.postMessage({action:"___O_widgetPreferences_removeItem_REQUEST",data:{key:a}}))}});Object.defineProperty(k.prototype,"setItem",{value:function(a,c,b){this[a]||this.length++;this[a]=c;b||p.postMessage({action:"___O_widgetPreferences_setItem_REQUEST",data:{key:a,val:c}})}});Object.defineProperty(k.prototype,"clear",{value:function(a){for(var c in this)this.hasOwnProperty(c)&&
delete this[c];this.length=0;a||p.postMessage({action:"___O_widgetPreferences_clear_REQUEST"})}})};k.prototype=Object.create(Storage.prototype);g=function(){s.mixin(this);this.properties=h||{};this._preferences=new k;this._preferencesSet={};p.addEventListener("controlmessage",function(a){if(a.data&&a.data.action)switch(a.data.action){case "___O_widget_setup_RESPONSE":for(var c in a.data.attrs)this.properties[c]=a.data.attrs[c];r.WIDGET_API_LOADED=!0;if(a.data._prefs)for(c in a.data._prefs)this._preferences[c]=
a.data._prefs[c],this._preferences.length++;r.WIDGET_PREFERENCES_LOADED=!0;break;case "___O_widgetPreferences_setItem_RESPONSE":this._preferences.setItem(a.data.data.key,a.data.data.val,!0);break;case "___O_widgetPreferences_removeItem_RESPONSE":this._preferences.removeItem(a.data.data.key,!0);break;case "___O_widgetPreferences_clear_RESPONSE":this._preferences.clear(!0)}}.bind(this),!1);p.postMessage({action:"___O_widget_setup_REQUEST"});b.addEventListener("beforeunload",function(){},!1)};g.prototype=
Object.create(d.prototype);g.prototype.__defineGetter__("name",function(){return this.properties.name||""});g.prototype.__defineGetter__("shortName",function(){return this.properties.name?this.properties.name.short||"":""});g.prototype.__defineGetter__("id",function(){return this.properties.id||""});g.prototype.__defineGetter__("description",function(){return this.properties.description||""});g.prototype.__defineGetter__("author",function(){return this.properties.author||""});g.prototype.__defineGetter__("authorHref",
function(){return this.properties.author?this.properties.author.href||"":""});g.prototype.__defineGetter__("authorEmail",function(){return this.properties.author?this.properties.author.email||"":""});g.prototype.__defineGetter__("version",function(){return this.properties.version||""});g.prototype.__defineGetter__("preferences",function(){return this._preferences});b.widget=b.widget||new g;if(b.opera)m=!0,i.isReady=function(a){a.call(i);for(var a=0,c=j.length;a<c;a++){var b=j[a];b.target[b.methodName].apply(b.target,
b.args)}j=[]};else{var d=function(a,c){var e=a.addEventListener;a.addEventListener=function(d,g,h){d+="";d.toLowerCase()===c.toLowerCase()?void 0===g||(null===g||"[object Function]"!==Object.prototype.toString.call(g))||(m?g.call(b):l[c.toLowerCase()].push(g)):e.call(a,d,g,h)};a.__defineSetter__("on"+c.toLowerCase(),function(b){a.addEventListener(c.toLowerCase(),b,!1)})},q=function(a,c,b){for(var a=a.toLowerCase(),b=new o(a,b||{}),d=0,g=l[a].length;d<g;d++)l[a][d].call(c,b)},l={isready:[],readystatechange:[],
domcontentloaded:[],load:[]},D=!1,v=!1;b.document.addEventListener("DOMContentLoaded",function c(){D=!0;b.document.removeEventListener("DOMContentLoaded",c,!0)},!0);b.addEventListener("load",function e(){v=!0;b.removeEventListener("load",e,!0)},!0);b.document.addEventListener("readystatechange",function(d){d.stopImmediatePropagation();d.stopPropagation();"interactive"!==b.document.readyState&&"complete"!==b.document.readyState?q("readystatechange",b.document):b.document.readyState="loading"},!0);
var E="uninitialized";b.document.__defineSetter__("readyState",function(b){E=b});b.document.__defineGetter__("readyState",function(){return E});d(b,"load");d(b.document,"domcontentloaded");d(b,"domcontentloaded");d(b.document,"readystatechange");var G=(new Date).getTime()+3E3;(function f(){if((new Date).getTime()>=G)console.warn("opera.isReady check timed out"),v=!0;else for(var d in r)if(!0!==r[d]){b.setTimeout(function(){f()},20);return}b.setTimeout(function(){if(!m){for(var d=0,f=l.isready.length;d<
f;d++)l.isready[d].call(b);l.isready=[];var g=(new Date).getTime()+3E3;(function H(){var d=(new Date).getTime();if(D||v||d>=g){b.document.readyState="interactive";q("readystatechange",b.document);q("domcontentloaded",b.document,{bubbles:!0});d>=g&&console.warn("document.domcontentloaded event fired on check timeout");var f=(new Date).getTime()+3E3;(function I(){var d=(new Date).getTime();if(v||d>=f){b.document.readyState="complete";q("readystatechange",b.document);q("load",window);d>=f&&console.warn("window.load event fired on check timeout");
for(var d=0,g=j.length;d<g;d++){var h=j[d];h.target[h.methodName].apply(h.target,h.args)}j=[]}else b.setTimeout(function(){I()},50)})()}else b.setTimeout(function(){H()},50)})();m=!0}},0)})();i.isReady=function(d){m?d.call(b):l.isready.push(d)}}b.opera=i}(window,function(){var b=null;try{if(b=chrome.app.getDetails(),null==b){var h=new XMLHttpRequest;h.onloadend=function(){h.readyState==h.DONE&&200==h.status&&(b=JSON.parse(h.responseText),b.id=/^chrome\-extension\:\/\/(.*)\/$/.exec(chrome.extension.getURL(""))[1])};
h.open("GET",chrome.extension.getURL("")+"manifest.json",!1);h.send(null)}}catch(w){b=null}return b}());
