// operaextensions_popup.min.js - http://github.com/richtr/operaextensions.js
'use strict';!function(k){var h=k.opera||{REVISION:"1"},n=function(a,b){var c=document.createEvent("Event");c.initEvent(a,!0,!0);for(var e in b)c[e]=b[e];return c},f=this.RSVP={},d="undefined"!==typeof window?window:{},d=d.MutationObserver||d.WebKitMutationObserver;if("undefined"!==typeof process)d=function(a,b){process.nextTick(function(){a.call(b)})};else if(d){var l=[],d=new d(function(){var a=l.slice();l=[];a.forEach(function(a){a[0].call(a[1])})}),o=document.createElement("div");d.observe(o,
{attributes:!0});d=function(a,b){l.push([a,b]);o.setAttribute("drainQueue","drainQueue")}}else d=function(a,b){setTimeout(function(){a.call(b)},1)};f.async=d;var q=f.Event=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])},p=function(a,b){for(var c=0,e=a.length;c<e;c++)if(a[c][0]===b)return c;return-1},m=function(a){var b=a._promiseCallbacks;b||(b=a._promiseCallbacks={});return b},d=f.EventTarget={mixin:function(a){a.on=this.on;a.off=this.off;a.trigger=this.trigger;return a},
on:function(a,b,c){var e=m(this),d,c=c||this;(d=e[a])||(d=e[a]=[]);-1===p(d,b)&&d.push([b,c])},off:function(a,b){var c=m(this);if(b){var c=c[a],e=p(c,b);-1!==e&&c.splice(e,1)}else c[a]=[]},trigger:function(a,b){var c,e,d,g;if(c=m(this)[a])for(var f=0,h=c.length;f<h;f++)e=c[f],d=e[0],e=e[1],"object"!==typeof b&&(b={detail:b}),g=new q(a,b),d.call(e,g)}},i=f.Promise=function(){this.on("promise:resolved",function(a){this.trigger("success",{detail:a.detail})},this);this.on("promise:failed",function(a){this.trigger("error",
{detail:a.detail})},this)};f.invokeCallback=function(a,b,c,e){var d,f;if(c)try{d=c(e.detail)}catch(g){f=g}else d=e.detail;if(d instanceof i)d.then(function(a){b.resolve(a)},function(a){b.reject(a)});else if(c&&d)b.resolve(d);else if(f)b.reject(f);else b[a](d)};i.prototype={then:function(a,b){var c=new i;this.on("promise:resolved",function(b){f.invokeCallback("resolve",c,a,b)});this.on("promise:failed",function(a){f.invokeCallback("reject",c,b,a)});return c},resolve:function(a){f.async(function(){this.trigger("promise:resolved",
{detail:a})},this);this.resolve=function(){};this.reject=function(){}},reject:function(a){f.async(function(){this.trigger("promise:failed",{detail:a})},this);this.resolve=function(){};this.reject=function(){}}};d.mixin(i.prototype);var g=function(){RSVP.Promise.call(this);this._queue=[];this.resolved=!1;this.on("promise:resolved",function(){this.resolved=!0;this.dequeue()}.bind(this))};g.prototype=Object.create(RSVP.Promise.prototype);g.prototype.addEventListener=g.prototype.on;g.prototype.removeEventListener=
g.prototype.off;g.prototype.fireEvent=function(a){var b=a.type;if("function"===typeof this["on"+b.toLowerCase()])this.on(b,this["on"+b.toLowerCase()]);this.trigger(b,a)};g.prototype.enqueue=function(){if(!(1>arguments.length)){var a=arguments[0],b=[];if(1<arguments.length)for(var c=1,d=arguments.length;c<d;c++)b.push(arguments[c]);this._queue.push({action:a,args:b})}};g.prototype.dequeue=function(){var a=this._queue[0];a&&(this._queue.splice(0,1),this[a.action]&&this[a.action].apply(this,a.args))};
var j=function(a){g.call(this);this._isBackground=a||!1;this._localPort=null;this._isBackground||(this._localPort=chrome.extension.connect({name:""+Math.floor(1E16*Math.random())}),this._localPort.onDisconnect.addListener(function(){this._localPort=null}.bind(this)),this._localPort.onMessage.addListener(function(a){this.fireEvent(new n("message",{data:a,source:{postMessage:function(a){this._localPort.postMessage(a)}}}))}.bind(this)),k.addEventListener("load",function(){this.fireEvent(new n("connect",
{source:this._localPort}))}.bind(this),!1))};j.prototype=Object.create(g.prototype);j.prototype.postMessage=function(a){this._isBackground?this.broadcastMessage(a):this._localPort&&this._localPort.postMessage(a)};d=function(){j.call(this,!1)};d.prototype=Object.create(j.prototype);h.extension=h.extension||new d;h.contexts=h.contexts||{};k.opera=h}(window);
